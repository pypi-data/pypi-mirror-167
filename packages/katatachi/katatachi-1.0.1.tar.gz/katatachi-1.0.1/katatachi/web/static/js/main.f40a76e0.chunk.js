(this.webpackJsonpweb=this.webpackJsonpweb||[]).push([[0],{585:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(12),i=a.n(o),c=a(42),l=a(31),s=a(32),u=a(39),p=a(38),d=a(21),m=a(356),f=a(94),h=a(610),v=a(617),E=a(616),b=a(4),g=a(357),y=function(e){var t=e.render,a=e.apiClient,n=e.path;return r.a.createElement(d.b,{path:n,render:function(e){return a.hasAuth()?t():r.a.createElement(d.a,{to:{pathname:"/login",state:{from:e.location}}})}})},w=a(28),k=a(621),S=a(615),O=a(613),j=a(614),C=a(626),x=a(588),I=a(623),_=a(628),R=a(629),D=a(625),W=a(624),T=a(370),A=a(216),N=a.n(A),M=a(361),P=a.n(M),F=a(362),L=a.n(F),B=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).onReplicate=function(e,t,a){n.props.history.push("/workers/create?module_name=".concat(e,"&args=").concat(encodeURIComponent(JSON.stringify(t)),"&interval_seconds=").concat(a))},n.onRemove=function(e){window.confirm("Are you sure you want to remove worker ".concat(e))&&n.props.apiClient.removeWorker(e).then((function(){n.setState(Object(w.a)(Object(w.a)({},n.state),{},{workers:n.state.workers.filter((function(t){return t.worker_id!==e}))}))})).catch((function(e){n.setState({error:e})}))},n.onUpdateIntervalSeconds=function(e,t){n.props.apiClient.updateWorkerIntervalSeconds(e,t).catch((function(e){n.setState({error:e})}))},n.onUpdateErrorResiliency=function(e,t){n.props.apiClient.updateWorkerErrorResiliency(e,t).catch((function(e){n.setState({error:e})}))},n.state={loading:!0,workers:[]},n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.props.apiClient.getWorkers().then((function(t){return e.setState({workers:t})})).finally((function(){return e.setState({loading:!1})}))}},{key:"render",value:function(){var e=this;if(this.state.loading)return r.a.createElement(k.a,{container:!0,justify:"center"},r.a.createElement(S.a,null));if(this.state.error)return r.a.createElement(k.a,{container:!0,justify:"center"},r.a.createElement(O.a,{variant:"body1"},"Failed to load. Reason: ",this.state.error.toString()));if(0===this.state.workers.length)return r.a.createElement(k.a,{container:!0,justify:"center"},r.a.createElement(j.a,{variant:"contained",color:"primary",onClick:function(t){t.preventDefault(),e.props.history.push("/workers/create")},style:{marginBottom:12}},"Create new worker"));var t=Math.floor(Date.now()/1e3);return r.a.createElement("div",null,r.a.createElement(j.a,{variant:"contained",color:"primary",onClick:function(t){t.preventDefault(),e.props.history.push("/workers/create")},style:{marginBottom:12}},"Create new worker"),r.a.createElement(C.a,{component:x.a},r.a.createElement(I.a,null,r.a.createElement(_.a,null,r.a.createElement(R.a,null,r.a.createElement(D.a,null,"ID"),r.a.createElement(D.a,null,"Interval (seconds)"),r.a.createElement(D.a,null,"Error Resiliency (non-positive is none)"),r.a.createElement(D.a,null,"Executed minutes ago"),r.a.createElement(D.a,null,"Operations"))),r.a.createElement(W.a,null,this.state.workers.map((function(a){var n=a.worker_id,o=a.module_name,i=a.args,l=a.interval_seconds,s=a.error_resiliency,u=a.last_executed_seconds;return r.a.createElement(R.a,{key:n},r.a.createElement(D.a,null,r.a.createElement(c.b,{to:"/worker/".concat(n)},n)),r.a.createElement(D.a,null,r.a.createElement(T.a,{type:"number",value:l,onChange:function(t){t.preventDefault(),e.setState({workers:e.state.workers.map((function(e){return e.worker_id!==n?e:Object(w.a)(Object(w.a)({},e),{},{interval_seconds:parseInt(t.target.value)})}))})}}),r.a.createElement(j.a,{onClick:function(t){t.preventDefault(),e.onUpdateIntervalSeconds(n,l)},startIcon:r.a.createElement(N.a,null),color:"secondary"},"Apply")),r.a.createElement(D.a,null,r.a.createElement(T.a,{type:"number",value:s,onChange:function(t){t.preventDefault(),e.setState({workers:e.state.workers.map((function(e){return e.worker_id!==n?e:Object(w.a)(Object(w.a)({},e),{},{error_resiliency:parseInt(t.target.value)})}))})}}),r.a.createElement(j.a,{onClick:function(t){t.preventDefault(),e.onUpdateErrorResiliency(n,s)},startIcon:r.a.createElement(N.a,null),color:"secondary"},"Apply")),r.a.createElement(D.a,null,-1!==u?Math.floor((t-u)/60):"N/A"),r.a.createElement(D.a,null,r.a.createElement(j.a,{onClick:function(t){t.preventDefault(),e.onReplicate(o,i,l)},startIcon:r.a.createElement(P.a,null),color:"secondary"},"Duplicate"),r.a.createElement(j.a,{onClick:function(t){t.preventDefault(),e.onRemove(n)},startIcon:r.a.createElement(L.a,null),color:"secondary"},"Delete")))}))))))}}]),a}(r.a.Component),U=Object(d.h)(B),V=a(52),J=a(363),K=a.n(J),H=a(620),q=a(212),Q=a(594),z=a(600),G=a(622),$=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var n;Object(l.a)(this,a),(n=t.call(this,e)).onSubmit=function(){var e=n.state,t=e.moduleName,a=e.argsString,r=e.intervalSeconds,o=JSON.parse(a);n.props.apiClient.addWorker(t,o,r).then((function(){n.props.history.push("/workers/view")})).catch((function(e){n.setState({error:e})}))},n.moduleArgsToString=function(e){for(var t={},a=0,n=Object.entries(e);a<n.length;a++){var r=Object(V.a)(n[a],2),o=r[0],i=r[1],c=void 0;c="str"===i?"":"int"===i?-1:"bool"!==i&&null,t[o]=c}return JSON.stringify(t,null,4)};var r=K.a.parse(n.props.location.search);return n.state={loading:!0,modules:[],moduleName:r.module_name||"",argsString:r.args||"{}",intervalSeconds:parseInt(r.interval_seconds)||60},n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.props.apiClient.getWorkerModules().then((function(t){e.setState({modules:t})})).catch((function(t){e.setState({error:t})})).finally((function(){e.setState({loading:!1})}))}},{key:"render",value:function(){var e=this;if(this.state.loading)return r.a.createElement(k.a,{container:!0,justify:"center"},r.a.createElement(S.a,null));if(this.state.error)return r.a.createElement(k.a,{container:!0,justify:"center"},r.a.createElement(O.a,{variant:"body1"},"Failed to load. Reason: ",this.state.error.toString()));var t=!0;try{JSON.parse(this.state.argsString)}catch(a){t=!1}return r.a.createElement(H.a,null,r.a.createElement(q.a,{margin:"dense"},r.a.createElement(Q.a,null,"Module"),r.a.createElement(z.a,{value:this.state.moduleName,onChange:function(t){t.preventDefault();var a=t.target.value,n=e.moduleArgsToString(e.state.modules.filter((function(e){return e.name===a}))[0].args);e.setState({moduleName:a,argsString:n})}},this.state.modules.map((function(e,t){return r.a.createElement(G.a,{key:t,value:e.name},e.name)})))),r.a.createElement(q.a,{margin:"dense"},r.a.createElement(Q.a,null,"Args"),r.a.createElement(T.a,{value:this.state.argsString,onChange:function(t){t.preventDefault(),e.setState({argsString:t.target.value})},multiline:!0,rows:6,rowsMax:6,error:!t})),r.a.createElement(q.a,{margin:"dense"},r.a.createElement(Q.a,null,"Interval seconds"),r.a.createElement(T.a,{type:"number",value:this.state.intervalSeconds,onChange:function(t){t.preventDefault(),e.setState({intervalSeconds:parseInt(t.target.value)})}})),r.a.createElement(q.a,{margin:"dense"},r.a.createElement(j.a,{variant:"contained",color:"secondary",onClick:function(t){t.preventDefault(),e.onSubmit()},disabled:!t},"Submit")))}}]),a}(r.a.Component),X=Object(d.h)($),Y=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={boards:[],loading:!0},n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.props.apiClient.getBoards().then((function(t){e.setState({boards:t})})).catch((function(t){e.setState({error:t})})).finally((function(){e.setState({loading:!1})}))}},{key:"render",value:function(){return this.state.loading?r.a.createElement(k.a,{container:!0,justify:"center"},r.a.createElement(S.a,null)):this.state.error?r.a.createElement(k.a,{container:!0,justify:"center"},r.a.createElement(O.a,{variant:"body1"},"Failed to load. Reason: ",this.state.error.toString())):0===this.state.boards.length?r.a.createElement(k.a,{container:!0,justify:"center"},r.a.createElement(O.a,{variant:"body1"},"No boards")):r.a.createElement(C.a,{component:x.a},r.a.createElement(I.a,null,r.a.createElement(_.a,null,r.a.createElement(R.a,null,r.a.createElement(D.a,null,"Name"),r.a.createElement(D.a,null,"Count"),r.a.createElement(D.a,null,"Query"),r.a.createElement(D.a,null,"Sort"))),r.a.createElement(W.a,null,this.state.boards.map((function(e,t){for(var a=e.board_id,n=e.board_query,o=n.q,i=n.sort,l=e.count,s=i||{},u="",p=0,d=Object.keys(s);p<d.length;p++){var m=d[p];u+="".concat(m," ").concat(1===s[m]?"\u2191":"\u2193"," ")}return r.a.createElement(R.a,{key:t},r.a.createElement(D.a,null,r.a.createElement(c.b,{to:"/modView/".concat(encodeURIComponent(a))},a)),r.a.createElement(D.a,null,l),r.a.createElement(D.a,null,r.a.createElement("p",{style:{fontFamily:"monospace"}},JSON.stringify(o))),r.a.createElement(D.a,null,u))})))))}}]),a}(r.a.Component),Z=function(e){var t=e.data,a=e.boardId,n=e.callbackId,o=e.rawDocument,i=e.apiClient,c=e.reloading,l=e.reload,s=e.reloadFinished,u=e.getRawDocument,p=e.remove,d=e.rowCount;if(void 0===o&&void 0===u)return r.a.createElement("div",null,"Neither rawDocument nor getRawDocument");var m=t.text,f=t.after_callback;return r.a.createElement(j.a,{variant:"contained",color:"secondary",onClick:function(){var e;e=void 0!==u?u():[o];var t=f;"remove"===t&&1===d&&(t="reload"),"reload"===t?c():"remove"===t&&p(),Promise.all(e.map((function(e){return i.callbackBoard(a,n,e)}))).then((function(e){if("reload"===t){var a=e.map((function(e){return e.data}));l(a[a.length-1])}})).catch((function(e){alert("Something went wrong while making board callback: ".concat(e.toString())),window.location.reload()})).finally((function(){"reload"===t&&s()}))}},m)},ee=function(e){var t=e.data.url;return r.a.createElement("img",{src:t,alt:t,style:{objectFit:"contain",width:360,height:480}})},te=function(e){var t=e.data;return r.a.createElement("div",null,t.urls.map((function(e){return r.a.createElement(ee,{data:{url:e}})})))},ae=function(e){var t=e.data.text;if(t.startsWith('"')&&t.endsWith('"')&&(t=t.substring(1,t.length-1)),function(e){try{new URL(e)}catch(t){return!1}return!0}(t))return r.a.createElement("a",{href:t,target:"_blank",rel:"noopener noreferrer"},t.substring(0,50));if(t.startsWith("www.")){var a="https://"+t;return r.a.createElement("a",{href:a,target:"_blank",rel:"noopener noreferrer"},t.substring(0,50))}return r.a.createElement("p",null,t)},ne=function(e){var t=e.data.url;return r.a.createElement("video",{controls:!0,style:{objectFit:"contain",width:360,height:480}},r.a.createElement("source",{src:t,type:"video/mp4"}))},re=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).boardId=void 0,n.loadQuery=function(){n.setState(a.InitialState),n.props.apiClient.renderBoard(n.boardId).then((function(e){return n.setState({boardRender:e})})).catch((function(e){n.setState({error:e})})).finally((function(){n.setState({loading:!1})}))},n.renderCell=function(e,t,a,o,i,c){var l;return"text"===e?l=ae:"image"===e?l=ee:"image_list"===e?l=te:"button"===e?l=Z:"video"===e&&(l=ne),l?r.a.createElement(l,{data:t,boardId:n.boardId,callbackId:i,rawDocument:o,getRawDocument:c,apiClient:n.props.apiClient,reloading:function(){n.setState({loading:!0})},reload:function(e){n.setState({boardRender:e})},reloadFinished:function(){n.setState({loading:!1})},remove:function(){o&&0!==Object.keys(n.state.boardRender).length&&n.setState(Object(w.a)(Object(w.a)({},n.state),{},{boardRender:Object(w.a)(Object(w.a)({},n.state.boardRender),{},{count:n.state.boardRender.count-1,payload:n.state.boardRender.payload.filter((function(e,t){return t!==a}))})}))},rowCount:n.state.boardRender.payload.length}):r.a.createElement(O.a,null,"Unknown column type ".concat(e))},n.renderRow=function(e,t,a){var o=t.renders;return r.a.createElement(R.a,{key:a},e.map((function(e){var i,c=o[e];return i=c?n.renderCell(c.type,c.data,a,t.raw_document,c.callback_id):r.a.createElement(O.a,null,"N/A"),r.a.createElement(D.a,{key:e},i)})))},n.renderPayload=function(){var e=n.state.boardRender.payload;if(!e||0===e.length)return r.a.createElement(O.a,null,"Query is empty");var t=n.state.boardRender.board_query.projections.map((function(e){return e.name}));return r.a.createElement(C.a,{component:x.a},r.a.createElement(I.a,null,r.a.createElement(_.a,null,r.a.createElement(R.a,null,t.map((function(e){return r.a.createElement(D.a,{key:e},e)})))),r.a.createElement(W.a,null,e.map((function(e,a){return n.renderRow(t,e,a)})))))},n.boardId=decodeURIComponent(n.props.match.params.name),n.state=a.InitialState,n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){this.loadQuery()}},{key:"render",value:function(){if(this.state.loading)return r.a.createElement(k.a,{container:!0,justify:"center"},r.a.createElement(S.a,null));if(this.state.error)return r.a.createElement(k.a,{container:!0,justify:"center"},r.a.createElement(O.a,{variant:"body1"},"Failed to load. Reason: ",this.state.error.toString()));var e=this.state.boardRender,t=e.payload.length;return r.a.createElement(r.a.Fragment,null,r.a.createElement(O.a,{gutterBottom:!0},'Mod view "',this.boardId,'" (',e.count,e.count!==t?", showing ".concat(t):"",")"),this.renderPayload())}}]),a}(r.a.Component);re.InitialState={loading:!0,boardRender:{}};var oe=Object(d.h)(re),ie=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).workerId=void 0,n.workerId=n.props.match.params.workerId,n.state={loading:!0,metadataStr:"[]",args:{}},n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){var e=this;Promise.all([this.props.apiClient.getWorkerMetadata(this.workerId),this.props.apiClient.getWorkerArgs(this.workerId)]).then((function(t){var a=Object(V.a)(t,2),n=a[0],r=a[1];e.setState({metadataStr:JSON.stringify(n),args:r})})).catch((function(t){e.setState({error:t})})).finally((function(){e.setState({loading:!1})}))}},{key:"render",value:function(){var e=this,t=!0;try{JSON.parse(this.state.metadataStr)}catch(a){t=!1}return r.a.createElement("div",null,r.a.createElement(O.a,null,"Worker ".concat(this.workerId)),r.a.createElement(H.a,null,r.a.createElement(q.a,{margin:"dense"},r.a.createElement(Q.a,null,"Args"),r.a.createElement(T.a,{multiline:!0,rows:10,rowsMax:10,value:JSON.stringify(this.state.args,null,4),disabled:!0,style:{fontFamily:"monospace"}})),r.a.createElement(q.a,{margin:"dense"},r.a.createElement(Q.a,null,"Metadata"),r.a.createElement(T.a,{multiline:!0,rows:5,rowsMax:5,value:this.state.metadataStr,onChange:function(t){t.preventDefault(),e.setState({metadataStr:t.target.value})},error:!t,style:{fontFamily:"monospace"}})),r.a.createElement(q.a,{margin:"dense"},r.a.createElement(j.a,{variant:"contained",color:"secondary",onClick:function(t){t.preventDefault(),e.props.apiClient.setWorkerMetadata(e.workerId,JSON.parse(e.state.metadataStr))},disabled:!t},"Submit"))))}}]),a}(r.a.Component),ce=Object(d.h)(ie),le=a(11),se=a.n(le),ue=a(23),pe=a(121),de=a.n(pe),me=function(){function e(){Object(l.a)(this,e),this.TokenLocalStorageKey="accessToken",this.endpoint=void 0,this.axios=void 0,this.isAuth=void 0,Object({NODE_ENV:"production",PUBLIC_URL:"/web",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_ENDPOINT?this.endpoint=Object({NODE_ENV:"production",PUBLIC_URL:"/web",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_ENDPOINT:this.endpoint="",this.axios=de.a.create(),this.isAuth=!1;var t=localStorage.getItem(this.TokenLocalStorageKey);t&&this.setAuth(t)}return Object(s.a)(e,[{key:"auth",value:function(){var e=Object(ue.a)(se.a.mark((function e(t,a){var n=this;return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.post("".concat(this.endpoint,"/auth"),{username:t,password:a}).then((function(e){var t=e.data.access_token;if(!t)throw new Error("No access_token in ".concat(e.data));return n.setAuth(t),!0})));case 1:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"setAuth",value:function(e){localStorage.setItem(this.TokenLocalStorageKey,e),this.isAuth=!0,this.axios=de.a.create({headers:{Authorization:"Bearer "+e}})}},{key:"unsetAuth",value:function(){localStorage.removeItem(this.TokenLocalStorageKey),this.isAuth=!0,this.axios=de.a.create()}},{key:"hasAuth",value:function(){return this.isAuth}},{key:"getVersion",value:function(){var e=Object(ue.a)(se.a.mark((function e(){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("".concat(this.endpoint,"/version")).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getBoards",value:function(){var e=Object(ue.a)(se.a.mark((function e(){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/boards")).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renderBoard",value:function(){var e=Object(ue.a)(se.a.mark((function e(t){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/boards/render/").concat(t)).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"callbackBoard",value:function(){var e=Object(ue.a)(se.a.mark((function e(t,a,n){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.post("".concat(this.endpoint,"/apiInternal/boards/callback/").concat(t,"/").concat(a),n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"getWorkers",value:function(){var e=Object(ue.a)(se.a.mark((function e(){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/worker")).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWorkerModules",value:function(){var e=Object(ue.a)(se.a.mark((function e(){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/worker/modules")).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"addWorker",value:function(){var e=Object(ue.a)(se.a.mark((function e(t,a,n){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.post("".concat(this.endpoint,"/apiInternal/worker"),{module_name:t,args:a,interval_seconds:n}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"removeWorker",value:function(){var e=Object(ue.a)(se.a.mark((function e(t){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.delete("".concat(this.endpoint,"/apiInternal/worker/").concat(t)));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateWorkerIntervalSeconds",value:function(){var e=Object(ue.a)(se.a.mark((function e(t,a){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.put("".concat(this.endpoint,"/apiInternal/worker/").concat(t,"/intervalSeconds/").concat(a)));case 1:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"updateWorkerErrorResiliency",value:function(){var e=Object(ue.a)(se.a.mark((function e(t,a){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.put("".concat(this.endpoint,"/apiInternal/worker/").concat(t,"/errorResiliency/").concat(a)));case 1:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getWorkerMetadata",value:function(){var e=Object(ue.a)(se.a.mark((function e(t){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/worker/").concat(t,"/metadata")).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setWorkerMetadata",value:function(){var e=Object(ue.a)(se.a.mark((function e(t,a){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.post("".concat(this.endpoint,"/apiInternal/worker/").concat(t,"/metadata"),a));case 1:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getWorkerArgs",value:function(){var e=Object(ue.a)(se.a.mark((function e(t){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/worker/").concat(t,"/args")).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPipeline",value:function(){var e=Object(ue.a)(se.a.mark((function e(){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/pipeline")).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWorkerRuns",value:function(){var e=Object(ue.a)(se.a.mark((function e(t){return se.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/worker/runs"),{params:{page:t}}).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),fe=a(630),he=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).login=function(e,t){n.setState({loading:!0,error:void 0}),n.props.apiClient.auth(e,t).then((function(e){e?n.setState({redirectToReferrer:!0}):n.setState({error:"Unauthenticated"})})).catch((function(e){n.setState({error:e.toString()})})).finally((function(){n.setState({loading:!1})}))},n.state={loading:!1,username:"",password:"",redirectToReferrer:!1},n}return Object(s.a)(a,[{key:"render",value:function(){var e=this;if(this.state.redirectToReferrer){var t=(this.props.location.state||{from:{pathname:"/"}}).from;return r.a.createElement(d.a,{to:t})}var a=this.props.classes;return r.a.createElement(E.a,{component:"main",maxWidth:"xs"},r.a.createElement("div",{className:a.paper},r.a.createElement("form",{className:a.form,noValidate:!0},r.a.createElement(fe.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"username",label:"Username",name:"username",autoComplete:"username",autoFocus:!0,value:this.state.username,onChange:function(t){t.preventDefault(),e.setState({username:t.target.value})},disabled:this.state.loading}),r.a.createElement(fe.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",value:this.state.password,onChange:function(t){t.preventDefault(),e.setState({password:t.target.value})},disabled:this.state.loading}),this.state.error?r.a.createElement("p",{style:{color:"red"}},this.state.error):null,r.a.createElement(j.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:a.submit,onClick:function(t){t.preventDefault(),e.login(e.state.username,e.state.password)},disabled:this.state.loading},"Log in"))))}}]),a}(r.a.Component),ve=Object(b.a)((function(e){return Object(m.a)({paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)}})}))(Object(d.h)(he)),Ee=a(218),be=a(107),ge=a(71),ye=a(217),we=a.n(ye),ke={x:0,y:0},Se=new we.a.graphlib.Graph;Se.setDefaultEdgeLabel((function(){return{}}));var Oe=function(e){var t=Object(n.useState)(!0),a=Object(V.a)(t,2),o=a[0],i=a[1],c=Object(n.useState)(),l=Object(V.a)(c,2),s=l[0],u=l[1],p=Object(d.g)();if(Object(n.useEffect)((function(){Object(ue.a)(se.a.mark((function t(){var a;return se.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.apiClient.getPipeline();case 2:a=t.sent,u(a),i(!1);case 5:case"end":return t.stop()}}),t)})))()}),[e.apiClient]),o)return r.a.createElement(k.a,{container:!0,justify:"center"},r.a.createElement(O.a,{variant:"body1"},"Loading pipeline..."));if(!s)return r.a.createElement(k.a,{container:!0,justify:"center"},r.a.createElement(O.a,{variant:"body1"},"No pipeline"));var m=function(e){return Se.setGraph({rankdir:"LR"}),e.forEach((function(e){Object(ge.e)(e)?Se.setNode(e.id,{width:200,height:50}):Se.setEdge(e.source,e.target)})),we.a.layout(Se),e.map((function(e){if(Object(ge.e)(e)){var t=Se.node(e.id);e.targetPosition=ge.b.Left,e.sourcePosition=ge.b.Right,e.position={x:t.x-100+Math.random()/1e3,y:t.y-25}}return e}))}(function(e){var t,a=e.pipeline,n=e.sources,r=[{id:"PipelineSources",data:{label:"Sources (".concat(n.length,")"),name:"PipelineSources"},position:ke}],o=Object(be.a)(a.states);try{for(o.s();!(t=o.n()).done;){var i=t.value;r.push({id:i.name,data:{label:"".concat(i.name," (").concat(i.count,")")},position:ke})}}catch(E){o.e(E)}finally{o.f()}r.push({id:"PipelineSources-".concat(a.starting_state.name),source:"PipelineSources",target:a.starting_state.name,animated:!0,arrowHeadType:ge.a.ArrowClosed});var c,l=[].concat(Object(Ee.a)(a.workers.map((function(e){return Object(w.a)(Object(w.a)({},e),{},{type:"w"})}))),Object(Ee.a)(a.mod_views.map((function(e){return Object(w.a)(Object(w.a)({},e),{},{type:"m"})})))),s=Object(be.a)(l);try{for(s.s();!(c=s.n()).done;){var u,p=c.value,d=p.from_state,m=Object(be.a)(p.to_states);try{for(m.s();!(u=m.n()).done;){var f=u.value,h=p.name,v=p.type;r.push({id:"".concat(d,"-").concat(f),data:{fromState:d,toState:f,name:h,type:v},label:"(".concat(v,") ").concat(h),source:d,target:f,animated:!0,arrowHeadType:ge.a.ArrowClosed})}}catch(E){m.e(E)}finally{m.f()}}}catch(E){s.e(E)}finally{s.f()}return r}(s));return r.a.createElement("div",{style:{height:500,width:1200}},r.a.createElement(ge.c,{elements:m,nodesDraggable:!1,nodesConnectable:!1,onElementClick:function(e,t){if(Object(ge.d)(t)&&"m"===t.data.type){var a=t.data;p.push("/modView/".concat(a.name))}}}))},je=a(364),Ce=a.n(je),xe=a(365),Ie=a.n(xe),_e=a(367),Re=a.n(_e),De=a(366),We=a.n(De),Te=a(612),Ae=a(611),Ne=a(210),Me=a(627),Pe=36e5,Fe=864e5,Le=function(e){var t=function(e){return e<6e4?"".concat(Math.floor(e/1e3),"s"):e<Pe?"".concat(Math.floor(e/6e4),"m"):e<Fe?"".concat(Math.floor(e/Pe),"h"):e<6048e5&&"".concat(Math.floor(e/Fe),"d")}((new Date).getTime()-e);return t||new Date(e).toISOString().split("T")[0]},Be=a(631),Ue=a(632),Ve=a(633),Je=a(634),Ke=function(e){var t=e.run,a=r.a.useState(!1),n=Object(V.a)(a,2),o=n[0],i=n[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(R.a,null,r.a.createElement(D.a,null,t.worker_id),r.a.createElement(D.a,null,t.run_id),r.a.createElement(D.a,null,t.state),r.a.createElement(D.a,null,Le(t.created_ms)),r.a.createElement(D.a,null,r.a.createElement(Te.a,{"aria-label":"expand row",size:"small",onClick:function(){return i(!o)}},o?r.a.createElement(Be.a,null):r.a.createElement(Ue.a,null)))),r.a.createElement(R.a,null,r.a.createElement(D.a,{style:{paddingBottom:0,paddingTop:0},colSpan:6},r.a.createElement(Ae.a,{in:o,timeout:"auto",unmountOnExit:!0},r.a.createElement(Ne.a,{margin:1},r.a.createElement("textarea",{value:t.logs.map((function(e){return"".concat(Le(e.created_ms)," ").concat(e.message)})).join("\n"),disabled:!0,style:{fontFamily:"monospace",resize:"none",width:"100%"}}))))))},He=function(e){var t=r.a.useState(!0),a=Object(V.a)(t,2),o=a[0],i=a[1],c=r.a.useState([]),l=Object(V.a)(c,2),s=l[0],u=l[1],p=r.a.useState(1),d=Object(V.a)(p,2),m=d[0],f=d[1];return Object(n.useEffect)((function(){Object(ue.a)(se.a.mark((function t(){var a;return se.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.apiClient.getWorkerRuns(m);case 2:a=t.sent,u(a),i(!1);case 5:case"end":return t.stop()}}),t)})))()}),[e.apiClient,m]),o?r.a.createElement(k.a,{container:!0,justify:"center"},r.a.createElement(O.a,{variant:"body1"},"Loading worker runs...")):0===s.length?r.a.createElement(k.a,{container:!0,justify:"center"},r.a.createElement(O.a,{variant:"body1"},"No worker runs")):r.a.createElement(C.a,{component:x.a},r.a.createElement(I.a,null,r.a.createElement(_.a,null,r.a.createElement(R.a,null,r.a.createElement(D.a,null,"Worker ID"),r.a.createElement(D.a,null,"Run ID"),r.a.createElement(D.a,null,"State"),r.a.createElement(D.a,null,"Created"),r.a.createElement(D.a,null))),r.a.createElement(W.a,null,s.map((function(e){var t="".concat(e.worker_id,".").concat(e.run_id);return r.a.createElement(Ke,{key:t,run:e})}))),r.a.createElement(Me.a,null,r.a.createElement(R.a,null,r.a.createElement(Te.a,{onClick:function(){f(m-1)},disabled:1===m},r.a.createElement(Ve.a,null)),r.a.createElement(Te.a,{onClick:function(){f(m+1)},disabled:0===s.length},r.a.createElement(Je.a,null))))))},qe=Object(f.a)({palette:{primary:{light:"#439889",main:"#00695c",dark:"#003d33",contrastText:"#ffffff"},secondary:{light:"#df78ef",main:"#ab47bc",dark:"#790e8b",contrastText:"#ffffff"}}}),Qe=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).apiClient=void 0,n.apiClient=new me,n.state={version:void 0},n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.apiClient.getVersion().then((function(t){return e.setState({version:t})})).catch((function(e){return console.error(e)}))}},{key:"render",value:function(){var e=this,t=this.props.classes;return r.a.createElement(h.a,{theme:qe},r.a.createElement(v.a,null),r.a.createElement(g.AppNav,{title:document.title,items:[{text:"Mod Views",icon:r.a.createElement(Ce.a,null),action:function(){e.props.history.push("/modViews/view")}},{text:"Workers",icon:r.a.createElement(Ie.a,null),action:function(){e.props.history.push("/workers/view")}},{text:"Runs",icon:r.a.createElement(We.a,null),action:function(){e.props.history.push("/workers/runs/view")}},{text:"Pipeline",icon:r.a.createElement(Re.a,null),action:function(){e.props.history.push("/pipeline/view")}}],rightMostItem:{text:"Logout",icon:null,action:function(){e.apiClient.unsetAuth(),window.location.reload()}}},r.a.createElement(E.a,null,r.a.createElement("main",{className:t.main},r.a.createElement(d.d,null,r.a.createElement(d.a,{exact:!0,from:"/",to:"/modViews/view"}),r.a.createElement(d.b,{exact:!0,path:"/login",component:function(){return r.a.createElement(ve,{apiClient:e.apiClient})}}),r.a.createElement(y,{path:"/pipeline/view",apiClient:this.apiClient,render:function(){return r.a.createElement(Oe,{apiClient:e.apiClient})}}),r.a.createElement(y,{path:"/modViews/view",apiClient:this.apiClient,render:function(){return r.a.createElement(Y,{apiClient:e.apiClient})}}),r.a.createElement(d.b,{path:"/modView/:name",apiClient:this.apiClient,component:function(){return r.a.createElement(oe,{apiClient:e.apiClient})}}),r.a.createElement(d.b,{path:"/workers/view",apiClient:this.apiClient,component:function(){return r.a.createElement(U,{apiClient:e.apiClient})}}),r.a.createElement(d.b,{path:"/workers/create",apiClient:this.apiClient,component:function(){return r.a.createElement(X,{apiClient:e.apiClient})}}),r.a.createElement(d.b,{path:"/worker/:workerId",apiClient:this.apiClient,component:function(){return r.a.createElement(ce,{apiClient:e.apiClient})}}),r.a.createElement(d.b,{path:"/workers/runs/view",apiClient:this.apiClient,component:function(){return r.a.createElement(He,{apiClient:e.apiClient})}})))),r.a.createElement("span",{style:{marginLeft:"20px"}},"Version: ",this.state.version||"loading...")))}}]),a}(r.a.Component),ze=Object(d.h)(Object(b.a)((function(e){return Object(m.a)({main:{padding:e.spacing(4,0,3)}})}))(Qe));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(c.a,{basename:"/web"},r.a.createElement(ze,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[585,1,2]]]);
//# sourceMappingURL=main.f40a76e0.chunk.js.map