"use strict";// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt GNU-AGPL-3.0-or-later
const bodyDiv=elById("body");let urlData={};const lastLoaded=[];function dynLoadOnData(e,o){if(!e){console.error("No data received");return}if(e.redirect){window.location.href=e.redirect;return}const t=e.url;if(!t){console.error("No URL in data ",e);return}if(console.log("Handling data",e),!o){if(lastLoaded.length===1&&lastLoaded[0]===t){console.log("URL is the same as last loaded, ignoring");return}history.pushState({data:e,url:t,stateType:"dynLoad"},e.title,t),lastLocation=t}if(!e.body){window.location.reload();return}if(document.onkeydown=()=>{},bodyDiv.innerHTML=e.body,e.css){const n=document.createElement("style");n.innerHTML=e.css,bodyDiv.appendChild(n)}if(e.stylesheets)for(const n of e.stylesheets){const i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=n,bodyDiv.appendChild(i)}if(e.scripts)for(const n of e.scripts)if(n.src){const i=document.createElement("script");i.src=n.src,bodyDiv.appendChild(i)}else console.error("Script without src",n);window.hideSitePane&&hideSitePane(),document.title=e.title;const r=elById("title");return r&&(r.setAttribute("short_title",e.short_title||e.title),r.innerText=e.title),dynLoadReplaceAnchors(),urlData=e,!0}function dynLoadReplaceAnchors(){for(const e of document.getElementsByTagName("A"))dynLoadReplaceHrefOnAnchor(e)}function dynLoadReplaceHrefOnAnchor(e){e.hasAttribute("no-dynload")||dynLoadFixHref(e)}function dynLoadFixHref(e){if(e.target==="_blank")return;const o=(e.href.startsWith("/")?window.location.origin+e.href:e.href).trim(),t=o.split("?")[0];!o.startsWith(window.location.origin)||(t.split("/").pop()||"").includes(".")&&t!==window.location.origin+"/redirect"||t===window.location.origin+"/chat"||o.startsWith("#")||o.startsWith(window.location.href.split("#")[0]+"#")||(e.onclick=r=>{dynLoad(o),r.preventDefault()})}function dynLoad(e){console.log("Loading URL",e),history.replaceState({data:urlData,url:window.location.href,scrollPos:[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop],stateType:"dynLoad"},document.title,window.location.href),dynLoadSwitchToURL(e)}function dynLoadSwitchToURL(e,o=!1){if(!o&&e===window.location.href){console.log("URL is the same as current, just hide site pane"),window.hideSitePane&&hideSitePane();return}bodyDiv.prepend("Laden... Wenn dies zu lange (Ã¼ber ein paar Sekunden) dauert, lade bitte die Seite neu."),get(e,"",t=>dynLoadOnData(t,!1),t=>{console.log(t),e===window.location.href?window.location.reload():window.location.href=e})}function dynLoadOnPopState(e){if(e.state&&(console.log("Popstate",e.state),e.state.data&&dynLoadOnData(e.state,!0)||dynLoadSwitchToURL(e.state.url||window.location.href,!0),e.state.scrollPos)){window.scrollTo(e.state.scrollPos[0],e.state.scrollPos[1]);return}console.error("Couldn't handle state. ",e.state),window.location.reload()}PopStateHandlers.dynLoad=dynLoadOnPopState,dynLoadReplaceAnchors();// @license-end
//# sourceMappingURL=dynload.js.map
