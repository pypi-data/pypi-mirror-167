"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_events_eventReplay_replayContent_tsx-app_components_replays_utils_tsx-app_util-9af4f3"],{"./app/components/events/eventReplay/replayContent.tsx":(e,t,n)=>{n.r(t),n.d(t,{default:()=>y});var r=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=(n("../node_modules/core-js/modules/es.error.cause.js"),n("./app/components/dateTime.tsx")),a=n("./app/components/duration.tsx"),l=n("./app/components/placeholder.tsx"),i=n("./app/components/replays/replayContext.tsx"),o=n("./app/components/replays/replayView.tsx"),c=n("./app/locale.tsx"),u=n("./app/styles/space.tsx"),d=n("./app/utils/replays/hooks/useFullscreen.tsx"),m=n("./app/utils/replays/hooks/useReplayData.tsx"),p=n("./app/views/replays/detail/layout/fluidHeight.tsx"),f=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function g(e){let{orgSlug:t,replaySlug:n}=e;const{fetching:r,replay:l,fetchError:u}=(0,m.Z)({orgSlug:t,replaySlug:n}),{ref:p,toggle:g}=(0,d.Z)();if(u)throw new Error("Failed to load Replay");const y=null==l?void 0:l.getReplay();return r||!y?(0,f.tZ)(v,{height:"400px",width:"100%"}):(0,f.tZ)("table",{className:"table key-value",children:(0,f.BX)("tbody",{children:[(0,f.BX)("tr",{children:[(0,f.tZ)("td",{className:"key",children:(0,c.t)("Replay")}),(0,f.tZ)("td",{className:"value",children:(0,f.tZ)(i.z,{replay:l,initialTimeOffset:0,children:(0,f.tZ)(h,{ref:p,children:(0,f.tZ)(o.Z,{toggleFullscreen:g,showAddressBar:!1})})})})]},"replay"),(0,f.BX)("tr",{children:[(0,f.tZ)("td",{className:"key",children:(0,c.t)("Id")}),(0,f.tZ)("td",{className:"value",children:(0,f.tZ)("pre",{className:"val-string",children:y.id})})]},"id"),(0,f.BX)("tr",{children:[(0,f.tZ)("td",{className:"key",children:(0,c.t)("URL")}),(0,f.tZ)("td",{className:"value",children:(0,f.tZ)("pre",{className:"val-string",children:y.urls[0]})})]},"url"),(0,f.BX)("tr",{children:[(0,f.tZ)("td",{className:"key",children:(0,c.t)("Timestamp")}),(0,f.tZ)("td",{className:"value",children:(0,f.tZ)("pre",{className:"val-string",children:(0,f.tZ)(s.Z,{year:!0,seconds:!0,utc:!0,date:y.startedAt})})})]},"timestamp"),(0,f.BX)("tr",{children:[(0,f.tZ)("td",{className:"key",children:(0,c.t)("Duration")}),(0,f.tZ)("td",{className:"value",children:(0,f.tZ)("pre",{className:"val-string",children:(0,f.tZ)(a.Z,{seconds:y.duration/1e3,fixedDigits:0})})})]},"duration")]})})}g.displayName="ReplayContent";const h=(0,r.Z)(p.Z,{target:"edkm01g1"})("margin-bottom:",(0,u.Z)(2),";background:",(e=>e.theme.background),";"),v=(0,r.Z)(l.Z,{target:"edkm01g0"})("margin-top:",(0,u.Z)(2),";"),y=g},"./app/components/replays/replayContext.tsx":(e,t,n)=>{n.d(t,{z:()=>g,M:()=>h}),n("../node_modules/core-js/modules/web.dom-collections.iterator.js");var r=n("../node_modules/react/index.js"),s=n("../node_modules/@emotion/react/dist/emotion-element-cbed451f.browser.esm.js"),a=n("../node_modules/rrweb/es/rrweb/packages/rrweb/src/replay/index.js"),l=n("../node_modules/rrweb/es/rrweb/packages/rrweb/src/types.js"),i=n("./app/utils/localStorage.tsx");const o=new Map;function c(e){let{replayer:t,nodeId:n}=e;if(!o.has(n))return!1;const r=o.get(n);return!(!r||!t.wrapper.contains(r.canvas)||(t.wrapper.removeChild(r.canvas),o.delete(n),0))}var u,d=n("./app/utils/usePrevious.tsx"),m=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");!function(e){e.ReplayConfig="replay-config"}(u||(u={}));const p=r.createContext({clearAllHighlights:()=>{},currentHoverTime:void 0,currentTime:0,dimensions:{height:0,width:0},fastForwardSpeed:0,highlight:()=>{},initRoot:()=>{},isBuffering:!1,isFinished:!1,isPlaying:!1,isSkippingInactive:!0,removeHighlight:()=>{},replay:null,restart:()=>{},setCurrentHoverTime:()=>{},setCurrentTime:()=>{},setSpeed:()=>{},speed:1,togglePlayPause:()=>{},toggleSkipInactive:()=>{}});function f(e){i.Z.setItem(u.ReplayConfig,JSON.stringify(e))}function g(e){var t,n;let{children:g,replay:h,initialTimeOffset:v=0,value:y={}}=e;const b=null==h?void 0:h.getRRWebEvents(),w=(0,r.useRef)(JSON.parse(i.Z.getItem(u.ReplayConfig)||"{}")),k=(0,s.a)(),S=(0,d.Z)(b),T=b!==S,x=(0,r.useRef)(null),[C,F]=(0,r.useState)({height:0,width:0}),[N,Z]=(0,r.useState)(),[E,R]=(0,r.useState)(!1),[I,j]=(0,r.useState)(-1),[_,A]=(0,r.useState)(null===(t=w.current.skip)||void 0===t||t),[M,D]=(0,r.useState)(w.current.speed||1),[P,B]=(0,r.useState)(0),[O,q]=(0,r.useState)({target:-1,previous:-1}),z=(0,r.useRef)(void 0),H=(0,r.useRef)(!1),L=(null===(n=x.current)||void 0===n?void 0:n.getCurrentTime())===I,U=e=>{F(e)},$=e=>{B(e.speed)},X=()=>{B(0)},W=(0,r.useCallback)((e=>{let{nodeId:t,annotation:n}=e;const r=x.current;r&&function(e){var t,n;let{replayer:r,nodeId:s,annotation:a="",color:l}=e;const{mouseTail:i,wrapper:c}=r,u=r.getMirror().getNode(s);if(!u||null===(t=r.iframe.contentDocument)||void 0===t||null===(n=t.body)||void 0===n||!n.contains(u))return null;const{top:d,left:m,width:p,height:f}=u.getBoundingClientRect(),g=null!=l?l:"rgba(168, 196, 236, 0.75)",h=i.cloneNode(),v=h.getContext("2d");if(!v)return null;v.fillStyle=g,v.fillRect(m,d,p,f),v.beginPath(),v.setLineDash([5,5]),v.moveTo(m,d),v.lineTo(m+p,d),v.lineTo(m+p,d+f),v.lineTo(m,d+f),v.closePath(),v.stroke(),v.font="24px Rubik",v.textAlign="right",v.textBaseline="bottom";const y=v.measureText(a).width;v.fillStyle="rgba(30, 30, 30, 0.75)",v.fillRect(m+p-y,d+f-30,y,30),v.fillStyle="white",v.fillText(a,m+p,d+f),o.set(s,{canvas:h}),c.insertBefore(h,i)}({replayer:r,nodeId:t,annotation:n})}),[]),G=(0,r.useCallback)((()=>{const e=x.current;e&&function(e){let{replayer:t}=e;for(const e of o.keys())c({replayer:t,nodeId:e})}({replayer:e})}),[]),J=(0,r.useCallback)((e=>{let{nodeId:t}=e;const n=x.current;n&&c({replayer:n,nodeId:t})}),[]),V=(0,r.useCallback)((()=>{var e,t;j(null!==(e=null===(t=x.current)||void 0===t?void 0:t.getCurrentTime())&&void 0!==e?e:-1),R(!1)}),[]),K=(0,r.useCallback)((e=>{var t;if(void 0===b)return;if(null===e)return;if(x.current){var n;if(!T&&!H.current)return;if(0===(null===(n=x.current.iframe.contentDocument)||void 0===n?void 0:n.body.childElementCount))return;for(;e.firstChild;)e.removeChild(e.firstChild)}const r=new a.x(b,{root:e,blockClass:"sr-block",mouseTail:{duration:750,lineCap:"round",lineWidth:2,strokeStyle:k.purple200},skipInactive:null===(t=w.current.skip)||void 0===t||t,speed:w.current.speed||1});r.on(l.SA.Resize,U),r.on(l.SA.Finish,V),r.on(l.SA.SkipStart,$),r.on(l.SA.SkipEnd,X),x.current=r,H.current&&(H.current=!1)}),[b,k.purple200,V,T]);(0,r.useEffect)((()=>{const e=()=>{var e;"visible"!==document.visibilityState&&(null===(e=x.current)||void 0===e||e.pause())};return x.current&&b&&(K(x.current.wrapper.parentElement),document.addEventListener("visibilitychange",e)),()=>{document.removeEventListener("visibilitychange",e)}}),[K,b]);const Q=(0,r.useCallback)((()=>x.current?Math.max(x.current.getCurrentTime(),0):0),[]),Y=(0,r.useCallback)((e=>{var t;const n=x.current;if(!n)return;const r=e>(null===(t=x.current)||void 0===t?void 0:t.getMetaData().totalTime)?0:e;q({target:r,previous:Q()}),z.current&&window.clearTimeout(z.current),E?(z.current=window.setTimeout((()=>n.play(r)),0),R(!0)):(z.current=window.setTimeout((()=>n.pause(r)),0),R(!1))}),[Q,E]),ee=(0,r.useCallback)((e=>{const t=x.current;w.current={...w.current,speed:e},f(w.current),t&&(E?(t.pause(),t.setConfig({speed:e}),t.play(Q())):t.setConfig({speed:e}),D(e))}),[Q,E]),te=(0,r.useCallback)((e=>{const t=x.current;t&&(e?t.play(Q()):t.pause(Q()),R(e))}),[Q]),ne=(0,r.useCallback)((()=>{x.current&&(x.current.play(0),R(!0))}),[]),re=(0,r.useCallback)((e=>{const t=x.current;w.current={...w.current,skip:e},f(w.current),t&&(e!==t.config.skipInactive&&t.setConfig({skipInactive:e}),A(e))}),[]);(0,r.useEffect)((()=>(v&&b&&x.current&&Y(1e3*v),()=>{H.current=!0})),[b,x.current]);const se=function(e){const[t,n]=(0,r.useState)(0);return function(e){(0,r.useEffect)((()=>{const t=window.requestAnimationFrame(e);return()=>window.cancelAnimationFrame(t)}),[e])}((()=>n(e))),t}(Q),[ae,le]=-1!==O.target&&O.previous===se&&O.target!==O.previous?[!0,O.target]:[!1,se];return ae||-1===O.target||q({target:-1,previous:-1}),(0,m.tZ)(p.Provider,{value:{clearAllHighlights:G,currentHoverTime:N,currentTime:le,dimensions:C,fastForwardSpeed:P,highlight:W,initRoot:K,isBuffering:ae,isFinished:L,isPlaying:E,isSkippingInactive:_,removeHighlight:J,replay:h,restart:ne,setCurrentHoverTime:Z,setCurrentTime:Y,setSpeed:ee,speed:M,togglePlayPause:te,toggleSkipInactive:re,...y},children:g})}g.displayName="Provider";const h=()=>(0,r.useContext)(p)},"./app/components/replays/utils.tsx":(e,t,n)=>{n.d(t,{DF:()=>u,DR:()=>d,NH:()=>i,PE:()=>p,Ul:()=>o,cs:()=>f,mr:()=>c}),n("../node_modules/core-js/modules/web.dom-collections.iterator.js");var r=n("../node_modules/lodash/padStart.js"),s=n.n(r);function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const n=String(e);return s()(n,t,"0")}const l=36e5;function i(e,t){return Math.abs(new Date(e).getTime()-t)}function o(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return c(i(e,t),n)}function c(e,t){if(e<=0||isNaN(e))return t?"00:00.000":"00:00";const n=Math.floor(e/l);e%=l;const r=Math.floor(e/6e4);e%=6e4;const s=Math.floor(e/1e3);let i="00:00";return i=n?`${a(n)}:${a(r)}:${a(s)}`:`${a(r)}:${a(s)}`,t&&(i=`${i}.${a(Math.floor(e%1e3),3)}`),i}function u(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,r=Math.floor(t/n);const s=e-r*t>0?1:0;r-=s;const a=[1*l,18e5,12e5,9e5,6e5,3e5,12e4,6e4,3e4,1e4,5e3,1e3],i=a.reduce(((t,n)=>(t.set(n,Math.floor(e/n)),t)),new Map),[o,c]=Array.from(i.entries()).filter((e=>{let[t,n]=e;return n<=r})).reduce(((e,t)=>t[1]>e[1]?t:e),[0,0]),u=(e-o*c)/o;return{timespan:o,cols:c,remaining:u}}function d(e,t,n,r){const s=isNaN(t)?1:t;return n.map((t=>{const{timestamp:n}=t,a=+new Date(String(n)),l=isNaN(a)?0:a-e,i=Math.floor(l/s*(r-1))+1;return[Math.max(1,i),t]})).reduce(((e,t)=>{let[n,r]=t;var s;return e.has(n)?null===(s=e.get(n))||void 0===s||s.push(r):e.set(n,[r]),e}),new Map)}function m(e,t){const n=e.startTimestamp<=t.startTimestamp&&t.startTimestamp<=e.endTimestamp,r=e.startTimestamp<=t.endTimestamp&&t.endTimestamp<=e.endTimestamp;return n||r}function p(e){if(!e.length)return[];const t=e.map((e=>{const t=1e3*e.startTimestamp,n=1e3*e.endTimestamp;return{spanCount:1,startTimestamp:t,endTimestamp:n,duration:n-t}})),[n,...r]=t,s=[n];for(const e of r){let t=!1;for(const n of s)if(m(n,e)){t=!0,n.spanCount+=1,n.startTimestamp=Math.min(n.startTimestamp,e.startTimestamp),n.endTimestamp=Math.max(n.endTimestamp,e.endTimestamp),n.duration=n.endTimestamp-n.startTimestamp;break}t||s.push(e)}return s}function f(e,t){return void 0===t||isNaN(t)||0===t?0:e/t}},"./app/utils/replays/replayDataUtils.tsx":(e,t,n)=>{n.d(t,{_O:()=>d,ay:()=>c,iz:()=>m,qC:()=>o,so:()=>u}),n("../node_modules/core-js/modules/es.array.includes.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js");var r=n("../node_modules/lodash/first.js"),s=n.n(r),a=n("./app/components/events/interfaces/breadcrumbs/utils.tsx"),l=n("./app/locale.tsx"),i=n("./app/types/breadcrumbs.tsx");function o(e){return{...e,...e.startedAt?{startedAt:new Date(e.startedAt)}:{},...e.finishedAt?{finishedAt:new Date(e.finishedAt)}:{}}}function c(e,t){const n=[].concat(t).concat({type:5,timestamp:e.finishedAt.getTime(),data:{tag:"replay-end"}});return n.sort(((e,t)=>e.timestamp-t.timestamp)),s()(n).timestamp=e.startedAt.getTime(),n}function u(e,t,n,r){var s;const o=null===(s=e.tags.url)||void 0===s?void 0:s.join(", "),c={type:i.kS.INIT,timestamp:e.startedAt.toISOString(),level:i.nU.INFO,message:o,data:{action:"replay-init",label:(0,l.t)("Start recording"),url:o}},u=t.map((e=>({type:i.kS.ERROR,level:i.nU.ERROR,category:"exception",message:e["error.value"],data:{label:e["error.type"]},timestamp:e.timestamp}))),d=r.filter((e=>["navigation.navigate","navigation.reload","largest-contentful-paint"].includes(e.op))).map((e=>{if(e.op.startsWith("navigation")){const[,t]=e.op.split(".");return{category:"default",type:i.kS.NAVIGATION,timestamp:new Date(1e3*e.startTimestamp).toISOString(),level:i.nU.INFO,message:e.description,action:t,data:{to:e.description,label:"reload"===t?(0,l.t)("Reload"):"navigate"===t?(0,l.t)("Page load"):(0,l.t)("Navigation"),...e.data}}}return{type:i.kS.DEBUG,timestamp:new Date(1e3*e.startTimestamp).toISOString(),level:i.nU.INFO,category:"default",data:{action:e.op,...e.data,label:"largest-contentful-paint"===e.op?(0,l.t)("LCP"):e.op}}})),m=r.find((e=>"navigation.navigate"===e.op));return(0,a.LP)([...m?[]:[c],...n.map((e=>{let{timestamp:t,...n}=e;return{...n,type:i.kS.DEFAULT,timestamp:new Date(1e3*t).toISOString()}})),...u,...d]).sort(((e,t)=>+new Date(e.timestamp||0)-+new Date(t.timestamp||0)))}function d(e){return e.sort(((e,t)=>e.startTimestamp-t.startTimestamp))}function m(e,t,n){const r=e.map((e=>e.timestamp)),s=t.map((e=>e.timestamp)).filter(Boolean).map((e=>+new Date(1e3*e))),a=n.map((e=>1e3*e.startTimestamp)),l=n.map((e=>1e3*e.endTimestamp));return{startTimestampMs:Math.min(...r,...s,...a),endTimestampMs:Math.max(...r,...s,...l)}}},"../node_modules/screenfull/index.js":(e,t,n)=>{n.d(t,{Z:()=>i});const r=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],s=(()=>{if("undefined"==typeof document)return!1;const e=r[0],t={};for(const n of r){const r=n?.[1];if(r in document){for(const[r,s]of n.entries())t[e[r]]=s;return t}}return!1})(),a={change:s.fullscreenchange,error:s.fullscreenerror};let l={request:(e=document.documentElement,t)=>new Promise(((n,r)=>{const a=()=>{l.off("change",a),n()};l.on("change",a);const i=e[s.requestFullscreen](t);i instanceof Promise&&i.then(a).catch(r)})),exit:()=>new Promise(((e,t)=>{if(!l.isFullscreen)return void e();const n=()=>{l.off("change",n),e()};l.on("change",n);const r=document[s.exitFullscreen]();r instanceof Promise&&r.then(n).catch(t)})),toggle:(e,t)=>l.isFullscreen?l.exit():l.request(e,t),onchange(e){l.on("change",e)},onerror(e){l.on("error",e)},on(e,t){const n=a[e];n&&document.addEventListener(n,t,!1)},off(e,t){const n=a[e];n&&document.removeEventListener(n,t,!1)},raw:s};Object.defineProperties(l,{isFullscreen:{get:()=>Boolean(document[s.fullscreenElement])},element:{enumerable:!0,get:()=>document[s.fullscreenElement]??void 0},isEnabled:{enumerable:!0,get:()=>Boolean(document[s.fullscreenEnabled])}}),s||(l={isEnabled:!1});const i=l}}]);
//# sourceMappingURL=../sourcemaps/app_components_events_eventReplay_replayContent_tsx-app_components_replays_utils_tsx-app_util-9af4f3.4f57816431dea896127dc8aef2118d4c.js.map