"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_dashboardsV2_widgetBuilder_index_tsx"],{"./app/components/featureFeedback/index.tsx":(e,t,i)=>{i.d(t,{z:()=>d}),i("../node_modules/core-js/modules/web.dom-collections.iterator.js");var s=i("./app/actionCreators/modal.tsx"),a=i("./app/components/button.tsx"),r=i("./app/icons/index.tsx"),n=i("./app/locale.tsx"),o=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function d(e){let{feedbackTypes:t,featureName:d,buttonProps:l={}}=e;return(0,o.tZ)(a.ZP,{icon:(0,o.tZ)(r.I8,{}),onClick:async function(){const e=await i.e("app_components_featureFeedback_feedbackModal_tsx").then(i.bind(i,"./app/components/featureFeedback/feedbackModal.tsx")),{FeedbackModal:a,modalCss:r}=e;(0,s.openModal)((e=>(0,o.tZ)(a,{...e,featureName:d,feedbackTypes:t})),{modalCss:r})},...l,children:(0,n.t)("Give Feedback")})}d.displayName="FeatureFeedback"},"./app/views/dashboardsV2/widgetBuilder/index.tsx":(e,t,i)=>{i.r(t),i.d(t,{default:()=>It});var s=i("./app/components/acl/feature.tsx"),a=i("./app/components/alert.tsx"),r=i("./app/locale.tsx"),n=i("./app/styles/organization.tsx"),o=i("./app/utils/useOrganization.tsx"),d=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),l=(i("../node_modules/core-js/modules/es.array.includes.js"),i("../node_modules/core-js/modules/web.dom-collections.iterator.js"),i("../node_modules/react/index.js")),u=i("../node_modules/lodash/cloneDeep.js"),c=i.n(u),p=i("../node_modules/lodash/isEmpty.js"),g=i.n(p),m=i("../node_modules/lodash/omit.js"),h=i.n(m),y=i("../node_modules/lodash/set.js"),f=i.n(y),b=i("./app/actionCreators/dashboards.tsx"),v=i("./app/actionCreators/indicator.tsx"),Z=i("./app/actionCreators/members.tsx"),w=i("./app/actionCreators/tags.tsx"),T=i("./app/components/datePageFilter.tsx"),x=i("./app/components/environmentPageFilter.tsx"),E=i("./app/components/layouts/thirds.tsx"),S=i("./app/components/list/index.tsx"),O=i("./app/components/list/listItem.tsx"),q=i("./app/components/loadingError.tsx"),C=i("./app/components/organizations/pageFilterBar.tsx"),F=i("./app/components/organizations/pageFilters/container.tsx"),A=i("./app/components/projectPageFilter.tsx"),k=i("./app/components/sentryDocumentTitle.tsx"),_=i("./app/styles/space.tsx"),B=i("./app/utils.tsx"),R=i("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),L=i("./app/utils/customMeasurements/customMeasurementsProvider.tsx"),D=i("./app/utils/discover/eventView.tsx"),N=i("./app/utils/discover/fields.tsx"),I=i("./app/utils/handleXhrErrorResponse.tsx"),z=i("./app/utils/performance/contexts/metricsCardinality.tsx"),P=i("./app/utils/performance/contexts/metricsEnhancedSetting.tsx"),M=i("./app/utils/useApi.tsx"),j=i("./app/utils/withPageFilters.tsx"),V=i("./app/utils/withTags.tsx"),W=i("./app/views/dashboardsV2/layoutUtils.tsx"),U=i("./app/views/dashboardsV2/types.tsx"),H=i("./app/views/performance/landing/metricsDataSwitcher.tsx"),X=i("./app/views/dashboardsV2/data.tsx"),G=i("./app/views/dashboardsV2/datasetConfig/base.tsx"),Q=i("./app/views/dashboardsV2/widgetCard/dashboardsMEPContext.tsx"),$=i("./app/components/links/externalLink.tsx"),Y=(i("../node_modules/core-js/modules/es.error.cause.js"),i("./app/utils/customMeasurements/customMeasurementsContext.tsx"));function J(){const e=(0,l.useContext)(Y.z);if(!e)throw new Error("useCustomMeasurements was called outside of CustomMeasurementsProvider");return e}var K=i("./app/views/dashboardsV2/widgetBuilder/utils.tsx"),ee=i("./app/views/dashboardsV2/widgetBuilder/buildSteps/buildStep.tsx"),te=i("./app/components/forms/field/index.tsx"),ie=i("./app/views/eventsV2/table/columnEditCollection.tsx"),se=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function ae(e){var t;let{displayType:i,fieldOptions:s,widgetType:a,fields:r,organization:n,errors:o,onChange:d,filterAggregateParameters:l,filterPrimaryOptions:u,noFieldsMessage:c}=e;return(0,se.tZ)(te.Z,{inline:!1,error:null==o||null===(t=o.find((e=>null==e?void 0:e.fields)))||void 0===t?void 0:t.fields,flexibleControlStateSize:!0,stacked:!0,children:i===U.FO.TABLE?(0,se.tZ)(re,{columns:r,onChange:d,fieldOptions:s,organization:n,source:a,showAliasField:!0,filterAggregateParameters:l,filterPrimaryOptions:u,noFieldsMessage:c}):(0,se.tZ)(re,{columns:r.slice(0,r.length-1),onChange:e=>{d([...e,r[r.length-1]])},fieldOptions:s,organization:n,source:a,filterPrimaryOptions:u,noFieldsMessage:c})})}ae.displayName="ColumnFields";const re=(0,d.Z)(ie.Z,{target:"e2w4m990"})("margin-top:",(0,_.Z)(1),";");function ne(e){let{dataSet:t,displayType:i,organization:s,widgetType:a,handleColumnFieldChange:n,queryErrors:o,explodedFields:d,tags:l}=e;const{customMeasurements:u}=J(),c=(0,G.v)(a);return(0,se.tZ)(ee.F,{title:(0,r.t)("Choose your columns"),description:t===K.qg.ISSUES?(0,r._N)("[fieldTagLink: Field and tag] columns will help you view more details about the issues (e.g., title).",{fieldTagLink:(0,se.tZ)($.Z,{href:"https://docs.sentry.io/product/sentry-basics/search/searchable-properties/#event-properties"})}):t===K.qg.RELEASES?(0,r._N)("To stack sessions, add [functionLink: functions] f(x) that may take in additional parameters. [fieldTagLink: Field and tag] columns will help you view more details about the sessions (e.g., releases).",{functionLink:(0,se.tZ)($.Z,{href:"https://docs.sentry.io/product/discover-queries/query-builder/#filter-by-table-columns"}),fieldTagLink:(0,se.tZ)($.Z,{href:"https://docs.sentry.io/product/sentry-basics/search/searchable-properties/#release-properties"})}):(0,r._N)("To stack events, add [functionLink: functions] f(x) that may take in additional parameters. [fieldTagLink: Field and tag] columns will help you view more details about the events (e.g., title).",{functionLink:(0,se.tZ)($.Z,{href:"https://docs.sentry.io/product/discover-queries/query-builder/#filter-by-table-columns"}),fieldTagLink:(0,se.tZ)($.Z,{href:"https://docs.sentry.io/product/sentry-basics/search/searchable-properties/#event-properties"})}),children:(0,se.tZ)(ae,{displayType:i,organization:s,widgetType:a,fields:d,errors:o,fieldOptions:c.getTableFieldOptions(s,l,u),filterAggregateParameters:c.filterAggregateParams,filterPrimaryOptions:c.filterTableOptions,onChange:n})})}ne.displayName="ColumnsStep";var oe=i("./app/components/featureBadge.tsx"),de=i("./app/components/forms/controls/radioGroup.tsx");const le=[[K.qg.EVENTS,(0,r.t)("Errors and Transactions")],[K.qg.ISSUES,(0,r.t)("Issues (States, Assignment, Time, etc.)")]];function ue(e){let{dataSet:t,onChange:i,hasReleaseHealthFeature:s,displayType:a}=e;const n=[];return a!==U.FO.TABLE&&(n.push([K.qg.ISSUES,(0,r.t)("This dataset is restricted to tabular visualization.")]),a===U.FO.WORLD_MAP&&n.push([K.qg.RELEASES,(0,r.t)("This dataset is restricted to big number, tabular and time series visualizations.")])),(0,se.tZ)(ee.F,{title:(0,r.t)("Choose your dataset"),description:(0,r._N)("This reflects the type of information you want to use. To learn more, [link: read the docs].",{link:(0,se.tZ)($.Z,{href:"https://docs.sentry.io/product/dashboards/widget-builder/#choose-your-dataset"})}),children:(0,se.tZ)(ce,{label:"dataSet",value:t,choices:s?[...le,[K.qg.RELEASES,(0,se.BX)(l.Fragment,{children:[(0,r.t)("Releases (Sessions, Crash rates)")," ",(0,se.tZ)(oe.Z,{type:"new"})]},"releases-dataset")]]:le,disabledChoices:n,onChange:e=>{i(e)}})})}ue.displayName="DataSetStep";const ce=(0,d.Z)(de.Z,{target:"e1eujfdx0"})("display:flex;flex-wrap:wrap;gap:",(0,_.Z)(2),";");var pe=i("./app/components/button.tsx"),ge=i("./app/components/buttonBar.tsx"),me=i("./app/components/input.tsx"),he=i("./app/icons/index.tsx"),ye=i("./app/utils/queryString.tsx"),fe=i("./app/utils/releases/releasesProvider.tsx"),be=i("./app/views/dashboardsV2/releasesSelectControl.tsx");function ve(e){var t;let{canAddSearchConditions:i,dashboardFilters:a,location:n,queries:o,onQueryRemove:d,onAddSearchConditions:u,onQueryChange:c,organization:p,hideLegendAlias:g,queryErrors:m,widgetType:h,selection:y}=e;const f=(0,l.useCallback)((e=>t=>{const i={...o[e],conditions:t};c(e,i)}),[c,o]),b=(0,l.useCallback)((e=>t=>{const i={...o[e],conditions:t};c(e,i)}),[c,o]),v=(0,G.v)(h);return(0,se.BX)(ee.F,{title:(0,r.t)("Filter your results"),description:i?(0,r.t)("This is how you filter down your search. You can add multiple queries to compare data for each overlay."):(0,r.t)("This is how you filter down your search."),children:[(0,se.BX)(s.Z,{features:["dashboards-top-level-filter"],children:[(0,se.BX)(Te,{children:[(0,se.tZ)(A.Z,{disabled:!0}),(0,se.tZ)(x.Z,{disabled:!0}),(0,se.tZ)(T.Z,{alignDropdown:"left",disabled:!0})]}),(0,se.tZ)(xe,{children:(0,se.tZ)(fe.lR,{organization:p,selection:y,children:(0,se.tZ)(Ee,{selectedReleases:null!==(t=U.qA.RELEASE in n.query?(0,ye.qP)(n.query[U.qA.RELEASE]):null==a?void 0:a[U.qA.RELEASE])&&void 0!==t?t:[],isDisabled:!0,className:"widget-release-select"})})})]}),(0,se.BX)("div",{children:[o.map(((e,t)=>{var i;return(0,se.tZ)(we,{inline:!1,flexibleControlStateSize:!0,stacked:!0,error:null==m||null===(i=m[t])||void 0===i?void 0:i.conditions,children:(0,se.BX)(Se,{children:[(0,se.tZ)(v.SearchBar,{organization:p,pageFilters:y,onClose:b(t),onSearch:f(t),widgetQuery:e}),!g&&(0,se.tZ)(Ze,{type:"text",name:"name",value:e.name,placeholder:(0,r.t)("Legend Alias"),onChange:e=>{const i={...o[t],name:e.target.value};c(t,i)}}),o.length>1&&(0,se.tZ)(pe.ZP,{size:"zero",borderless:!0,onClick:()=>d(t),icon:(0,se.tZ)(he.Fz,{}),title:(0,r.t)("Remove query"),"aria-label":(0,r.t)("Remove query")})]})},t)})),i&&(0,se.tZ)(pe.ZP,{size:"sm",icon:(0,se.tZ)(he.N_,{isCircled:!0}),onClick:u,children:(0,r.t)("Add Query")})]})]})}ve.displayName="FilterResultsStep";const Ze=(0,d.Z)(me.Z,{target:"e12061i95"})({name:"1f6lq61",styles:"width:33%"}),we=(0,d.Z)(te.Z,{target:"e12061i94"})("padding-bottom:",(0,_.Z)(1),";"),Te=(0,d.Z)(C.Z,{target:"e12061i93"})("margin-bottom:",(0,_.Z)(1),";margin-right:",(0,_.Z)(2),";"),xe=(0,d.Z)(ge.ZP,{target:"e12061i92"})("grid-template-columns:1fr;margin-bottom:",(0,_.Z)(1),";margin-right:",(0,_.Z)(2),";justify-content:space-between;"),Ee=(0,d.Z)(be.Z,{target:"e12061i91"})({name:"f0iau4",styles:"button{width:100%;}"}),Se=(0,d.Z)("div",{target:"e12061i90"})("display:flex;align-items:center;>*+*{margin-left:",(0,_.Z)(1),";}");var Oe=i("../node_modules/@dnd-kit/core/dist/core.esm.js"),qe=i("../node_modules/@dnd-kit/sortable/dist/sortable.esm.js"),Ce=i("./app/views/eventsV2/table/types.tsx"),Fe=i("./app/views/eventsV2/table/queryField.tsx");function Ae(e){let{onDelete:t,onChange:i,fieldOptions:s,value:a,forwardRef:n,listeners:o,attributes:d,canDelete:u,canDrag:c,style:p,isDragging:g}=e;return(0,se.tZ)(_e,{ref:n,style:p,children:g?null:(0,se.BX)(l.Fragment,{children:[c&&(0,se.tZ)(ke,{...o,...d,"aria-label":(0,r.t)("Drag to reorder"),icon:(0,se.tZ)(he.LS,{size:"xs"}),size:"zero",borderless:!0}),(0,se.tZ)(Fe.q,{placeholder:(0,r.t)("Select group"),fieldValue:a,fieldOptions:s,onChange:i,filterPrimaryOptions:e=>e.value.kind!==Ce.L.FUNCTION}),u&&(0,se.tZ)(pe.ZP,{size:"zero",borderless:!0,onClick:t,icon:(0,se.tZ)(he.Fz,{}),title:(0,r.t)("Remove group"),"aria-label":(0,r.t)("Remove group")})]})})}Ae.displayName="QueryField";const ke=(0,d.Z)(pe.ZP,{target:"epp8h3j1"})({name:"1k18kha",styles:"height:40px"}),_e=(0,d.Z)("div",{target:"epp8h3j0"})("display:flex;align-items:center;justify-content:space-between;width:100%;>*+*{margin-left:",(0,_.Z)(1),";}");var Be=i("../node_modules/@dnd-kit/utilities/dist/utilities.esm.js"),Re=i("../node_modules/@emotion/react/dist/emotion-element-cbed451f.browser.esm.js");function Le(e){let{dragId:t,...i}=e;const s=(0,Re.a)(),{listeners:a,setNodeRef:r,transform:n,transition:o,attributes:d,isDragging:l}=(0,qe.nB)({id:t,transition:null});let u={transform:Be.ux.Transform.toString(n),transition:o,zIndex:"auto"};return l&&(u={...u,zIndex:100,height:"40px",border:`2px dashed ${s.border}`,borderRadius:s.borderRadius}),(0,se.tZ)(Ae,{forwardRef:r,listeners:a,attributes:d,isDragging:l,style:u,...i})}Le.displayName="SortableQueryField";const De={kind:Ce.L.FIELD,field:""};function Ne(e){var t;let{fieldOptions:i,columns:s=[],onChange:a}=e;const[n,o]=(0,l.useState)(null);function d(e,t){const i=[...s];0===s.length?i.push(e):(0,B.ri)(t)&&(i[t]=e),a(i)}const u=1===s.length&&s[0].kind===Ce.L.FIELD&&""!==(null===(t=s[0])||void 0===t?void 0:t.field),c=s.length>1,p=c||u,g=s.map(N.sN),{filteredFieldOptions:m,columnsAsFieldOptions:h}=(0,l.useMemo)((()=>Object.keys(i).reduce(((e,t)=>{const s=i[t],a=g.findIndex((e=>e===s.value.meta.name));return-1===a?(e.filteredFieldOptions[t]=s,e):(e.columnsAsFieldOptions[a]={[t]:s},e)}),{filteredFieldOptions:{},columnsAsFieldOptions:[]})),[i,s]),y=(0,l.useMemo)((()=>s.reduce(((e,t,i)=>(e.push(String(i)),e)),[])),[s]);return(0,se.BX)(l.Fragment,{children:[(0,se.tZ)(Ie,{inline:!1,flexibleControlStateSize:!0,stacked:!0,children:0===s.length?(0,se.tZ)(Ae,{value:De,fieldOptions:m,onChange:e=>d(e,0),canDelete:p}):(0,se.BX)(Oe.LB,{collisionDetection:Oe.pE,onDragStart:e=>{let{active:t}=e;o(t.id)},onDragEnd:e=>{let{over:t,active:i}=e;if(o(null),t){const e=y.indexOf.bind(y),r=e(i.id),n=e(t.id);r!==n&&a((0,qe.Rp)(s,r,n))}},onDragCancel:()=>{o(null)},children:[(0,se.tZ)(qe.Fo,{items:y,strategy:qe.qw,children:(0,se.tZ)(Pe,{children:s.map(((e,t)=>(0,se.tZ)(Le,{dragId:y[t],value:e,fieldOptions:{...m,...h[t]},onChange:e=>d(e,t),onDelete:()=>function(e){const t=[...s];t.splice(e,1),a(t)}(t),canDrag:c,canDelete:p},y[t])))})}),(0,se.tZ)(Oe.y9,{dropAnimation:null,children:n?(0,se.tZ)(Me,{children:(0,se.tZ)(Ae,{value:s[Number(n)],fieldOptions:{...m,...h[Number(n)]},onChange:e=>d(e,Number(n)),canDrag:c,canDelete:p})}):null})]})}),s.length<20&&(0,se.tZ)(ze,{size:"sm",icon:(0,se.tZ)(he.N_,{isCircled:!0}),onClick:function(){const e=0===s.length?[{...De},{...De}]:[...s,{...De}];a(e)},children:(0,r.t)("Add Group")})]})}Ne.displayName="GroupBySelector";const Ie=(0,d.Z)(te.Z,{target:"esrd23w3"})("padding-bottom:",(0,_.Z)(1),";"),ze=(0,d.Z)(pe.ZP,{target:"esrd23w2"})({name:"b9l38d",styles:"width:min-content"}),Pe=(0,d.Z)("div",{target:"esrd23w1"})("display:grid;grid-auto-flow:row;gap:",(0,_.Z)(1),";"),Me=(0,d.Z)("div",{target:"esrd23w0"})("position:absolute;background:",(e=>e.theme.background),";padding:",(0,_.Z)(.5),";border-radius:",(e=>e.theme.borderRadius),";box-shadow:0 0 15px rgba(0, 0, 0, 0.15);opacity:0.8;cursor:grabbing;padding-right:",(0,_.Z)(2),";width:100%;button{cursor:grabbing;}@media (min-width: ",(e=>e.theme.breakpoints.small),"){width:710px;}");function je(e){let{dataSet:t,columns:i,onGroupByChange:s,organization:a,tags:n}=e;const o=(0,G.v)(qt[t]);return(0,se.tZ)(ee.F,{title:(0,r.t)("Group your results"),description:(0,r.t)("This is how you can group your data result by field or tag."),children:(0,se.tZ)(Ne,{columns:i,fieldOptions:o.getGroupByFieldOptions?o.getGroupByFieldOptions(a,n):{},onChange:s})})}je.displayName="GroupByStep";var Ve=i("./app/views/dashboardsV2/widgetBuilder/buildSteps/sortByStep/index.tsx"),We=i("../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),Ue=i("../node_modules/lodash/debounce.js"),He=i.n(Ue),Xe=i("../node_modules/lodash/isEqual.js"),Ge=i.n(Xe),Qe=i("./app/components/charts/simpleTableChart.tsx"),$e=i("./app/components/forms/selectControl.tsx"),Ye=i("./app/components/panels/index.tsx"),Je=i("./app/constants/index.tsx"),Ke=i("./app/utils/usePrevious.tsx"),et=i("./app/views/dashboardsV2/utils.tsx"),tt=i("./app/views/dashboardsV2/widgetCard/index.tsx");function it(e){var t;let{organization:i,pageFilters:s,displayType:a,error:n,onChange:o,widget:d,noDashboardsMEPProvider:u,dashboardFilters:c,location:p}=e;const[g,m]=(0,l.useState)(d),h=(0,Ke.Z)(d),y=(0,l.useCallback)(He()(((e,t)=>{t||m(e)}),Je.Dk),[]);(0,l.useEffect)((()=>{let e=!1;return Ge()(h,d)||y(d,e),()=>{e=!0}}),[d,h,y]);const f=Object.keys(K.hV).map((e=>({label:K.hV[e],value:e})));return(0,se.BX)(ee.F,{title:(0,r.t)("Choose your visualization"),description:(0,r.t)("This is a preview of how your widget will appear in the dashboard."),children:[(0,se.tZ)(te.Z,{error:n,inline:!1,flexibleControlStateSize:!0,stacked:!0,children:(0,se.tZ)($e.Z,{name:"displayType",options:f,value:a,onChange:e=>{o(e.value)},styles:{singleValue:e=>({...e,width:`calc(100% - ${(0,_.Z)(1)})`})}})}),(0,se.tZ)(st,{displayType:a,children:(0,se.tZ)(tt.Z,{organization:i,selection:s,widget:g,dashboardFilters:null!==(t=(0,et.lM)(p))&&void 0!==t?t:c,isEditing:!1,widgetLimitReached:!1,renderErrorMessage:e=>"string"==typeof e&&(0,se.tZ)(Ye.aU,{type:"error",children:e}),isSorting:!1,currentWidgetDragging:!1,noLazyLoad:!0,showStoredAlert:!0,noDashboardsMEPProvider:u})})]})}it.displayName="VisualizationStep";const st=(0,d.Z)("div",{target:"e1huhsf60"})("padding-right:",(0,_.Z)(2),";",tt._,"{height:initial;}",(e=>e.displayType===U.FO.TABLE&&(0,We.iv)("overflow:hidden;",Qe.p,"{height:41px;}",tt._,"{height:301px;}","")),";");function at(e){let{title:t,onAdd:i}=e;return(0,se.tZ)(pe.ZP,{size:"sm",onClick:i,icon:(0,se.tZ)(he.N_,{isCircled:!0}),children:t})}function rt(e){let{onDelete:t}=e;return(0,se.tZ)(pe.ZP,{size:"zero",borderless:!0,onClick:t,icon:(0,se.tZ)(he.Fz,{}),title:(0,r.t)("Remove this Y-Axis"),"aria-label":(0,r.t)("Remove this Y-Axis")})}function nt(e){var t;let{displayType:i,widgetType:s,aggregates:a,tags:n,onChange:d,errors:l,noFieldsMessage:u}=e;const c=(0,o.Z)(),p=(0,G.v)(s),{customMeasurements:g}=J(),m=null==l||null===(t=l.find((e=>null==e?void 0:e.aggregates)))||void 0===t?void 0:t.aggregates,h=a.length>1,y=[U.FO.WORLD_MAP,U.FO.BIG_NUMBER].includes(i)&&1===a.length||[U.FO.LINE,U.FO.AREA,U.FO.BAR].includes(i)&&3===a.length;return(0,se.BX)(te.Z,{inline:!1,flexibleControlStateSize:!0,error:m,stacked:!0,children:[a.map(((e,t)=>{var s,r;return(0,se.BX)(ot,{children:[(0,se.tZ)(Fe.q,{fieldValue:e,fieldOptions:p.getTableFieldOptions(c,n,g),onChange:e=>function(e,t){const i=[...a];i[t]=e,d(i)}(e,t),filterPrimaryOptions:null===(s=p.filterYAxisOptions)||void 0===s?void 0:s.call(p,i),filterAggregateParameters:null===(r=p.filterYAxisAggregateParams)||void 0===r?void 0:r.call(p,e,i),otherColumns:a,noFieldsMessage:u}),a.length>1&&(h||e.kind===Ce.L.EQUATION)&&(0,se.tZ)(rt,{onDelete:e=>function(e,t){e.preventDefault();const i=[...a];i.splice(t,1),d(i)}(e,t)})]},`${e}:${t}`)})),!y&&(0,se.BX)(dt,{gap:1,children:[(0,se.tZ)(at,{title:(0,r.t)("Add Overlay"),onAdd:function(e){e.preventDefault();const t=[...a,{kind:Ce.L.FIELD,field:""}];d(t)}}),p.enableEquations&&(0,se.tZ)(at,{title:(0,r.t)("Add an Equation"),onAdd:function(e){e.preventDefault();const t=[...a,{kind:Ce.L.EQUATION,field:""}];d(t)}})]})]})}at.displayName="AddButton",rt.displayName="DeleteButton",nt.displayName="YAxisSelector";const ot=(0,d.Z)("div",{target:"ew36myz1"})("display:flex;align-items:center;justify-content:space-between;:not(:last-child){margin-bottom:",(0,_.Z)(1),";}>*+*{margin-left:",(0,_.Z)(1),";}"),dt=(0,d.Z)(ge.ZP,{target:"ew36myz0"})({name:"11g6mpt",styles:"justify-content:flex-start"});function lt(e){let{displayType:t,queryErrors:i,aggregates:s,onYAxisChange:a,tags:n,widgetType:o}=e;return(0,se.tZ)(ee.F,{title:t===U.FO.BIG_NUMBER?(0,r.t)("Choose what to plot"):(0,r.t)("Choose what to plot in the y-axis"),description:[U.FO.AREA,U.FO.BAR,U.FO.LINE].includes(t)?(0,r.t)("This is the data you'd be visualizing in the display. If the overlay units conflict, the charts will always base it off of the first line."):(0,r.t)("This is the data you'd be visualizing in the display."),children:(0,se.tZ)(nt,{widgetType:o,displayType:t,aggregates:s,onChange:a,tags:n,errors:i})})}lt.displayName="YAxisStep";var ut=i("./app/components/confirm.tsx");function ct(e){let{goBackLocation:t,onSave:i,onDelete:s,invalidForm:a,isEditing:n}=e;return(0,se.tZ)(gt,{children:(0,se.BX)(pt,{gap:1,children:[(0,se.tZ)(pe.ZP,{to:t,children:(0,r.t)("Cancel")}),n&&s&&(0,se.tZ)(ut.Z,{priority:"danger",message:(0,r.t)("Are you sure you want to delete this widget?"),onConfirm:s,children:(0,se.tZ)(pe.ZP,{priority:"danger",children:(0,r.t)("Delete")})}),(0,se.tZ)(pe.ZP,{priority:"primary",onClick:i,disabled:a,title:a?(0,r.t)("Required fields must be filled out"):void 0,children:n?(0,r.t)("Update Widget"):(0,r.t)("Add Widget")})]})})}ct.displayName="Footer";const pt=(0,d.Z)(ge.ZP,{target:"e1golk021"})("justify-content:flex-end;max-width:1000px;padding:",(0,_.Z)(4)," ",(0,_.Z)(2),";padding-right:calc(",(0,_.Z)(2)," + ",(0,_.Z)(2),");@media (min-width: ",(e=>e.theme.breakpoints.medium),"){padding:",(0,_.Z)(4),";padding-right:calc(",(0,_.Z)(4)," + ",(0,_.Z)(2),");}"),gt=(0,d.Z)("div",{target:"e1golk020"})("background:",(e=>e.theme.background),";border-top:1px solid ",(e=>e.theme.gray200),";");var mt=i("./app/components/breadcrumbs.tsx"),ht=i("./app/components/editableText.tsx"),yt=i("./app/components/featureFeedback/index.tsx");function ft(e){let{title:t,orgSlug:i,goBackLocation:s,dashboardTitle:a,onChangeTitle:n}=e;return(0,se.BX)(E.h4,{children:[(0,se.BX)(E.oB,{children:[(0,se.tZ)(mt.Z,{crumbs:[{to:`/organizations/${i}/dashboards/`,label:(0,r.t)("Dashboards")},{to:s,label:a},{label:(0,r.t)("Widget Builder")}]}),(0,se.tZ)(E.Dx,{children:(0,se.tZ)(ht.Z,{"aria-label":(0,r.t)("Widget title"),value:t,onChange:n,errorMessage:(0,r.t)("Widget title is required"),maxLength:255})})]}),(0,se.tZ)(E.kP,{children:(0,se.BX)(ge.ZP,{gap:1,children:[(0,se.tZ)(yt.z,{featureName:"widget-builder"}),(0,se.tZ)(pe.ZP,{external:!0,href:"https://docs.sentry.io/product/dashboards/custom-dashboards/#widget-builder",children:(0,r.t)("Read the docs")})]})})]})}ft.displayName="Header";var bt=i("./app/actionCreators/modal.tsx"),vt=i("./app/utils/discover/types.tsx");const Zt=[{id:"duration-distribution",title:(0,r.t)("Duration Distribution"),description:(0,r.t)("Compare transaction durations across different percentiles."),displayType:U.FO.LINE,widgetType:U.l9.DISCOVER,interval:"5m",queries:[{name:"",conditions:"event.type:transaction",fields:["p50(transaction.duration)","p75(transaction.duration)","p95(transaction.duration)"],aggregates:["p50(transaction.duration)","p75(transaction.duration)","p95(transaction.duration)"],columns:[],orderby:""}]},{id:"high-throughput-transactions",title:(0,r.t)("High Throughput Transactions"),description:(0,r.t)("Top 5 transactions with the largest volume."),displayType:U.FO.TOP_N,widgetType:U.l9.DISCOVER,interval:"5m",queries:[{name:"",conditions:"event.type:transaction",fields:["transaction","count()"],aggregates:["count()"],columns:["transaction"],orderby:"-count()"}]},{id:"crash-rates-recent-releases",title:(0,r.t)("Crash Rates for Recent Releases"),description:(0,r.t)("Percentage of crashed sessions for latest releases."),displayType:U.FO.LINE,widgetType:U.l9.RELEASE,interval:"5m",limit:8,queries:[{name:"",conditions:"",fields:["crash_rate(session)","release"],aggregates:["crash_rate(session)"],columns:["release"],orderby:"-release"}]},{id:"session-health",title:(0,r.t)("Session Health"),description:(0,r.t)("Number of abnormal, crashed, errored and healthy sessions."),displayType:U.FO.TABLE,widgetType:U.l9.RELEASE,interval:"5m",queries:[{name:"",conditions:"",fields:["session.status","sum(session)"],aggregates:["sum(session)"],columns:["session.status"],orderby:""}]},{id:"lcp-country",title:(0,r.t)("LCP by Country"),description:(0,r.t)("Density map showing page load times by country."),displayType:U.FO.WORLD_MAP,widgetType:U.l9.DISCOVER,interval:"5m",queries:[{name:"",conditions:"has:geo.country_code",fields:["p75(measurements.lcp)"],aggregates:["p75(measurements.lcp)"],columns:[],orderby:""}]},{id:"miserable-users",title:(0,r.t)("Miserable Users"),description:(0,r.t)("Unique users who have experienced slow load times."),displayType:U.FO.BIG_NUMBER,widgetType:U.l9.DISCOVER,interval:"5m",queries:[{name:"",conditions:"",fields:["count_miserable(user,300)"],aggregates:["count_miserable(user,300)"],columns:[],orderby:""}]},{id:"slow-vs-fast",title:(0,r.t)("Slow vs. Fast Transactions"),description:(0,r.t)("Percentage breakdown of transaction durations over and under 300ms."),displayType:U.FO.BAR,widgetType:U.l9.DISCOVER,interval:"5m",queries:[{name:"",conditions:"event.type:transaction",fields:["equation|(count_if(transaction.duration,greater,300) / count()) * 100","equation|(count_if(transaction.duration,lessOrEquals,300) / count()) * 100"],aggregates:["equation|(count_if(transaction.duration,greater,300) / count()) * 100","equation|(count_if(transaction.duration,lessOrEquals,300) / count()) * 100"],columns:[],orderby:""}]},{id:"issue-for-review",title:(0,r.t)("Issues For Review"),description:(0,r.t)("Most recently seen unresolved issues for review."),displayType:U.FO.TABLE,widgetType:U.l9.ISSUE,interval:"5m",queries:[{name:"",conditions:"is:unresolved is:for_review",fields:["issue","assignee","events","title"],aggregates:[],columns:["issue","assignee","events","title"],orderby:"date"}]},{id:"top-unhandled",title:(0,r.t)("Top Unhandled Error Types"),description:(0,r.t)("Most frequently encountered unhandled errors."),displayType:U.FO.TOP_N,widgetType:U.l9.DISCOVER,interval:"5m",queries:[{name:"",conditions:"error.unhandled:true",fields:["error.type","count()"],aggregates:["count()"],columns:["error.type"],orderby:"-count()"}]},{id:"users-affected",title:(0,r.t)("Users Affected by Errors"),description:(0,r.t)("Footprint of unique users affected by errors."),displayType:U.FO.LINE,widgetType:U.l9.DISCOVER,interval:"5m",queries:[{name:"",conditions:"event.type:error",fields:["count_unique(user)","count()"],aggregates:["count_unique(user)","count()"],columns:[],orderby:""}]}];var wt=i("./app/views/dashboardsV2/widgetBuilder/widgetLibrary/card.tsx");function Tt(e){let{bypassOverwriteModal:t,onWidgetSelect:i,organization:s,selectedWidgetId:a}=e;const n=(0,Re.a)();let o=Zt.map((e=>e.displayType===U.FO.TOP_N?{...e,displayType:U.FO.AREA,limit:vt.hY}:e));function d(e,s){return function(){t?i(e):(0,bt.openWidgetBuilderOverwriteModal)({onConfirm:()=>i(e),widget:e,iconColor:s})}}return s.features.includes("dashboards-releases")||(o=o.filter((e=>!(e.widgetType===U.l9.RELEASE)))),(0,se.BX)(l.Fragment,{children:[(0,se.tZ)(Et,{children:(0,r.t)("Widget Library")}),(0,se.tZ)(xt,{children:o.map(((e,t)=>{const i=n.charts.getColorPalette(o.length-2)[t],s=e.displayType===U.FO.TOP_N?U.FO.TABLE:e.displayType,r=(0,K.Zi)({displayType:s,queries:e.queries,widgetType:e.widgetType}),l={...e,displayType:s,queries:r};return(0,se.tZ)(St,{selected:a===e.id,onClick:d(l,i),children:(0,se.tZ)(wt.Z,{widget:l,iconColor:i})},e.title)}))})]})}Tt.displayName="WidgetLibrary";const xt=(0,d.Z)("div",{target:"ess72gf2"})({name:"1fttcpj",styles:"display:flex;flex-direction:column"}),Et=(0,d.Z)("h5",{target:"ess72gf1"})("padding-left:calc(",(0,_.Z)(2)," - ",(0,_.Z)(.25),");"),St=(0,d.Z)("div",{target:"ess72gf0"})("padding:calc(",(0,_.Z)(2)," - 3px);border:1px solid transparent;border-radius:",(e=>e.theme.borderRadius),";transition:border-color 0.3s ease;cursor:pointer;&:hover{border-color:",(e=>e.theme.gray100),";}",(e=>e.selected&&`border-color: ${e.theme.gray200};`),";"),Ot={[U.l9.DISCOVER]:K.qg.EVENTS,[U.l9.ISSUE]:K.qg.ISSUES,[U.l9.RELEASE]:K.qg.RELEASES},qt={[K.qg.EVENTS]:U.l9.DISCOVER,[K.qg.ISSUES]:U.l9.ISSUE,[K.qg.RELEASES]:U.l9.RELEASE};function Ct(e){var t,i;let{dashboard:s,params:a,location:o,organization:d,selection:u,start:p,end:m,statsPeriod:y,onSave:E,route:S,router:O,tags:C}=e;const{widgetIndex:_,orgId:j,dashboardId:V}=a,{source:$,displayType:Y,defaultTitle:J,limit:ee}=o.query,te=(0,K.eQ)(o.query.defaultWidgetQuery);let{defaultTableColumns:ie}=o.query;"string"==typeof ie&&(ie=[ie]);const ae=d.features.includes("dashboards-releases"),re=s.widgets.filter((e=>{let{widgetType:t}=e;return t!==U.l9.RELEASE||ae})),oe=(0,B.ri)(_),de=Number(_),le=de>=0&&de<re.length&&Number.isInteger(de),ce=d.slug,pe=y?{...u,datetime:{start:null,end:null,period:y,utc:null}}:p&&m?{...u,datetime:{start:p,end:m,period:null,utc:null}}:u,ge=[U.EN.DISCOVERV2,U.EN.ISSUE_DETAILS].includes($),me=(0,M.Z)(),[he,ye]=(0,l.useState)(!1),[fe,be]=(0,l.useState)((0,G.v)(U.l9.DISCOVER)),[Ze,we]=(0,l.useState)((()=>{var e;const t={title:null!=J?J:(0,r.t)("Custom Widget"),displayType:null!==(e=Y===U.FO.TOP_N?U.FO.AREA:Y)&&void 0!==e?e:U.FO.TABLE,interval:"5m",queries:[],limit:ee?Number(ee):void 0,errors:void 0,loading:!!ge,dashboards:[],userHasModified:!1,prebuiltWidgetId:null,dataSet:K.qg.EVENTS};return te?(t.queries=[{...te,orderby:te.orderby||(fe.getTableSortOptions?fe.getTableSortOptions(d,te)[0].value:"")}],[U.FO.TABLE,U.FO.TOP_N].includes(t.displayType)||(0,K.V0)(t.displayType)&&t.queries[0].columns.length||(t.queries[0].orderby="")):t.queries=[{...fe.defaultWidgetQuery}],t})),[Te,xe]=(0,l.useState)(null),[Ee,Se]=(0,l.useState)(null);(0,l.useEffect)((()=>{if((0,R.Z)("dashboards_views.widget_builder.opened",{organization:d,new_widget:!oe}),(0,B.z)(C)&&(0,w.QK)(me,d.slug,{...u,datetime:{period:"14d",start:null,end:null,utc:null}}),oe&&le){const i=re[de];let s,a=i.displayType,r=i.limit;var e,t;i.displayType===U.FO.TOP_N?(r=K._k,a=U.FO.AREA,s=(0,K.Zi)({displayType:a,queries:i.queries,widgetType:null!==(e=i.widgetType)&&void 0!==e?e:U.l9.DISCOVER}).map((e=>({...e,aggregates:e.aggregates.length?[e.aggregates[e.aggregates.length-1]]:[]})))):s=(0,K.Zi)({displayType:a,queries:i.queries,widgetType:null!==(t=i.widgetType)&&void 0!==t?t:U.l9.DISCOVER}),we({title:i.title,displayType:a,interval:i.interval,queries:s,errors:void 0,loading:!1,dashboards:[],userHasModified:!1,dataSet:i.widgetType?Ot[i.widgetType]:K.qg.EVENTS,limit:r,prebuiltWidgetId:null}),be((0,G.v)(i.widgetType)),xe(i)}}),[]),(0,l.useEffect)((()=>{ge&&async function(){const e=me.requestPromise(`/organizations/${d.slug}/dashboards/`,{method:"GET",query:{sort:"myDashboardsAndRecentlyViewed"}});try{const t=await e;we((e=>({...e,dashboards:t,loading:!1})))}catch(e){const t=(0,r.t)("Unable to fetch dashboards");(0,v.Iw)(t),(0,I.Z)(t)(e),we((e=>({...e,loading:!1})))}}(),we((e=>({...e,selectedDashboard:{label:s.title,value:s.id||K.i0}})))}),[me,s.id,s.title,ge,d.slug,$]),(0,l.useEffect)((()=>{var e;(0,Z.MA)(me,d.slug,null===(e=u.projects)||void 0===e?void 0:e.map(String))}),[u.projects,me,d.slug]),(0,l.useEffect)((()=>{O.setRouteLeaveHook(S,(()=>{if(!he&&Ze.userHasModified)return(0,r.t)("You have unsaved changes, are you sure you want to leave?")}))}),[he,Ze.userHasModified,S,O]);const Oe=Ze.dataSet===K.qg.EVENTS?U.l9.DISCOVER:Ze.dataSet===K.qg.ISSUES?U.l9.ISSUE:U.l9.RELEASE,qe={title:Ze.title,displayType:Ze.displayType,interval:Ze.interval,queries:Ze.queries,limit:Ze.limit,widgetType:Oe},Ce=null!==(t=null===(i=Ze.selectedDashboard)||void 0===i?void 0:i.value)&&void 0!==t?t:V,Fe=h()(o.query,"source"),Ae={pathname:(0,B.ri)(Ce)&&Ce!==K.i0?`/organizations/${j}/dashboard/${Ce}/`:`/organizations/${j}/dashboards/${K.i0}/`,query:g()(Fe)?void 0:Fe},ke=(0,K.V0)(Ze.displayType),_e=[U.FO.TABLE,U.FO.TOP_N].includes(Ze.displayType);function Be(){return Te?s.widgets.findIndex((e=>(0,B.ri)(e.id)?e.id===Te.id:!!(0,B.ri)(e.tempId)&&e.tempId===Te.tempId)):-1}function Re(e,t){var i;(0,R.Z)("dashboards_views.widget_builder.change",{from:$,field:e,value:t,widget_type:Oe,organization:d,new_widget:!oe}),we((i=>{const s=c()(i);return f()(s,e,t),"title"===e&&f()(s,"userHasModified",!0),{...s,errors:void 0}})),"displayType"===e&&t!==Ze.displayType&&(i=t,we((e=>{const t=c()(e);if(!fe.supportedDisplayTypes.includes(i))return f()(t,"queries",(0,K.Zi)({displayType:i,queries:[{...(0,G.v)(U.l9.DISCOVER).defaultWidgetQuery}],widgetType:U.l9.DISCOVER})),f()(t,"dataSet",K.qg.EVENTS),be((0,G.v)(U.l9.DISCOVER)),{...t,errors:void 0};const s=(0,K.Zi)({displayType:i,queries:e.queries,widgetType:qt[e.dataSet]});var a;return i===U.FO.TOP_N&&s.splice(1),e.userHasModified||te&&ie&&(i===U.FO.TABLE?s.forEach((e=>{var t;const i=(0,N.n0)(ie);e.columns=[...i.columns],e.aggregates=[...i.aggregates],e.fields=[...ie],e.orderby=null!==(t=te.orderby)&&void 0!==t?t:e.fields.length?`${e.fields[0]}`:"-"})):i===Y&&s.forEach((e=>{e.fields=[...te.columns,...te.aggregates],e.aggregates=[...te.aggregates],e.columns=[...te.columns],te.orderby&&(Y===U.FO.TOP_N||te.columns.length)&&(e.orderby=te.orderby)}))),f()(t,"queries",s),(0,K.V0)(i)&&s[0].columns.filter((e=>!!e)).length?t.limit=null!==(a=e.limit)&&void 0!==a?a:Math.min((0,K.oA)(s.length,s[0].columns.length),K._k):t.limit=void 0,f()(t,"userHasModified",!0),{...t,errors:void 0}})))}function Le(e){(0,R.Z)("dashboards_views.widget_builder.change",{from:$,field:"dataSet",value:e,widget_type:Oe,organization:d,new_widget:!oe}),we((t=>{const i=c()(t);i.queries.splice(0,i.queries.length),f()(i,"dataSet",e),e===K.qg.ISSUES&&f()(i,"displayType",U.FO.TABLE);const s=(0,G.v)(qt[e]);return be(s),i.queries.push(...null!=Te&&Te.widgetType&&Ot[Te.widgetType]===e?Te.queries:[{...s.defaultWidgetQuery}]),f()(i,"userHasModified",!0),{...i,errors:void 0}}))}function De(){we((e=>{const t=c()(e),i=(0,G.v)(qt[e.dataSet]),s=c()(i.defaultWidgetQuery);return s.fields=e.queries[0].fields,s.aggregates=e.queries[0].aggregates,s.columns=e.queries[0].columns,s.orderby=e.queries[0].orderby,t.queries.push(s),t}))}function Ne(e){we((t=>{const i=c()(t);return i.queries.splice(e,1),{...i,errors:void 0}}))}function Ie(e,t){we((i=>{const s=c()(i);return f()(s,`queries.${e}`,t),f()(s,"userHasModified",!0),{...s,errors:void 0}}))}function ze(e){return function(t){const i=t.map(N.sN),s=(0,N.KZ)(t),a=c()(Ze);let r=c()(a.queries[0]);r.fields=i,r.aggregates=s.aggregates,r.columns=s.columns,r.fieldAliases=s.fieldAliases,fe.handleColumnFieldChangeOverride&&(r=fe.handleColumnFieldChangeOverride(r)),fe.handleOrderByReset&&(r=e&&i.some((e=>!["transaction","title"].includes(e)))?fe.handleOrderByReset(r,i.filter((e=>!["transaction","title"].includes(e)))):fe.handleOrderByReset(r,i)),f()(a,"queries",[r]),f()(a,"userHasModified",!0),we(a)}}function Pe(e){const t=e.map(N.sN),i=c()(Ze),s=Ze.queries.map((e=>{const i=c()(e);if(i.columns=t,t.length){if(!i.orderby){const t=(0,K._4)({widgetType:null!=Oe?Oe:U.l9.DISCOVER,columns:e.columns,aggregates:e.aggregates});let s;t.length?(s=t[0].value,i.orderby=`-${s}`):i.orderby=""}}else i.orderby="";return i}));f()(i,"userHasModified",!0),f()(i,"queries",s);const a=i.queries[0].columns.filter((e=>!("equation|"===e)));var r;0===a.length?f()(i,"limit",void 0):f()(i,"limit",Math.min(null!==(r=i.limit)&&void 0!==r?r:K._k,(0,K.oA)(s.length,s[0].aggregates.length))),we(i)}function Me(e){we((t=>({...t,limit:e})))}function We(e){const t=c()(Ze);Ze.queries.forEach(((i,s)=>{const a=c()(i);a.orderby=e,f()(t,`queries.${s}`,a)})),f()(t,"userHasModified",!0),we(t)}function Ue(){if(!oe)return;ye(!0);let e=[...s.widgets];const t=Be();e.splice(t,1),e=(0,W.Bb)(e),E(e),O.push(Ae)}async function He(){var e;const t=(0,W.TE)(qe);if(Te&&(t.layout=null==Te?void 0:Te.layout),ke||(t.limit=void 0),await async function(e){if(ge&&(!Ze.selectedDashboard||!Ze.dashboards.find((e=>{var t,i;let{title:s,id:a}=e;return s===(null===(t=Ze.selectedDashboard)||void 0===t?void 0:t.label)&&a===(null===(i=Ze.selectedDashboard)||void 0===i?void 0:i.value)}))&&Ze.selectedDashboard.value!==K.i0))return we({...Ze,errors:{...Ze.errors,dashboard:(0,r.t)("This field may not be blank")}}),!1;we({...Ze,loading:!0});try{return await(0,b.QL)(me,d.slug,e),!0}catch(e){var t;return we({...Ze,loading:!1,errors:{...Ze.errors,...(0,K.wc)(null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:{},{})}}),!1}}(t))if(Ee&&(0,R.Z)("dashboards_views.widget_library.add_widget",{organization:d,title:Ee}),ye(!0),ge)!function(e){var t;if(!Ze.selectedDashboard)return;const i={queryNames:[],queryConditions:[],queryFields:[...e.queries[0].columns,...e.queries[0].aggregates],queryOrderby:e.queries[0].orderby};e.queries.forEach((e=>{i.queryNames.push(e.name),i.queryConditions.push(e.conditions)}));const s={displayType:e.displayType,interval:e.interval,title:e.title,...i,project:pe.projects,environment:pe.environments,...h()(pe.datetime,"period"),statsPeriod:null===(t=pe.datetime)||void 0===t?void 0:t.period};(0,v.S9)((0,r.t)("Added widget.")),Xe(Ze.selectedDashboard.value,s)}(t);else{if(Te){var i;let e=[...s.widgets];const a=Be(),n={...t,id:Te.id};return(0,W.I_)(Te.displayType)!==(0,W.I_)(t.displayType)?(e[a]=(0,W.W8)(n),e=(0,W.Bb)(e)):e[a]=n,E(e),(0,v.S9)((0,r.t)("Updated widget.")),Xe(null!=V?V:K.i0),void(0,R.Z)("dashboards_views.widget_builder.save",{organization:d,data_set:null!==(i=t.widgetType)&&void 0!==i?i:U.l9.DISCOVER,new_widget:!1})}E([...s.widgets,t]),(0,v.S9)((0,r.t)("Added widget.")),Xe(null!=V?V:K.i0),(0,R.Z)("dashboards_views.widget_builder.save",{organization:d,data_set:null!==(e=t.widgetType)&&void 0!==e?e:U.l9.DISCOVER,new_widget:!0})}}function Xe(e,t){const i=!g()(Fe)||t?{...Fe,...t}:void 0;e!==K.i0?O.push({pathname:`/organizations/${d.slug}/dashboard/${e}/`,query:i}):O.push({pathname:`/organizations/${d.slug}/dashboards/new/`,query:i})}const Ge=[U.FO.LINE,U.FO.AREA,U.FO.BAR].includes(Ze.displayType)&&Ze.queries.length<3,Qe=[U.FO.TABLE,U.FO.WORLD_MAP,U.FO.BIG_NUMBER].includes(Ze.displayType),{columns:$e,aggregates:Ye,fields:Je,fieldAliases:Ke=[]}=Ze.queries[0],et=(0,l.useMemo)((()=>$e.map(((e,t)=>(0,N.HM)({field:e,alias:Ke[t]})))),[$e,Ke]),tt=(0,l.useMemo)((()=>Ye.map(((e,t)=>(0,N.HM)({field:e,alias:Ke[t]})))),[Ye,Ke]),st=(0,B.ri)(Je)?Je.map(((e,t)=>(0,N.HM)({field:e,alias:Ke[t]}))):[...et,...tt],at=qe.queries.some((e=>e.columns.filter((e=>!!e)).length>0)),rt=ke&&at||_e;return oe&&!le?(0,se.tZ)(k.Z,{title:s.title,orgSlug:ce,children:(0,se.tZ)(n.JH,{children:(0,se.tZ)(q.Z,{message:(0,r.t)("The widget you want to edit was not found.")})})}):(0,se.tZ)(k.Z,{title:s.title,orgSlug:ce,children:(0,se.tZ)(F.Z,{defaultSelection:{datetime:{start:null,end:null,utc:null,period:X.GY}},children:(0,se.tZ)(L.L,{organization:d,selection:u,children:(0,se.tZ)(Q.KC,{children:(0,se.tZ)(z.BT,{organization:d,location:o,children:(0,se.tZ)(H.d,{organization:d,eventView:D.ZP.fromLocation(o),location:o,hideLoadingIndicator:!0,children:e=>{var t,i,a,r;return(0,se.tZ)(P.kP,{location:o,forceTransactions:e.forceTransactionsOnly,children:(0,se.BX)(At,{children:[(0,se.tZ)(ft,{orgSlug:ce,title:Ze.title,dashboardTitle:s.title,goBackLocation:Ae,onChangeTitle:e=>{Re("title",e)}}),(0,se.BX)(Bt,{children:[(0,se.BX)(Dt,{children:[(0,se.BX)(Rt,{children:[!d.features.includes("dashboards-top-level-filter")&&(0,se.BX)(kt,{condensed:!0,children:[(0,se.tZ)(A.Z,{}),(0,se.tZ)(x.Z,{}),(0,se.tZ)(T.Z,{alignDropdown:"left"})]}),(0,se.BX)(_t,{symbol:"colored-numeric",children:[(0,se.tZ)(it,{location:o,widget:qe,dashboardFilters:s.filters,organization:d,pageFilters:pe,displayType:Ze.displayType,error:null===(t=Ze.errors)||void 0===t?void 0:t.displayType,onChange:e=>{Re("displayType",e)},noDashboardsMEPProvider:!0}),(0,se.tZ)(ue,{dataSet:Ze.dataSet,displayType:Ze.displayType,onChange:Le,hasReleaseHealthFeature:ae}),_e&&(0,se.tZ)(Q.k,{children:e=>{var t;let{isMetricsData:i}=e;return(0,se.tZ)(ne,{dataSet:Ze.dataSet,queries:Ze.queries,displayType:Ze.displayType,widgetType:Oe,queryErrors:null===(t=Ze.errors)||void 0===t?void 0:t.queries,onQueryChange:Ie,handleColumnFieldChange:ze(i),explodedFields:st,tags:C,organization:d})}}),![U.FO.TABLE].includes(Ze.displayType)&&(0,se.tZ)(lt,{dataSet:Ze.dataSet,displayType:Ze.displayType,widgetType:Oe,queryErrors:null===(i=Ze.errors)||void 0===i?void 0:i.queries,onYAxisChange:e=>{!function(e){const t=e.map(N.sN),i=c()(Ze),s=Ze.queries.map((e=>{let i=c()(e);var s,a;return Ze.displayType===U.FO.TOP_N?(i.fields=[...null!==(s=null===(a=i.fields)||void 0===a?void 0:a.slice(0,i.fields.length-1))&&void 0!==s?s:[],...t],i.aggregates=[...i.aggregates.slice(0,i.aggregates.length-1),...t]):(i.fields=[...i.columns,...t],i.aggregates=t),fe.handleOrderByReset&&(i=fe.handleOrderByReset(i,t)),i}));f()(i,"queries",s),f()(i,"userHasModified",!0);const a=i.queries[0].columns.filter((e=>!("equation|"===e)));var r;0===a.length?f()(i,"limit",void 0):f()(i,"limit",Math.min(null!==(r=i.limit)&&void 0!==r?r:K._k,(0,K.oA)(s.length,s[0].aggregates.length))),we(i)}(e)},aggregates:tt,tags:C,organization:d}),(0,se.tZ)(ve,{queries:Ze.queries,hideLegendAlias:Qe,canAddSearchConditions:Ge,organization:d,queryErrors:null===(a=Ze.errors)||void 0===a?void 0:a.queries,onAddSearchConditions:De,onQueryChange:Ie,onQueryRemove:Ne,selection:pe,widgetType:Oe,dashboardFilters:s.filters,location:o}),ke&&(0,se.tZ)(je,{columns:$e.filter((e=>!("equation|"===e))).map(((e,t)=>(0,N.HM)({field:e,alias:Ke[t]}))),onGroupByChange:Pe,organization:d,tags:C,dataSet:Ze.dataSet}),rt&&(0,se.tZ)(Ve.j,{limit:Ze.limit,displayType:Ze.displayType,queries:Ze.queries,dataSet:Ze.dataSet,error:null===(r=Ze.errors)||void 0===r?void 0:r.orderby,onSortByChange:We,onLimitChange:Me,organization:d,widgetType:Oe,tags:C})]})]}),(0,se.tZ)(ct,{goBackLocation:Ae,isEditing:oe,onSave:He,onDelete:Ue,invalidForm:!(!ge||Ze.selectedDashboard)})]}),(0,se.tZ)(Lt,{children:(0,se.tZ)(Tt,{organization:d,selectedWidgetId:Ze.userHasModified?null:Ze.prebuiltWidgetId,onWidgetSelect:e=>{Se(e.title),be((0,G.v)(e.widgetType||U.l9.DISCOVER));const{id:t,...i}=e;we({...Ze,...i,dataSet:e.widgetType?Ot[e.widgetType]:K.qg.EVENTS,userHasModified:!1,prebuiltWidgetId:t||null})},bypassOverwriteModal:!Ze.userHasModified})})]})]})})}})})})})})})}Ct.displayName="WidgetBuilder";const Ft=(0,j.Z)((0,V.Z)(Ct)),At=(0,d.Z)(n.JH,{target:"e1rwomk16"})({name:"1hcx8jb",styles:"padding:0"}),kt=(0,d.Z)(C.Z,{target:"e1rwomk15"})("margin-bottom:",(0,_.Z)(2),";"),_t=(0,d.Z)(S.Z,{target:"e1rwomk14"})("gap:",(0,_.Z)(4),";max-width:100%;"),Bt=(0,d.Z)(E.uT,{target:"e1rwomk13"})("&&{gap:0;padding:0;}grid-template-rows:1fr;@media (min-width: ",(e=>e.theme.breakpoints.large),"){grid-template-columns:minmax(100px, auto) 400px;}@media (min-width: ",(e=>e.theme.breakpoints.xlarge),"){grid-template-columns:1fr;}"),Rt=(0,d.Z)(E.or,{target:"e1rwomk12"})("max-width:1000px;flex:1;padding:",(0,_.Z)(4)," ",(0,_.Z)(2),";@media (min-width: ",(e=>e.theme.breakpoints.medium),"){padding:",(0,_.Z)(4),";}@media (max-width: calc(",(e=>e.theme.breakpoints.large)," + ",(0,_.Z)(4),")){",O.Z,"{width:calc(100% - ",(0,_.Z)(4),");}}"),Lt=(0,d.Z)(E.MF,{target:"e1rwomk11"})("padding:",(0,_.Z)(4)," ",(0,_.Z)(2),";@media (max-width: ",(e=>e.theme.breakpoints.large),"){border-top:1px solid ",(e=>e.theme.gray200),";grid-row:2/2;grid-column:1/-1;max-width:100%;}@media (min-width: ",(e=>e.theme.breakpoints.large),"){border-left:1px solid ",(e=>e.theme.gray200),";padding-right:",(0,_.Z)(4),";max-width:400px;}"),Dt=(0,d.Z)("div",{target:"e1rwomk10"})("display:flex;flex-direction:column;@media (max-width: ",(e=>e.theme.breakpoints.large),"){grid-column:1/-1;}");function Nt(e){const t=(0,o.Z)();return(0,se.tZ)(s.Z,{features:["dashboards-edit"],organization:t,renderDisabled:()=>(0,se.tZ)(n.JH,{children:(0,se.tZ)(a.Z,{type:"warning",children:(0,r.t)("You don't have access to this feature")})}),children:(0,se.tZ)(Ft,{...e,organization:t})})}Nt.displayName="WidgetBuilderContainer";const It=Nt},"./app/views/dashboardsV2/widgetBuilder/widgetLibrary/card.tsx":(e,t,i)=>{i.d(t,{Z:()=>c});var s=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=i("./app/styles/space.tsx"),r=(i("../node_modules/core-js/modules/web.dom-collections.iterator.js"),i("../node_modules/core-js/modules/es.array.includes.js"),i("../node_modules/react/index.js"),i("./app/components/panels/index.tsx"),i("./app/icons/index.tsx")),n=i("./app/icons/iconGraphArea.tsx"),o=i("./app/icons/iconGraphBar.tsx"),d=i("./app/views/dashboardsV2/types.tsx"),l=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function u(e){switch(e){case d.FO.TABLE:return r.dc;case d.FO.WORLD_MAP:return r.vc;case d.FO.BIG_NUMBER:return r.A8;case d.FO.BAR:return o.U;case d.FO.TOP_N:return r.CC;case d.FO.AREA:return n.g;case d.FO.LINE:default:return r.TX}}(0,a.Z)(1),(0,a.Z)(1.5),(0,a.Z)(2),(0,a.Z)(.5),(0,a.Z)(1),(0,a.Z)(1.5);function c(e){let{widget:t,iconColor:i}=e;const{title:s,description:a,displayType:r}=t,n=u(r);return(0,l.BX)(p,{children:[(0,l.tZ)(y,{backgroundColor:i,children:(0,l.tZ)(n,{color:"white"})}),(0,l.BX)(g,{children:[(0,l.tZ)(m,{children:s}),(0,l.tZ)(h,{children:a})]})]})}c.displayName="Card";const p=(0,s.Z)("div",{target:"e1kr3ej04"})("display:flex;flex-direction:row;gap:",(0,a.Z)(1),";"),g=(0,s.Z)("div",{target:"e1kr3ej03"})({name:"1fttcpj",styles:"display:flex;flex-direction:column"}),m=(0,s.Z)("div",{target:"e1kr3ej02"})("font-size:",(e=>e.theme.fontSizeLarge),";font-weight:500;margin-bottom:0;color:",(e=>e.theme.gray500),";"),h=(0,s.Z)("small",{target:"e1kr3ej01"})("color:",(e=>e.theme.gray300),";"),y=(0,s.Z)("div",{target:"e1kr3ej00"})("display:flex;justify-content:center;align-items:center;padding:",(0,a.Z)(1),";min-width:40px;height:40px;border-radius:",(e=>e.theme.borderRadius),";background:",(e=>e.backgroundColor),";")}}]);
//# sourceMappingURL=../sourcemaps/app_views_dashboardsV2_widgetBuilder_index_tsx.6627a38c7029cdd7e0089f23869e39b9.js.map