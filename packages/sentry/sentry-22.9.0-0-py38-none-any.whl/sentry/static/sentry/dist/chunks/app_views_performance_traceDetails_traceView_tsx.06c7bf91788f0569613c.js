"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_performance_traceDetails_traceView_tsx"],{"./app/utils/discover/discoverQuery.tsx":(e,t,r)=>{r.d(t,{Z:()=>l});var n=r("./app/utils/withApi.tsx"),s=r("./app/utils/discover/genericDiscoverQuery.tsx"),o=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function i(e,t){return e.transactionName!==t.transactionName||e.transactionThreshold!==t.transactionThreshold||e.transactionThresholdMetric!==t.transactionThresholdMetric}function a(e){const t=e.useEvents?"events":"eventsv2",r=e.useEvents?(e,t)=>{var r;const{fields:n,...s}=null!==(r=e.meta)&&void 0!==r?r:{};return{...e,meta:{...n,...s}}}:void 0;return(0,o.tZ)(s.ZP,{route:t,shouldRefetchData:i,afterFetch:r,...e})}a.displayName="DiscoverQuery";const l=(0,n.Z)(a)},"./app/utils/discover/genericDiscoverQuery.tsx":(e,t,r)=>{r.d(t,{AA:()=>h,ZP:()=>m,o:()=>d});var n=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),s=(r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/core-js/modules/es.error.cause.js"),r("../node_modules/react/index.js")),o=r("./app/locale.tsx"),i=r("./app/utils/discover/eventView.tsx"),a=r("./app/utils/performance/contexts/performanceEventViewContext.tsx"),l=r("./app/views/organizationContext.tsx"),c=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class d{constructor(e,t){(0,n.Z)(this,"message",void 0),(0,n.Z)(this,"originalError",void 0),this.message=e,this.originalError=t}getOriginalError(){return this.originalError}}class p extends s.Component{constructor(){super(...arguments),(0,n.Z)(this,"state",{isLoading:!0,tableFetchID:void 0,error:null,tableData:null,pageLinks:null}),(0,n.Z)(this,"_shouldRefetchData",(e=>{const t=this.getPayload(this.props),r=this.getPayload(e);return!(0,i.ze)(t,r)||e.limit!==this.props.limit||e.route!==this.props.route||e.cursor!==this.props.cursor})),(0,n.Z)(this,"_parseError",(e=>{var t;if(this.props.parseError)return this.props.parseError(e);if(!e)return null;const r=null===(t=e.responseJSON)||void 0===t?void 0:t.detail;if("string"==typeof r)return new d(r,e);const n=null==r?void 0:r.message;return new d("string"==typeof n?n:(0,o.t)("An unknown error occurred."),e)})),(0,n.Z)(this,"fetchData",(async()=>{const{api:e,queryBatching:t,beforeFetch:r,afterFetch:n,didFetch:s,eventView:o,orgSlug:i,route:a,setError:l}=this.props;if(!o.isValid())return;const c=`/organizations/${i}/${a}/`,d=Symbol("tableFetchID"),p=this.getPayload(this.props);this.setState({isLoading:!0,tableFetchID:d}),null==l||l(void 0),null==r||r(e),e.clear();try{const[r,,o]=await h(e,c,p,t);if(this.state.tableFetchID!==d)return;const i=n?n(r,this.props):r;null==s||s(i),this.setState((e=>{var t;return{isLoading:!1,tableFetchID:void 0,error:null,pageLinks:null!==(t=null==o?void 0:o.getResponseHeader("Link"))&&void 0!==t?t:e.pageLinks,tableData:i}}))}catch(e){const t=this._parseError(e);this.setState({isLoading:!1,tableFetchID:void 0,error:t,tableData:null}),l&&l(null!=t?t:void 0)}}))}componentDidMount(){this.fetchData()}componentDidUpdate(e){const t=this._shouldRefetchData(e),r=!1===e.eventView.isValid()&&this.props.eventView.isValid(),n=!!this.props.shouldRefetchData&&this.props.shouldRefetchData(e,this.props);(t||r||n)&&this.fetchData()}getPayload(e){var t;const{cursor:r,limit:n,noPagination:s,referrer:o}=e,i=this.props.getRequestPayload?this.props.getRequestPayload(e):e.eventView.getEventsAPIPayload(e.location,e.forceAppendRawQueryString);return r&&(i.cursor=r),n&&(i.per_page=n),s&&(i.noPagination=s),o&&(i.referrer=o),Object.assign(i,null!==(t=e.queryExtras)&&void 0!==t?t:{}),i}render(){const{isLoading:e,error:t,tableData:r,pageLinks:n}=this.state,s={isLoading:e,error:t,tableData:r,pageLinks:n},o=this.props.children;return null==o?void 0:o(s)}}function u(e){var t,r,n,o;const i=null===(t=(0,s.useContext)(l.g))||void 0===t?void 0:t.slug,d=null===(r=(0,s.useContext)(a.uL))||void 0===r?void 0:r.eventView,u=null!==(n=e.orgSlug)&&void 0!==n?n:i,h=null!==(o=e.eventView)&&void 0!==o?o:d;if(void 0===u||void 0===h)throw new Error("GenericDiscoverQuery requires both an orgSlug and eventView");const m={...e,orgSlug:u,eventView:h};return(0,c.tZ)(p,{...m})}function h(e,t,r,n){return null!=n&&n.batchRequest?n.batchRequest(e,t,{query:r,includeAllArgs:!0}):e.requestPromise(t,{method:"GET",includeAllArgs:!0,query:{...r}})}p.displayName="_GenericDiscoverQuery",u.displayName="GenericDiscoverQuery";const m=u},"./app/utils/performance/contexts/performanceEventViewContext.tsx":(e,t,r)=>{r.d(t,{bq:()=>s,uL:()=>i}),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("./app/utils/performance/contexts/utils.tsx");const[s,o,i]=(0,n.n)({name:"PerformanceEventViewContext"})},"./app/utils/performance/contexts/utils.tsx":(e,t,r)=>{r.d(t,{n:()=>s}),r("../node_modules/core-js/modules/es.error.cause.js");var n=r("../node_modules/react/index.js");function s(e){const{strict:t=!0,errorMessage:r=`useContext for "${e.name}" must be inside a Provider with a value`,name:s}=e,o=(0,n.createContext)(void 0);return o.displayName=s,[o.Provider,function(){const e=(0,n.useContext)(o);if(!e&&t)throw new Error(r);return e},o]}},"./app/views/performance/traceDetails/styles.tsx":(e,t,r)=>{r.d(t,{$G:()=>T,CB:()=>m.wh,Iq:()=>v,LA:()=>b,RB:()=>y,W3:()=>Z,X2:()=>m.X2,Z9:()=>x,cC:()=>f,pH:()=>g,qD:()=>m.iF,uI:()=>w});var n=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=r("./app/components/events/eventTags/eventTagsPill.tsx"),o=r("./app/components/events/interfaces/spans/header.tsx"),i=r("./app/components/panels/index.tsx"),a=r("./app/components/pills.tsx"),l=r("./app/components/searchBar.tsx"),c=r("./app/styles/space.tsx"),d=r("./app/utils.tsx"),p=r("./app/utils/queryString.tsx"),u=r("./app/views/performance/transactionSummary/utils.tsx"),h=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js"),m=r("./app/components/events/interfaces/spans/spanDetail.tsx");const g=(0,n.Z)("div",{target:"euzgho58"})({name:"7whenc",styles:"display:flex;width:100%"}),v=(0,n.Z)(l.Z,{target:"euzgho57"})({name:"1ff36h2",styles:"flex-grow:1"}),f=(0,n.Z)(o.il,{target:"euzgho56"})("border-top:none;border-bottom:1px solid ",(e=>e.theme.border),";position:sticky;top:0;z-index:1;"),x=(0,n.Z)("div",{target:"euzgho55"})("display:grid;grid-template-columns:1fr;gap:",(0,c.Z)(3),";margin-bottom:",(0,c.Z)(2),";@media (min-width: ",(e=>e.theme.breakpoints.medium),"){grid-template-columns:max-content max-content;grid-row-gap:0;}"),Z=(0,n.Z)("div",{target:"euzgho54"})({name:"13udsys",styles:"height:100%"}),w=(0,n.Z)("div",{target:"euzgho53"})({name:"1wr20zt",styles:"overflow-x:hidden;border-bottom-left-radius:3px;border-bottom-right-radius:3px"}),b=(0,n.Z)(i.s_,{target:"euzgho52"})({name:"1vsyufa",styles:"height:100%;overflow:auto"}),y=(0,n.Z)("span",{target:"euzgho51"})("margin-right:",(0,c.Z)(.75),";display:flex;flex-direction:column;justify-content:center;"),D=(0,n.Z)(a.Z,{target:"euzgho50"})("padding-top:",(0,c.Z)(1.5),";");function T(e){let{location:t,organization:r,transaction:n}=e;const{tags:o}=n;if(!o||o.length<=0)return null;const i=r.slug;return(0,h.BX)("tr",{children:[(0,h.tZ)("td",{className:"key",children:"Tags"}),(0,h.tZ)("td",{className:"value",children:(0,h.tZ)(D,{children:o.map(((e,o)=>{const{pathname:a,query:l}=(0,u.e1)({orgSlug:i,transaction:n.transaction,projectID:String(n.project_id),query:{...t.query,query:(0,p.os)(t.query.query,e.key,e.value)}});return(0,h.tZ)(s.Z,{tag:e,projectId:n.project_slug,organization:r,query:l,streamPath:a},(0,d.ri)(e.key)?e.key:`tag-pill-${o}`)}))})})]})}T.displayName="Tags"},"./app/views/performance/traceDetails/traceNotFound.tsx":(e,t,r)=>{r.d(t,{Z:()=>v});var n=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=r("../node_modules/react/index.js"),o=r("./app/components/alert.tsx"),i=r("./app/components/links/link.tsx"),a=r("./app/components/loadingError.tsx"),l=r("./app/components/loadingIndicator.tsx"),c=r("./app/components/performance/waterfall/rowDetails.tsx"),d=r("./app/locale.tsx"),p=r("./app/styles/space.tsx"),u=r("./app/utils/discover/discoverQuery.tsx"),h=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function m(e){var t,r;let{meta:n,traceEventView:p,traceSlug:m,organization:v,location:f}=e;const x=null!==(t=null==n?void 0:n.transactions)&&void 0!==t?t:0,Z=null!==(r=null==n?void 0:n.errors)&&void 0!==r?r:0;if(0===x&&Z>0){const e=p.withColumns([{kind:"field",field:"project"},{kind:"field",field:"title"},{kind:"field",field:"issue.id"},{kind:"field",field:"level"}]);return e.query=`trace:${m} !event.type:transaction `,(0,h.tZ)(u.Z,{eventView:e,orgSlug:v.slug,location:f,referrer:"api.trace-view.errors-view",useEvents:!0,children:e=>{let{isLoading:t,tableData:r,error:n}=e;return t?(0,h.tZ)(l.Z,{}):n?(0,h.tZ)(o.Z,{type:"error",showIcon:!0,children:(0,h.tZ)(g,{children:(0,d._N)("The trace cannot be shown when all events are errors. An error occurred when attempting to fetch these error events: [error]",{error:n.message})})}):(0,h.BX)(o.Z,{type:"error",showIcon:!0,children:[(0,h.tZ)(g,{children:(0,d.t)("The trace cannot be shown when all events are errors.")}),(0,h.tZ)(c.TV,{"data-test-id":"trace-view-errors",children:null==r?void 0:r.data.map((e=>(0,h.BX)(s.Fragment,{children:[(0,h.tZ)(c._U,{level:e.level}),(0,h.tZ)(c.wE,{children:e.level}),(0,h.tZ)(c.St,{children:(0,h.tZ)(i.Z,{to:`/organizations/${v.slug}/issues/${e["issue.id"]}/events/${e.id}`,children:e.title})})]},e.id)))})]})}})}return(0,h.tZ)(a.Z,{message:(0,d.t)("The trace you are looking for was not found.")})}m.displayName="TraceNotFound";const g=(0,n.Z)("div",{target:"etqb06g0"})("margin-bottom:",(0,p.Z)(1),";"),v=m},"./app/views/performance/traceDetails/traceView.tsx":(e,t,r)=>{r.d(t,{Z:()=>pe}),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("../node_modules/react/index.js"),s=r("../node_modules/@sentry/hub/esm/hub.js"),o=r("./app/components/events/interfaces/spans/anchorLinkManager.tsx"),i=r("./app/components/events/interfaces/spans/dividerHandlerManager.tsx"),a=r("./app/components/events/interfaces/spans/scrollbarManager.tsx"),l=r("./app/components/performance/waterfall/messageRow.tsx"),c=r("./app/components/performance/waterfall/miniHeader.tsx"),d=r("./app/components/performance/waterfall/utils.tsx"),p=r("./app/locale.tsx"),u=r("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),h=r("./app/views/performance/traceDetails/styles.tsx"),m=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),g=r("./app/components/assistant/guideAnchor.tsx"),v=r("./app/components/count.tsx"),f=r("./app/components/idBadge/projectBadge.tsx"),x=r("./app/components/performance/waterfall/constants.tsx"),Z=r("./app/components/performance/waterfall/row.tsx"),w=r("./app/components/performance/waterfall/rowBar.tsx"),b=r("./app/components/performance/waterfall/rowDivider.tsx"),y=r("./app/components/performance/waterfall/rowTitle.tsx"),D=r("./app/components/performance/waterfall/treeConnector.tsx"),T=r("./app/components/tooltip.tsx"),_=r("./app/utils/performance/quickTrace/utils.tsx"),C=r("./app/utils/projects.tsx"),j=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),E=(r("../node_modules/core-js/modules/es.string.replace.js"),r("../node_modules/react-router/es/index.js")),B=r("../node_modules/lodash/omit.js"),S=r.n(B),I=r("./app/components/alert.tsx"),V=r("./app/components/button.tsx"),k=r("./app/components/clipboard.tsx"),O=r("./app/components/dateTime.tsx"),z=r("./app/components/events/interfaces/spans/utils.tsx"),A=r("./app/components/links/link.tsx"),X=r("./app/components/performance/waterfall/rowDetails.tsx"),L=r("./app/components/quickTrace/utils.tsx"),$=r("./app/constants/pageFilters.tsx"),R=r("./app/icons/index.tsx"),H=r("./app/styles/space.tsx"),P=r("./app/utils/discover/urls.tsx"),M=r("./app/utils/getDynamicText.tsx"),q=r("./app/utils/performance/urls.ts"),N=r("./app/utils/performance/vitals/constants.tsx"),F=r("./app/utils/performanceForSentry.tsx"),G=r("./app/views/performance/transactionSummary/utils.tsx"),Q=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class U extends n.Component{constructor(){super(...arguments),(0,m.Z)(this,"scrollBarIntoView",(e=>t=>{t.preventDefault();const r=`#txn-${e}`;this.props.scrollToHash(r),E.browserHistory.push({...this.props.location,hash:r})}))}componentDidMount(){const{organization:e,transaction:t}=this.props;(0,u.Z)("performance_views.trace_view.open_transaction_details",{organization:e,operation:t["transaction.op"],transaction:t.transaction})}renderTransactionErrors(){const{organization:e,transaction:t}=this.props,{errors:r}=t;return 0===r.length?null:(0,Q.tZ)(I.Z,{system:!0,type:"error",expand:r.map((t=>(0,Q.BX)(X.TV,{children:[(0,Q.tZ)(X._U,{level:t.level}),(0,Q.tZ)(X.wE,{children:t.level}),(0,Q.tZ)(X.St,{children:(0,Q.tZ)(A.Z,{to:(0,L.F7)(t,e),children:t.title})})]},t.event_id))),children:(0,Q.tZ)(X.CM,{children:(0,p.tn)("An error event occurred in this transaction.","%s error events occurred in this transaction.",r.length)})})}renderGoToTransactionButton(){const{location:e,organization:t,transaction:r}=this.props,n=(0,P.JE)({id:r.event_id,project:r.project_slug}),s=(0,q.D)(t.slug,n,r.transaction,S()(e.query,Object.values($.V)));return(0,Q.tZ)(Y,{size:"xs",to:s,children:(0,p.t)("View Event")})}renderGoToSummaryButton(){const{location:e,organization:t,transaction:r}=this.props,n=(0,G.e1)({orgSlug:t.slug,transaction:r.transaction,query:S()(e.query,Object.values($.V)),projectID:String(r.project_id)});return(0,Q.tZ)(Y,{size:"xs",to:n,children:(0,p.t)("View Summary")})}renderMeasurements(){const{transaction:e}=this.props,{measurements:t={}}=e,r=Object.keys(t).filter((e=>Boolean(N.r9[`measurements.${e}`]))).sort();return r.length<=0?null:(0,Q.tZ)(n.Fragment,{children:r.map((e=>{var r;return(0,Q.tZ)(h.X2,{title:null===(r=N.r9[`measurements.${e}`])||void 0===r?void 0:r.name,children:`${Number(t[e].value.toFixed(3)).toLocaleString()}ms`},e)}))})}renderTransactionDetail(){const{location:e,organization:t,transaction:r}=this.props,s=Math.min(r.start_timestamp,r.timestamp),o=Math.max(r.start_timestamp,r.timestamp),{start:i,end:a}=(0,z.Zv)(s,o),l=`${Number((1e3*(o-s)).toFixed(3)).toLocaleString()}ms`;return(0,Q.tZ)(h.qD,{children:(0,Q.tZ)("table",{className:"table key-value",children:(0,Q.BX)("tbody",{children:[(0,Q.tZ)(h.X2,{title:(0,Q.BX)(J,{onClick:this.scrollBarIntoView(r.event_id),children:[(0,p.t)("Event ID"),(0,Q.tZ)(k.Z,{value:`${window.location.href.replace(window.location.hash,"")}#txn-${r.event_id}`,children:(0,Q.tZ)(W,{})})]}),extra:this.renderGoToTransactionButton(),children:r.event_id}),(0,Q.tZ)(h.X2,{title:"Transaction",extra:this.renderGoToSummaryButton(),children:r.transaction}),(0,Q.tZ)(h.X2,{title:"Transaction Status",children:r["transaction.status"]}),(0,Q.tZ)(h.X2,{title:"Span ID",children:r.span_id}),(0,Q.tZ)(h.X2,{title:"Project",children:r.project_slug}),(0,Q.tZ)(h.X2,{title:"Start Date",children:(0,M.Z)({fixed:"Mar 19, 2021 11:06:27 AM UTC",value:(0,Q.BX)(n.Fragment,{children:[(0,Q.tZ)(O.Z,{date:1e3*s}),` (${i})`]})})}),(0,Q.tZ)(h.X2,{title:"End Date",children:(0,M.Z)({fixed:"Mar 19, 2021 11:06:28 AM UTC",value:(0,Q.BX)(n.Fragment,{children:[(0,Q.tZ)(O.Z,{date:1e3*o}),` (${a})`]})})}),(0,Q.tZ)(h.X2,{title:"Duration",children:l}),(0,Q.tZ)(h.X2,{title:"Operation",children:r["transaction.op"]||""}),this.renderMeasurements(),(0,Q.tZ)(h.$G,{location:e,organization:t,transaction:r})]})})})}render(){return(0,Q.tZ)(F.BZ,{id:"TransactionDetail",children:(0,Q.BX)(h.CB,{onClick:e=>{e.stopPropagation()},children:[this.renderTransactionErrors(),this.renderTransactionDetail()]})})}}U.displayName="TransactionDetail";const J=(0,j.Z)("a",{target:"eykqe522"})("display:flex;color:",(e=>e.theme.textColor),";:hover{color:",(e=>e.theme.textColor),";}"),W=(0,j.Z)(R.JH,{target:"eykqe521"})("display:block;color:",(e=>e.theme.gray300),";margin-left:",(0,H.Z)(1),";"),Y=(0,j.Z)(V.ZP,{target:"eykqe520"})("position:absolute;top:",(0,H.Z)(.75),";right:",(0,H.Z)(.5),";"),K=U;class ee extends n.Component{constructor(){super(...arguments),(0,m.Z)(this,"state",{showDetail:!1}),(0,m.Z)(this,"transactionRowDOMRef",(0,n.createRef)()),(0,m.Z)(this,"toggleDisplayDetail",(()=>{const{transaction:e}=this.props;(0,_.Ci)(e)&&this.setState((e=>({showDetail:!e.showDetail})))})),(0,m.Z)(this,"scrollIntoView",(()=>{const e=this.transactionRowDOMRef.current;if(!e)return;const t=e.getBoundingClientRect().top+window.scrollY;this.setState({showDetail:!0},(()=>window.scrollTo(0,t)))}))}getCurrentOffset(){const{transaction:e}=this.props,{generation:t}=e;return te(t)}renderConnector(e){const{continuingDepths:t,isExpanded:r,isOrphan:n,isLast:s,transaction:o}=this.props,{generation:i}=o,a=(0,_.Ci)(o)?o.event_id:o.traceSlug;if(0===i)return e?(0,Q.tZ)(D.UV,{style:{right:"15px",height:"10px",bottom:"-5px",top:"auto"},orphanBranch:!1}):null;const l=t.map((e=>{let{depth:t,isOrphanDepth:r}=e;if(i-t<=1)return null;const n=-1*te(i-t-1)-2;return(0,Q.tZ)(D.UV,{style:{left:n},orphanBranch:r},`${a}-${t}`)}));return e&&r&&l.push((0,Q.tZ)(D.UV,{style:{right:"15px",height:"10px",bottom:s?`-${x.d/2+1}px`:"0",top:"auto"},orphanBranch:!1},`${a}-last`)),(0,Q.tZ)(D.DN,{isLast:s,hasToggler:e,orphanBranch:n,children:l})}renderToggle(e){const{isExpanded:t,transaction:r,toggleExpandedState:n}=this.props,{children:s,generation:o}=r,i=this.getCurrentOffset();if(s.length<=0)return(0,Q.tZ)(D.rw,{style:{left:`${i}px`},children:this.renderConnector(!1)});const a=0===o;return(0,Q.BX)(D.rw,{style:{left:`${i}px`},hasToggler:!0,children:[this.renderConnector(!0),(0,Q.BX)(D.U1,{disabled:a,isExpanded:t,errored:e,onClick:e=>{e.stopPropagation(),a||n()},children:[(0,Q.tZ)(v.Z,{value:s.length}),!a&&(0,Q.tZ)("div",{children:(0,Q.tZ)(D.jd,{direction:t?"up":"down"})})]})]})}renderTitle(e){const{generateContentSpanBarRef:t}=e,{organization:r,transaction:s}=this.props,o=this.getCurrentOffset(),i=!!(0,_.Ci)(s)&&s.errors.length>0,a=(0,_.Ci)(s)?(0,Q.BX)(n.Fragment,{children:[(0,Q.tZ)(C.Z,{orgId:r.slug,slugs:[s.project_slug],children:e=>{let{projects:t}=e;const r=t.find((e=>e.slug===s.project_slug));return(0,Q.tZ)(h.RB,{children:(0,Q.tZ)(T.Z,{title:s.project_slug,children:(0,Q.tZ)(f.Z,{project:r||{slug:s.project_slug},avatarSize:16,hideName:!0})})})}}),(0,Q.BX)(y.rv,{errored:i,children:[(0,Q.BX)("strong",{children:[s["transaction.op"]," — "]}),s.transaction]})]}):(0,Q.BX)(y.rv,{errored:!1,children:[(0,Q.tZ)("strong",{children:"Trace — "}),s.traceSlug]});return(0,Q.BX)(y.mw,{ref:t(),children:[this.renderToggle(i),(0,Q.tZ)(y.Wh,{style:{left:`${o}px`,width:"100%"},children:a})]})}renderDivider(e){if(this.state.showDetail)return(0,Q.tZ)(b.xN,{showDetail:!0,style:{position:"absolute"}});const{addDividerLineRef:t}=e;return(0,Q.tZ)(b.xN,{ref:t(),style:{position:"absolute"},onMouseEnter:()=>{e.setHover(!0)},onMouseLeave:()=>{e.setHover(!1)},onMouseOver:()=>{e.setHover(!0)},onMouseDown:e.onDragStart,onClick:e=>{e.stopPropagation()}})}renderGhostDivider(e){const{dividerPosition:t,addGhostDividerLineRef:r}=e;return(0,Q.tZ)(b.Hr,{style:{width:`calc(${(0,d.yI)(t)} + 0.5px)`,display:"none"},children:(0,Q.tZ)(b.xN,{ref:r(),style:{right:0},className:"hovering",onClick:e=>{e.stopPropagation()}})})}renderErrorBadge(){const{transaction:e}=this.props;return(0,_.Ci)(e)&&e.errors.length?(0,Q.tZ)(b.cS,{}):null}renderRectangle(){const{transaction:e,traceInfo:t,barColor:r}=this.props,{showDetail:n}=this.state,s=Math.abs(t.endTimestamp-t.startTimestamp)||1,o=Math.abs(e.start_timestamp-t.startTimestamp)/s,i=Math.abs(e.timestamp-e.start_timestamp),a=i/s;return(0,Q.tZ)(w.e,{spanBarHatch:!1,style:{backgroundColor:r,left:`min(${(0,d.yI)(o||0)}, calc(100% - 1px))`,width:(0,d.yI)(a||0)},children:(0,Q.tZ)(w.R,{durationDisplay:(0,d.ud)({left:o,width:a}),showDetail:n,spanBarHatch:!1,children:(0,d.bQ)(i)})})}renderHeader(e){let{dividerHandlerChildrenProps:t,scrollbarManagerChildrenProps:r}=e;const{hasGuideAnchor:n,index:s}=this.props,{showDetail:o}=this.state,{dividerPosition:i}=t;return(0,Q.BX)(Z.Qc,{showDetail:o,children:[(0,Q.tZ)(Z.E5,{"data-test-id":"transaction-row-title","data-type":"span-row-cell",style:{width:`calc(${(0,d.yI)(i)} - 0.5px)`,paddingTop:0},showDetail:o,onClick:this.toggleDisplayDetail,children:(0,Q.tZ)(g.Z,{target:"trace_view_guide_row",disabled:!n,children:this.renderTitle(r)})}),(0,Q.BX)(b.kP,{children:[this.renderDivider(t),this.renderErrorBadge()]}),(0,Q.tZ)(Z.E5,{"data-test-id":"transaction-row-duration","data-type":"span-row-cell",showStriping:s%2!=0,style:{width:`calc(${(0,d.yI)(1-i)} - 0.5px)`,paddingTop:0},showDetail:o,onClick:this.toggleDisplayDetail,children:(0,Q.tZ)(g.Z,{target:"trace_view_guide_row_details",disabled:!n,children:this.renderRectangle()})}),!o&&this.renderGhostDivider(t)]})}renderDetail(){const{location:e,organization:t,isVisible:r,transaction:n}=this.props,{showDetail:s}=this.state;return(0,Q.tZ)(o.$,{children:o=>{let{registerScrollFn:i,scrollToHash:a}=o;return(0,_.Ci)(n)?(i(`#txn-${n.event_id}`,this.scrollIntoView,!1),r&&s?(0,Q.tZ)(K,{location:e,organization:t,transaction:n,scrollToHash:a}):null):null}})}render(){const{isVisible:e,transaction:t}=this.props,{showDetail:r}=this.state;return(0,Q.BX)(Z.X2,{ref:this.transactionRowDOMRef,visible:e,showBorder:r,cursor:(0,_.Ci)(t)?"pointer":"default",children:[(0,Q.tZ)(a.$6,{children:e=>(0,Q.tZ)(i.$,{children:t=>this.renderHeader({dividerHandlerChildrenProps:t,scrollbarManagerChildrenProps:e})})}),this.renderDetail()]})}}function te(e){return e*(D.Ll/2)+0}ee.displayName="TransactionBar";const re=ee;class ne extends n.Component{constructor(){super(...arguments),(0,m.Z)(this,"state",{isExpanded:!0}),(0,m.Z)(this,"toggleExpandedState",(()=>{this.setState((e=>{let{isExpanded:t}=e;return{isExpanded:!t}}))}))}componentDidUpdate(e,t){t.isExpanded!==this.state.isExpanded&&this.props.updateScrollState()}render(){const{location:e,organization:t,transaction:r,traceInfo:s,continuingDepths:o,isOrphan:i,isLast:a,index:l,isVisible:c,hasGuideAnchor:d,renderedChildren:p,barColor:u}=this.props,{isExpanded:h}=this.state;return(0,Q.BX)(n.Fragment,{children:[(0,Q.tZ)(re,{location:e,organization:t,index:l,transaction:r,traceInfo:s,continuingDepths:o,isOrphan:i,isLast:a,isExpanded:h,toggleExpandedState:this.toggleExpandedState,isVisible:c,hasGuideAnchor:d,barColor:u}),h&&p]})}}ne.displayName="TransactionGroup";const se=(0,a.Iw)(ne);var oe=r("./app/views/performance/traceDetails/utils.tsx"),ie=r("./app/components/discover/discoverFeature.tsx");function ae(e){var t;let{traceInfo:r,traceEventView:n,organization:s,meta:o}=e;const i=r.transactions.size,a=null!==(t=null==o?void 0:o.transactions)&&void 0!==t?t:i;if(null===a||i>=a)return null;const c=n.getResultsViewUrlTarget(s.slug);return(0,Q.tZ)(l.V,{children:(0,p._N)("Limited to a view of [count] transactions. To view the full list, [discover].",{count:i,discover:(0,Q.tZ)(ie.Z,{children:e=>{let{hasFeature:t}=e;return(0,Q.tZ)(A.Z,{disabled:!t,to:c,children:(0,p.t)("Open in Discover")})}})})})}ae.displayName="LimitExceededMessage";const le=ae;var ce=r("./app/views/performance/traceDetails/traceNotFound.tsx");function de(e){let{isVisible:t,numberOfHiddenTransactionsAbove:r}=e;return!t||r<1?null:(0,Q.tZ)(l.V,{children:(0,Q.tZ)("span",{children:1===r?(0,p._N)("[numOfTransaction] hidden transaction",{numOfTransaction:(0,Q.tZ)("strong",{children:r})}):(0,p._N)("[numOfTransaction] hidden transactions",{numOfTransaction:(0,Q.tZ)("strong",{children:r})})},"trace-info-message")})}function pe(e){var t;let{location:r,meta:l,organization:p,traces:m,traceSlug:g,traceEventView:v,filteredTransactionIds:f,...x}=e;const Z=null===(t=s.Gd().getScope())||void 0===t?void 0:t.getTransaction(),w=null==Z?void 0:Z.startChild({op:"trace.render",description:"trace-view-content"});function b(e,t){let{continuingDepths:s,isOrphan:o,isLast:i,index:a,numberOfHiddenTransactionsAbove:l,traceInfo:c,hasGuideAnchor:u}=t;const{children:h,event_id:m}=e,g=e.generation+1,v=function(e,t){return!t||t.has(e.event_id)}(e,f),x=h.reduce(((e,t,r)=>{const n=r===h.length-1,i=t.children.length>0,a=b(t,{continuingDepths:!n&&i?[...s,{depth:g,isOrphanDepth:o}]:s,isOrphan:o,isLast:n,index:e.lastIndex+1,numberOfHiddenTransactionsAbove:e.numberOfHiddenTransactionsAbove,traceInfo:c,hasGuideAnchor:!1});return e.lastIndex=a.lastIndex,e.numberOfHiddenTransactionsAbove=a.numberOfHiddenTransactionsAbove,e.renderedChildren.push(a.transactionGroup),e}),{renderedChildren:[],lastIndex:a,numberOfHiddenTransactionsAbove:v?0:l+1});return{transactionGroup:(0,Q.BX)(n.Fragment,{children:[(0,Q.tZ)(de,{isVisible:v,numberOfHiddenTransactionsAbove:l}),(0,Q.tZ)(se,{location:r,organization:p,traceInfo:c,transaction:{...e,generation:g},continuingDepths:s,isOrphan:o,isLast:i,index:a,isVisible:v,hasGuideAnchor:u,renderedChildren:x.renderedChildren,barColor:(0,d.hd)(e["transaction.op"])})]},m),lastIndex:x.lastIndex,numberOfHiddenTransactionsAbove:x.numberOfHiddenTransactionsAbove}}(0,n.useEffect)((()=>{(0,u.Z)("performance_views.trace_view.view",{organization:p})}),[p]);const y=(0,n.createRef)(),D=(0,n.createRef)();if(null===m||m.length<=0)return(0,Q.tZ)(ce.Z,{meta:l,traceEventView:v,traceSlug:g,location:r,organization:p});const T=x.traceInfo||(0,oe.Rg)(m),_={index:1,numberOfHiddenTransactionsAbove:0,traceInfo:T,transactionGroups:[]},{transactionGroups:C,numberOfHiddenTransactionsAbove:j}=m.reduce(((e,t,r)=>{const n=r===m.length-1,s=t.children.length>0,o=!n&&null!==m[r+1].parent_span_id,i=b(t,{...e,isOrphan:!(0,oe.uM)(t),isLast:n,continuingDepths:!n&&s?[{depth:0,isOrphanDepth:o}]:[],hasGuideAnchor:0===r});return e.index=i.lastIndex+1,e.numberOfHiddenTransactionsAbove=i.numberOfHiddenTransactionsAbove,e.transactionGroups.push(i.transactionGroup),e}),_),E=(0,Q.tZ)(h.W3,{children:(0,Q.tZ)(i.z,{interactiveLayerRef:y,children:(0,Q.tZ)(i.$,{children:e=>{let{dividerPosition:t}=e;return(0,Q.tZ)(a.zt,{dividerPosition:t,interactiveLayerRef:D,children:(0,Q.BX)(h.LA,{children:[(0,Q.BX)(h.cC,{children:[(0,Q.tZ)(a.$6,{children:e=>{let{virtualScrollbarRef:r,scrollBarAreaRef:n,onDragStart:s,onScroll:o}=e;return(0,Q.BX)(c.cs,{ref:D,style:{width:`calc(${(0,d.yI)(t)} - 0.5px)`},onScroll:o,children:[(0,Q.tZ)("div",{style:{width:0,height:"1px"},ref:n}),(0,Q.tZ)(c.Qk,{"data-type":"virtual-scrollbar",ref:r,onMouseDown:s,children:(0,Q.tZ)(c.v6,{})})]})}}),(0,Q.tZ)(c._i,{})]}),(0,Q.BX)(h.uI,{ref:y,children:[(0,Q.tZ)(o.z,{children:(0,Q.tZ)(se,{location:r,organization:p,traceInfo:T,transaction:{traceSlug:g,generation:0,"transaction.duration":T.endTimestamp-T.startTimestamp,children:m,start_timestamp:T.startTimestamp,timestamp:T.endTimestamp},continuingDepths:[],isOrphan:!1,isLast:!1,index:0,isVisible:!0,hasGuideAnchor:!1,renderedChildren:C,barColor:(0,d.hd)("")})}),(0,Q.tZ)(de,{isVisible:!0,numberOfHiddenTransactionsAbove:j}),(0,Q.tZ)(le,{traceInfo:T,organization:p,traceEventView:v,meta:l})]})]})})}})})});return null==w||w.finish(),E}de.displayName="TraceHiddenMessage"}}]);
//# sourceMappingURL=../sourcemaps/app_views_performance_traceDetails_traceView_tsx.f0c0d8facfa1b8ad266890fa25cd730f.js.map