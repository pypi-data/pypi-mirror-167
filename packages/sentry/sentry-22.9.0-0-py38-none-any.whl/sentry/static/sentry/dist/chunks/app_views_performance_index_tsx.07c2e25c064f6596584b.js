"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_performance_index_tsx"],{"./app/utils/discover/genericDiscoverQuery.tsx":(e,t,r)=>{r.d(t,{AA:()=>m,ZP:()=>h,o:()=>u});var n=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=(r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/core-js/modules/es.error.cause.js"),r("../node_modules/react/index.js")),s=r("./app/locale.tsx"),i=r("./app/utils/discover/eventView.tsx"),a=r("./app/utils/performance/contexts/performanceEventViewContext.tsx"),c=r("./app/views/organizationContext.tsx"),l=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class u{constructor(e,t){(0,n.Z)(this,"message",void 0),(0,n.Z)(this,"originalError",void 0),this.message=e,this.originalError=t}getOriginalError(){return this.originalError}}class d extends o.Component{constructor(){super(...arguments),(0,n.Z)(this,"state",{isLoading:!0,tableFetchID:void 0,error:null,tableData:null,pageLinks:null}),(0,n.Z)(this,"_shouldRefetchData",(e=>{const t=this.getPayload(this.props),r=this.getPayload(e);return!(0,i.ze)(t,r)||e.limit!==this.props.limit||e.route!==this.props.route||e.cursor!==this.props.cursor})),(0,n.Z)(this,"_parseError",(e=>{var t;if(this.props.parseError)return this.props.parseError(e);if(!e)return null;const r=null===(t=e.responseJSON)||void 0===t?void 0:t.detail;if("string"==typeof r)return new u(r,e);const n=null==r?void 0:r.message;return new u("string"==typeof n?n:(0,s.t)("An unknown error occurred."),e)})),(0,n.Z)(this,"fetchData",(async()=>{const{api:e,queryBatching:t,beforeFetch:r,afterFetch:n,didFetch:o,eventView:s,orgSlug:i,route:a,setError:c}=this.props;if(!s.isValid())return;const l=`/organizations/${i}/${a}/`,u=Symbol("tableFetchID"),d=this.getPayload(this.props);this.setState({isLoading:!0,tableFetchID:u}),null==c||c(void 0),null==r||r(e),e.clear();try{const[r,,s]=await m(e,l,d,t);if(this.state.tableFetchID!==u)return;const i=n?n(r,this.props):r;null==o||o(i),this.setState((e=>{var t;return{isLoading:!1,tableFetchID:void 0,error:null,pageLinks:null!==(t=null==s?void 0:s.getResponseHeader("Link"))&&void 0!==t?t:e.pageLinks,tableData:i}}))}catch(e){const t=this._parseError(e);this.setState({isLoading:!1,tableFetchID:void 0,error:t,tableData:null}),c&&c(null!=t?t:void 0)}}))}componentDidMount(){this.fetchData()}componentDidUpdate(e){const t=this._shouldRefetchData(e),r=!1===e.eventView.isValid()&&this.props.eventView.isValid(),n=!!this.props.shouldRefetchData&&this.props.shouldRefetchData(e,this.props);(t||r||n)&&this.fetchData()}getPayload(e){var t;const{cursor:r,limit:n,noPagination:o,referrer:s}=e,i=this.props.getRequestPayload?this.props.getRequestPayload(e):e.eventView.getEventsAPIPayload(e.location,e.forceAppendRawQueryString);return r&&(i.cursor=r),n&&(i.per_page=n),o&&(i.noPagination=o),s&&(i.referrer=s),Object.assign(i,null!==(t=e.queryExtras)&&void 0!==t?t:{}),i}render(){const{isLoading:e,error:t,tableData:r,pageLinks:n}=this.state,o={isLoading:e,error:t,tableData:r,pageLinks:n},s=this.props.children;return null==s?void 0:s(o)}}function p(e){var t,r,n,s;const i=null===(t=(0,o.useContext)(c.g))||void 0===t?void 0:t.slug,u=null===(r=(0,o.useContext)(a.uL))||void 0===r?void 0:r.eventView,p=null!==(n=e.orgSlug)&&void 0!==n?n:i,m=null!==(s=e.eventView)&&void 0!==s?s:u;if(void 0===p||void 0===m)throw new Error("GenericDiscoverQuery requires both an orgSlug and eventView");const h={...e,orgSlug:p,eventView:m};return(0,l.tZ)(d,{...h})}function m(e,t,r,n){return null!=n&&n.batchRequest?n.batchRequest(e,t,{query:r,includeAllArgs:!0}):e.requestPromise(t,{method:"GET",includeAllArgs:!0,query:{...r}})}d.displayName="_GenericDiscoverQuery",p.displayName="GenericDiscoverQuery";const h=p},"./app/utils/performance/contexts/metricsCardinality.tsx":(e,t,r)=>{r.d(t,{BT:()=>b,e0:()=>P}),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("../node_modules/react/index.js"),o=r("./app/utils/dates.tsx"),s=r("./app/utils/discover/eventView.tsx"),i=r("./app/utils/performance/contexts/metricsEnhancedSetting.tsx"),a=r("../node_modules/lodash/omit.js"),c=r.n(a),l=r("./app/utils/discover/genericDiscoverQuery.tsx"),u=r("./app/utils/useApi.tsx"),d=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function p(e){let{eventView:t,location:r}=e;return c()(t.getEventsAPIPayload(r),["field","sort","per_page","query"])}function m(e){let{children:t,...r}=e;const n=(0,u.Z)();return(0,d.tZ)(l.ZP,{route:"metrics-compatibility-sums",getRequestPayload:p,...r,api:n,children:e=>{let{tableData:r,...n}=e;return t({tableData:r,...n})}})}function h(e){let{eventView:t,location:r}=e;return c()(t.getEventsAPIPayload(r),["field","sort","per_page","query"])}function g(e){let{children:t,...r}=e;const n=(0,u.Z)();return(0,d.tZ)(l.ZP,{route:"metrics-compatibility",getRequestPayload:h,...r,api:n,children:e=>{let{tableData:r,...n}=e;return t({tableData:r,...n})}})}m.displayName="MetricsCompatibilityQuery",g.displayName="MetricsCompatibilitySumsQuery";var f=r("./app/utils/performance/contexts/utils.tsx");const[v,y,x]=(0,f.n)({name:"MetricsCardinalityContext",strict:!1}),b=e=>{if(!(0,i.gp)(e.organization))return(0,d.tZ)(v,{value:{isLoading:!1,outcome:{forceTransactionsOnly:!0}},children:e.children});const t={location:e.location,orgSlug:e.organization.slug,cursor:"0:0:0"},r=s.ZP.fromLocation(e.location);r.fields=[{field:"tpm()"}];const a=function(e){const t=e.clone();return t.start||t.end||(t.statsPeriod?(0,o.YJ)(t.statsPeriod)>1&&(t.statsPeriod="1h",t.start=void 0,t.end=void 0):(t.statsPeriod="1h",t.start=void 0,t.end=void 0)),t}(r);return(0,d.tZ)(n.Fragment,{children:(0,d.tZ)(m,{eventView:a,...t,children:r=>(0,d.tZ)(g,{eventView:a,...t,children:t=>(0,d.tZ)(v,{value:{isLoading:r.isLoading||t.isLoading,outcome:r.isLoading||t.isLoading?void 0:w(r.tableData&&t.tableData?{...r.tableData,...t.tableData}:null,!!r.error&&!!t.error)},children:e.children})})})})};b.displayName="MetricsCardinalityProvider",x.Consumer;const P=y;function w(e,t){const r={forceTransactionsOnly:!0};if(!e)return r;const n=e.compatible_projects;return t?r:e?function(e){var t;const r=j(e);return null===(t=e.dynamic_sampling_projects)||void 0===t||!t.length||0===r.metricsCount}(e)||function(e){return!j(e).metricsCount}(e)?r:function(e){return j(e).nullCount>0}(e)?{shouldWarnIncompatibleSDK:!0,forceTransactionsOnly:!0,compatibleProjects:n}:function(e){const t=j(e);return t.unparamCount>=t.metricsCount}(e)?{shouldNotifyUnnamedTransactions:!0,forceTransactionsOnly:!0,compatibleProjects:n}:function(e){return j(e).unparamCount>0}(e)?{shouldNotifyUnnamedTransactions:!0,compatibleProjects:n,forceTransactionsOnly:!1}:{forceTransactionsOnly:!1}:r}function j(e){let{sum:t}=e;try{const e=Number(t.metrics);return{metricsCount:e,unparamCount:Number(t.metrics_unparam),nullCount:Number(t.metrics_null)}}catch(e){return{metricsCount:0,unparamCount:0,nullCount:0}}}},"./app/utils/performance/contexts/metricsEnhancedSetting.tsx":(e,t,r)=>{r.d(t,{Ar:()=>g,Eg:()=>x,gp:()=>v,kP:()=>y,nP:()=>p,nl:()=>m,oR:()=>h,tm:()=>f}),r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/core-js/modules/es.array.includes.js"),r("../node_modules/core-js/modules/es.string.replace.js");var n=r("../node_modules/react/index.js"),o=r("../node_modules/react-router/es/index.js"),s=(r("./app/utils/localStorage.tsx"),r("./app/utils/queryString.tsx")),i=r("./app/utils/useOrganization.tsx"),a=r("./app/utils/performance/contexts/utils.tsx"),c=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const[l,u,d]=(0,a.n)({name:"MetricsEnhancedSettingContext"}),p=d.Consumer;let m,h;!function(e){e.unset="unset",e.metrics="metrics",e.transactions="transactions"}(m||(m={})),function(e){e.auto="auto",e.metricsOnly="metricsOnly",e.transactionsOnly="transactionsOnly"}(h||(h={}));const g="metricSetting",f="metricSearchSetting";function v(e){const t=function(e){return e.features.includes("performance-use-metrics")}(e),r=e.features.includes("performance-transaction-name-only-search"),n=e.features.includes("server-side-sampling")&&e.features.includes("mep-rollout-flag");return t||r||n}const y=e=>{var t;let{children:r,location:a,_hasMEPState:u,forceTransactions:d}=e;const p=v((0,i.Z)()),f=[h.metricsOnly,h.transactionsOnly],y=a?(0,s.ro)(a.query[g]):h.metricsOnly;let x=h.metricsOnly;d&&(x=h.transactionsOnly);const b=null!==(t=f.find((e=>e===y)))&&void 0!==t?t:x,P=void 0!==u,[w,j]=(0,n.useReducer)(((e,t)=>t),b),_=(0,n.useCallback)((e=>{a&&(o.browserHistory.replace({...a,query:{...a.query,[g]:e}}),j(e))}),[a,j]),[C,D]=(0,n.useReducer)(((e,t)=>t),m.unset),S=P?u:w,Z=p&&S===h.auto,E=p&&S===h.metricsOnly,O=p&&S===h.transactionsOnly,L=`${S}`;return(0,c.tZ)(l,{value:{autoSampleState:C,metricSettingState:S,shouldQueryProvideMEPAutoParams:Z,shouldQueryProvideMEPMetricParams:E,shouldQueryProvideMEPTransactionParams:O,memoizationKey:L,setMetricSettingState:_,setAutoSampleState:D},children:r})};y.displayName="MEPSettingProvider";const x=u},"./app/utils/performance/contexts/performanceEventViewContext.tsx":(e,t,r)=>{r.d(t,{bq:()=>o,uL:()=>i}),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("./app/utils/performance/contexts/utils.tsx");const[o,s,i]=(0,n.n)({name:"PerformanceEventViewContext"})},"./app/utils/performance/contexts/utils.tsx":(e,t,r)=>{r.d(t,{n:()=>o}),r("../node_modules/core-js/modules/es.error.cause.js");var n=r("../node_modules/react/index.js");function o(e){const{strict:t=!0,errorMessage:r=`useContext for "${e.name}" must be inside a Provider with a value`,name:o}=e,s=(0,n.createContext)(void 0);return s.displayName=o,[s.Provider,function(){const e=(0,n.useContext)(s);if(!e&&t)throw new Error(r);return e},s]}},"./app/views/performance/index.tsx":(e,t,r)=>{r.r(t),r.d(t,{default:()=>p});var n=r("./app/components/acl/feature.tsx"),o=r("./app/components/alert.tsx"),s=r("./app/locale.tsx"),i=r("./app/styles/organization.tsx"),a=r("./app/utils/performance/contexts/metricsCardinality.tsx"),c=r("./app/utils/performance/contexts/metricsEnhancedSetting.tsx"),l=r("./app/utils/withOrganization.tsx"),u=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function d(e){let{organization:t,location:r,children:l}=e;return(0,u.tZ)(n.Z,{hookName:"feature-disabled:performance-page",features:["performance-view"],organization:t,renderDisabled:function(){return(0,u.tZ)(i.JH,{children:(0,u.tZ)(o.Z,{type:"warning",children:(0,s.t)("You don't have access to this feature")})})},children:(0,u.tZ)(a.BT,{location:r,organization:t,children:(0,u.tZ)(c.kP,{children:l})})})}d.displayName="PerformanceContainer";const p=(0,l.Z)(d)}}]);
//# sourceMappingURL=../sourcemaps/app_views_performance_index_tsx.a8d5ef8c48a774e6e4181cc45e0ee111.js.map