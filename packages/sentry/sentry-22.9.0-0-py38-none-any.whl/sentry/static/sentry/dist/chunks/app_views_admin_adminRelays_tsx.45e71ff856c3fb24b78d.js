"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_admin_adminRelays_tsx"],{"./app/components/links/linkWithConfirmation.tsx":(t,e,s)=>{s.d(e,{Z:()=>l});var r=s("./app/components/confirm.tsx"),o=s("./app/components/links/anchor.tsx"),n=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function i(t){let{className:e,disabled:s,title:i,children:l,...a}=t;return(0,n.tZ)(r.Z,{...a,disabled:s,children:(0,n.tZ)(o.Z,{href:"#",className:e,disabled:s,title:i,children:l})})}i.displayName="LinkWithConfirmation";const l=i},"./app/components/resultGrid.tsx":(t,e,s)=>{s.d(e,{Z:()=>y});var r=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),n=s("../node_modules/react-router/es/index.js"),i=s("./app/components/dropdownLink.tsx"),l=s("./app/components/menuItem.tsx"),a=s("./app/components/pagination.tsx"),d=s("./app/icons/index.tsx"),h=s("./app/utils/withApi.tsx"),p=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class u extends o.Component{constructor(){super(...arguments),(0,r.Z)(this,"getSelector",(()=>(0,p.BX)(i.Z,{title:this.getCurrentLabel(),children:[this.getDefaultItem(),this.props.options.map((t=>{let[e,s]=t;const r={[this.props.queryKey]:e,cursor:""},o={...this.props.location.query,...r};return(0,p.tZ)(l.Z,{isActive:this.props.value===e,to:{pathname:this.props.path,query:o},children:s},e)}))]})))}getCurrentLabel(){const t=this.props.options.find((t=>{var e;return t[0]===(null!==(e=this.props.value)&&void 0!==e?e:"")}));return t?this.props.name+": "+t[1]:this.props.name+": Any"}getDefaultItem(){const t={...this.props.location.query,cursor:""};return delete t[this.props.queryKey],(0,p.tZ)(l.Z,{isActive:""===this.props.value||!this.props.value,to:{pathname:this.props.path,query:t},children:"Any"},"")}render(){return(0,p.tZ)("div",{className:"filter-options",children:1===this.props.options.length?(0,p.tZ)("strong",{children:this.getCurrentLabel()}):this.getSelector()})}}u.displayName="Filter";class c extends o.Component{getCurrentSortLabel(){var t;return null===(t=this.props.options.find((t=>{let[e]=t;return e===this.props.value})))||void 0===t?void 0:t[1]}getSortBySelector(){return(0,p.tZ)(i.Z,{title:this.getCurrentSortLabel(),className:"sorted-by",children:this.props.options.map((t=>{let[e,s]=t;const r={...this.props.location.query,sortBy:e,cursor:""};return(0,p.tZ)(l.Z,{isActive:this.props.value===e,to:{pathname:this.props.path,query:r},children:s},e)}))})}render(){return 0===this.props.options.length?null:(0,p.BX)("div",{className:"sort-options",children:["Showing results sorted by",1===this.props.options.length?(0,p.tZ)("strong",{className:"sorted-by",children:this.getCurrentSortLabel()}):this.getSortBySelector()]})}}c.displayName="SortBy";class m extends o.Component{constructor(){super(...arguments),(0,r.Z)(this,"state",this.defaultState),(0,r.Z)(this,"onSearch",(t=>{var e,s;const r=null!==(e=this.props.location)&&void 0!==e?e:{},{query:o}=this.state,i={...null!==(s=r.query)&&void 0!==s?s:{},query:o,cursor:""};t.preventDefault(),n.browserHistory.push({pathname:this.props.path,query:i})})),(0,r.Z)(this,"onQueryChange",(t=>{this.setState({query:t.target.value})}))}componentWillMount(){this.fetchData()}componentWillReceiveProps(){var t,e;const s=this.query;this.setState({query:null!==(t=s.query)&&void 0!==t?t:"",sortBy:null!==(e=s.sortBy)&&void 0!==e?e:this.props.defaultSort,filters:{...s},pageLinks:null,loading:!0,error:!1},this.fetchData)}get defaultState(){var t,e;const s=this.query;return{rows:[],loading:!0,error:!1,pageLinks:null,query:null!==(t=s.query)&&void 0!==t?t:"",sortBy:null!==(e=s.sortBy)&&void 0!==e?e:this.props.defaultSort,filters:{...s}}}get query(){var t,e;return null!==(t=(null!==(e=this.props.location)&&void 0!==e?e:{}).query)&&void 0!==t?t:{}}remountComponent(){this.setState(this.defaultState,this.fetchData)}refresh(){this.setState({loading:!0},this.fetchData)}fetchData(){const t={...this.props.defaultParams,sortBy:this.state.sortBy,...this.query};this.props.api.request(this.props.endpoint,{method:this.props.method,data:t,success:(t,e,s)=>{var r;this.setState({loading:!1,error:!1,rows:t,pageLinks:null!==(r=null==s?void 0:s.getResponseHeader("Link"))&&void 0!==r?r:null})},error:()=>{this.setState({loading:!1,error:!0})}})}renderLoading(){return(0,p.tZ)("tr",{children:(0,p.tZ)("td",{colSpan:this.props.columns.length,children:(0,p.BX)("div",{className:"loading",children:[(0,p.tZ)("div",{className:"loading-indicator"}),(0,p.tZ)("div",{className:"loading-message",children:"Hold on to your butts!"})]})})})}renderError(){return(0,p.tZ)("tr",{children:(0,p.tZ)("td",{colSpan:this.props.columns.length,children:(0,p.tZ)("div",{className:"alert-block alert-error",children:"Something bad happened :("})})})}renderNoResults(){return(0,p.tZ)("tr",{children:(0,p.tZ)("td",{colSpan:this.props.columns.length,children:"No results found."})})}renderResults(){return this.state.rows.map((t=>{var e,s,r,o;return(0,p.tZ)("tr",{children:null===(r=(o=this.props).columnsForRow)||void 0===r?void 0:r.call(o,t)},null===(e=(s=this.props).keyForRow)||void 0===e?void 0:e.call(s,t))}))}render(){const{filters:t,sortOptions:e,path:s,location:r}=this.props;return(0,p.BX)("div",{className:"result-grid",children:[(0,p.BX)("div",{className:"table-options",children:[this.props.hasSearch&&(0,p.tZ)("div",{className:"result-grid-search",children:(0,p.tZ)("form",{onSubmit:this.onSearch,children:(0,p.BX)("div",{className:"form-group",children:[(0,p.tZ)("input",{type:"text",className:"form-control input-search",placeholder:"search",style:{width:300},name:"query",autoComplete:"off",value:this.state.query,onChange:this.onQueryChange}),(0,p.tZ)("button",{type:"submit",className:"btn btn-sm btn-primary",children:(0,p.tZ)(d.jV,{size:"xs"})})]})})}),(0,p.tZ)(c,{options:null!=e?e:[],value:this.state.sortBy,path:null!=s?s:"",location:r}),Object.keys(null!=t?t:{}).map((e=>(0,p.tZ)(u,{queryKey:e,value:this.state.filters[e],path:null!=s?s:"",location:r,...null==t?void 0:t[e]},e)))]}),(0,p.BX)("table",{className:"table table-grid",children:[(0,p.tZ)("thead",{children:(0,p.tZ)("tr",{children:this.props.columns})}),(0,p.tZ)("tbody",{children:this.state.loading?this.renderLoading():this.state.error?this.renderError():0===this.state.rows.length?this.renderNoResults():this.renderResults()})]}),this.props.hasPagination&&this.state.pageLinks&&(0,p.tZ)(a.Z,{pageLinks:this.state.pageLinks})]})}}m.displayName="ResultGrid",(0,r.Z)(m,"defaultProps",{path:"",endpoint:"",method:"GET",columns:[],sortOptions:[],filters:{},defaultSort:"",keyForRow:t=>t.id,columnsForRow:()=>[],defaultParams:{per_page:50},hasPagination:!0,hasSearch:!1});const y=(0,h.Z)(m)},"./app/views/admin/adminRelays.tsx":(t,e,s)=>{s.r(e),s.d(e,{AdminRelays:()=>c,default:()=>m});var r=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),n=s("../node_modules/moment/moment.js"),i=s.n(n),l=s("./app/components/links/linkWithConfirmation.tsx"),a=s("./app/components/resultGrid.tsx"),d=s("./app/locale.tsx"),h=s("./app/utils/withApi.tsx"),p=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const u=t=>i()(t).format("ll LTS");class c extends o.Component{constructor(){super(...arguments),(0,r.Z)(this,"state",{loading:!1})}onDelete(t){this.setState({loading:!0}),this.props.api.request(`/relays/${t}/`,{method:"DELETE",success:()=>this.setState({loading:!1}),error:()=>this.setState({loading:!1})})}getRow(t){return[(0,p.tZ)("td",{children:(0,p.tZ)("strong",{children:t.relayId})},"id"),(0,p.tZ)("td",{children:t.publicKey},"key"),(0,p.tZ)("td",{style:{textAlign:"right"},children:u(t.firstSeen)},"firstSeen"),(0,p.tZ)("td",{style:{textAlign:"right"},children:u(t.lastSeen)},"lastSeen"),(0,p.tZ)("td",{style:{textAlign:"right"},children:(0,p.tZ)("span",{className:"editor-tools",children:(0,p.tZ)(l.Z,{className:"danger",title:"Remove",message:(0,d.t)("Are you sure you wish to delete this relay?"),onConfirm:()=>this.onDelete(t.id),children:(0,d.t)("Remove")})})},"tools")]}render(){const t=[(0,p.tZ)("th",{style:{width:350,textAlign:"left"},children:"Relay"},"id"),(0,p.tZ)("th",{children:"Public Key"},"key"),(0,p.tZ)("th",{style:{width:150,textAlign:"right"},children:"First seen"},"firstSeen"),(0,p.tZ)("th",{style:{width:150,textAlign:"right"},children:"Last seen"},"lastSeen"),(0,p.tZ)("th",{},"tools")];return(0,p.BX)("div",{children:[(0,p.tZ)("h3",{children:(0,d.t)("Relays")}),(0,p.tZ)(a.Z,{path:"/manage/relays/",endpoint:"/relays/",method:"GET",columns:t,columnsForRow:this.getRow,hasSearch:!1,sortOptions:[["firstSeen","First seen"],["lastSeen","Last seen"],["relayId","Relay ID"]],defaultSort:"firstSeen",...this.props})]})}}c.displayName="AdminRelays";const m=(0,h.Z)(c)}}]);
//# sourceMappingURL=../sourcemaps/app_views_admin_adminRelays_tsx.4676a39672553c42ca02f42bfa7941e2.js.map