"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_dashboardsV2_dashboard_tsx"],{"./app/actionCreators/dashboards.tsx":(e,t,i)=>{i.d(t,{AK:()=>p,JR:()=>u,QL:()=>m,Y:()=>h,a_:()=>c,iM:()=>g,j2:()=>l});var s=i("../node_modules/lodash/omit.js"),a=i.n(s),o=i("./app/actionCreators/indicator.tsx"),r=i("./app/constants/pageFilters.tsx"),n=i("./app/locale.tsx"),d=i("./app/views/dashboardsV2/utils.tsx");function l(e,t){const i=e.requestPromise(`/organizations/${t}/dashboards/`,{method:"GET",query:{sort:"myDashboardsAndRecentlyViewed"}});return i.catch((e=>{var t;const i=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;if(i){const e=(0,d.Tk)(i,{});(0,o.Iw)(e[Object.keys(e)[0]])}else(0,o.Iw)((0,n.t)("Unable to fetch dashboards"))})),i}function u(e,t,i,s){const{title:r,widgets:l,projects:u,environment:c,period:p,start:h,end:g,filters:m,utc:b}=i,w=e.requestPromise(`/organizations/${t}/dashboards/`,{method:"POST",data:{title:r,widgets:l.map((e=>a()(e,["tempId"]))),duplicate:s,projects:u,environment:c,period:p,start:h,end:g,filters:m,utc:b},query:{project:u}});return w.catch((e=>{var t;const i=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;if(i){const e=(0,d.Tk)(i,{});(0,o.Iw)(e[Object.keys(e)[0]])}else(0,o.Iw)((0,n.t)("Unable to create dashboard"))})),w}function c(e,t,i){return e.requestPromise(`/organizations/${t}/dashboards/${i}/visit/`,{method:"POST"})}function p(e,t,i){const s=e.requestPromise(`/organizations/${t}/dashboards/${i}/`,{method:"GET"});return s.catch((e=>{var t;const i=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;if(i){const e=(0,d.Tk)(i,{});(0,o.Iw)(e[Object.keys(e)[0]])}else(0,o.Iw)((0,n.t)("Unable to load dashboard"))})),s}function h(e,t,i){const{title:s,widgets:r,projects:l,environment:u,period:c,start:p,end:h,filters:g,utc:m}=i,b={title:s,widgets:r.map((e=>a()(e,["tempId"]))),projects:l,environment:u,period:c,start:p,end:h,filters:g,utc:m},w=e.requestPromise(`/organizations/${t}/dashboards/${i.id}/`,{method:"PUT",data:b,query:{project:l}});return w.catch((e=>{var t;const i=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;if(i){const e=(0,d.Tk)(i,{});(0,o.Iw)(e[Object.keys(e)[0]])}else(0,o.Iw)((0,n.t)("Unable to update dashboard"))})),w}function g(e,t,i){const s=e.requestPromise(`/organizations/${t}/dashboards/${i}/`,{method:"DELETE"});return s.catch((e=>{var t;const i=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;if(i){const e=(0,d.Tk)(i,{});(0,o.Iw)(e[Object.keys(e)[0]])}else(0,o.Iw)((0,n.t)("Unable to delete dashboard"))})),s}function m(e,t,i){return e.requestPromise(`/organizations/${t}/dashboards/widgets/`,{method:"POST",data:i,query:{project:[r.mP]}})}},"./app/views/dashboardsV2/dashboard.tsx":(e,t,i)=>{i.d(t,{re:()=>F,ey:()=>Y,ZP:()=>ie});var s=i("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=(i("../node_modules/core-js/modules/web.dom-collections.iterator.js"),i("../node_modules/core-js/modules/es.array.includes.js"),i("../node_modules/react-grid-layout/css/styles.css"),i("../node_modules/react-resizable/css/styles.css"),i("../node_modules/react/index.js")),r=i("../node_modules/react-grid-layout/index.js"),n=i("../node_modules/react-lazyload/lib/index.js"),d=i("../node_modules/@dnd-kit/core/dist/core.esm.js"),l=i("../node_modules/@dnd-kit/sortable/dist/sortable.esm.js"),u=i("../node_modules/lodash/cloneDeep.js"),c=i.n(u),p=i("../node_modules/lodash/debounce.js"),h=i.n(p),g=i("../node_modules/lodash/isEqual.js"),m=i.n(g),b=i("./app/actionCreators/dashboards.tsx"),w=i("./app/actionCreators/indicator.tsx"),y=i("./app/actionCreators/members.tsx"),x=i("./app/actionCreators/tags.tsx"),f=i("./app/components/button.tsx"),v=i("./app/icons/index.tsx"),Z=i("./app/locale.tsx"),z=i("./app/styles/space.tsx"),D=i("./app/utils/theme.tsx"),k=i("./app/utils/withApi.tsx"),W=i("./app/utils/withPageFilters.tsx"),C=i("./app/views/dashboardsV2/types.tsx"),E=i("../node_modules/framer-motion/dist/es/render/dom/motion.mjs");const T=(0,a.Z)(E.E.div,{target:"ec3gecx0"})("position:relative;touch-action:manipulation;",(e=>"big_number"===e.displayType?`\n          /* 2 cols */\n          grid-area: span 1 / span 2;\n\n          @media (min-width: ${e.theme.breakpoints.small}) {\n            /* 4 cols */\n            grid-area: span 1 / span 1;\n          }\n\n          @media (min-width: ${e.theme.breakpoints.xlarge}) {\n            /* 6 and 8 cols */\n            grid-area: span 1 / span 2;\n          }\n        `:"\n          /* 2, 4, 6 and 8 cols */\n          grid-area: span 2 / span 2;\n        "),";");var _=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const j="add-widget-button",I={x:0,y:0,scaleX:1,scaleY:1};function R(e){let{onAddWidget:t}=e;const{setNodeRef:i,transform:s}=(0,l.nB)({disabled:!0,id:j,transition:null});return(0,_.tZ)(T,{ref:i,displayType:C.FO.BIG_NUMBER,layoutId:j,style:{originX:0,originY:0},animate:s?{x:s.x,y:s.y,scaleX:null!=s&&s.scaleX&&s.scaleX<=1?s.scaleX:1,scaleY:null!=s&&s.scaleY&&s.scaleY<=1?s.scaleY:1}:I,transition:{duration:.25},children:(0,_.tZ)(P,{onClick:t,children:(0,_.tZ)(M,{"data-test-id":"widget-add",icon:(0,_.tZ)(v.N_,{size:"lg",isCircled:!0,color:"inactive"}),"aria-label":(0,Z.t)("Add widget")})})},"add")}R.displayName="AddWidget";const S=R,M=(0,a.Z)(f.ZP,{target:"e1sxcph31"})({name:"6ayxgl",styles:"border:none;&,&:focus,&:active,&:hover{background:transparent;box-shadow:none;}"}),P=(0,a.Z)("div",{target:"e1sxcph30"})("width:100%;height:110px;border:2px dashed ",(e=>e.theme.border),";border-radius:",(e=>e.theme.borderRadius),";display:flex;align-items:center;justify-content:center;cursor:",(e=>e.onClick?"pointer":""),";");var L=i("./app/views/dashboardsV2/layoutUtils.tsx"),B=i("./app/components/panels/panelAlert.tsx"),A=i("./app/utils/withOrganization.tsx"),q=i("./app/views/dashboardsV2/widgetCard/index.tsx");function V(e){const{organization:t,widget:i,dragId:s,isEditing:a,widgetLimitReached:r,onDelete:n,onEdit:d,onDuplicate:u,isPreview:c,isMobile:p,windowWidth:h,index:g,dashboardFilters:m}=e,{attributes:b,listeners:w,setNodeRef:y,transform:x,isDragging:f,isSorting:v}=(0,l.nB)({id:s,transition:null});(0,o.useEffect)((()=>{if(f)return document.body.style.cursor="grabbing",function(){document.body.style.cursor=""}}),[f]);let Z={widget:i,isEditing:a,widgetLimitReached:r,onDelete:n,onEdit:d,onDuplicate:u,isSorting:v,hideToolbar:v,currentWidgetDragging:f,showContextMenu:!0,isPreview:c,showWidgetViewerButton:t.features.includes("widget-viewer-modal"),index:g,dashboardFilters:m,renderErrorMessage:e=>"string"==typeof e&&(0,_.tZ)(B.Z,{type:"error",children:e})};return t.features.includes("dashboard-grid-layout")?(Z={...Z,isMobile:p,windowWidth:h,isSorting:!1,currentWidgetDragging:!1,tableItemLimit:20},(0,_.tZ)($,{children:(0,_.tZ)(q.Z,{...Z})})):(Z={...Z,draggableProps:{attributes:b,listeners:w}},(0,_.tZ)(T,{ref:y,displayType:i.displayType,layoutId:s,style:{originX:f?1:0,originY:0,boxShadow:f?D.ZP.dropShadowHeavy:"none",borderRadius:f?D.ZP.borderRadius:void 0},animate:x?{x:x.x,y:x.y,scaleX:null!=x&&x.scaleX&&x.scaleX<=1?x.scaleX:1,scaleY:null!=x&&x.scaleY&&x.scaleY<=1?x.scaleY:1,zIndex:f?D.ZP.zIndex.modal:"auto"}:{zIndex:"auto"},transformTemplate:(e,t)=>a&&x?t:"none",transition:{duration:f?0:.25,easings:{type:"spring"}},children:(0,_.tZ)(q.Z,{...Z})}))}V.displayName="SortableWidget";const O=(0,A.Z)(V),$=(0,a.Z)("div",{target:"e12vujy00"})({name:"13udsys",styles:"height:100%"});var N=i("./app/views/dashboardsV2/utils.tsx"),U=i("../node_modules/@emotion/react/dist/emotion-react.browser.esm.js");const F="widget-drag",X="desktop",H="mobile",Y=6,G=[16,16],J={x:0,y:Number.MAX_SAFE_INTEGER},K=parseInt(D.ZP.breakpoints.small,10),Q={[H]:0,[X]:K},ee={[H]:2,[X]:Y};class te extends o.Component{constructor(e){super(e),(0,s.Z)(this,"forceCheckTimeout",void 0),(0,s.Z)(this,"debouncedHandleResize",h()((()=>{this.setState({windowWidth:window.innerWidth})}),250)),(0,s.Z)(this,"handleStartAdd",(()=>{const{organization:e,router:t,location:i,paramDashboardId:s}=this.props;s?t.push({pathname:`/organizations/${e.slug}/dashboard/${s}/widget/new/`,query:{...i.query,source:C.EN.DASHBOARDS}}):t.push({pathname:`/organizations/${e.slug}/dashboards/new/widget/new/`,query:{...i.query,source:C.EN.DASHBOARDS}})})),(0,s.Z)(this,"handleUpdateComplete",(e=>t=>{const{isEditing:i,onUpdate:s,handleUpdateWidgetList:a}=this.props;let o=[...this.props.dashboard.widgets];const r=o.indexOf(e),n={...t,tempId:e.tempId};(0,L.I_)(e.displayType)!==(0,L.I_)(t.displayType)?(o[r]=(0,L.W8)(n),o=(0,L.Bb)(o)):o[r]=n,s(o),i||a(o)})),(0,s.Z)(this,"handleDeleteWidget",(e=>()=>{const{dashboard:t,onUpdate:i,isEditing:s,handleUpdateWidgetList:a}=this.props;let o=t.widgets.filter((t=>t!==e));o=(0,L.Bb)(o),i(o),s||a(o)})),(0,s.Z)(this,"handleDuplicateWidget",((e,t)=>()=>{const{dashboard:i,onUpdate:s,isEditing:a,handleUpdateWidgetList:o}=this.props,r=c()((0,L.TE)({...e,id:void 0,tempId:void 0}));let n=[...i.widgets];n.splice(t,0,r),n=(0,L.Bb)(n),s(n),a||o(n)})),(0,s.Z)(this,"handleEditWidget",(e=>()=>{const{organization:t,router:i,location:s,paramDashboardId:a}=this.props;a?i.push({pathname:`/organizations/${t.slug}/dashboard/${a}/widget/${e}/edit/`,query:{...s.query,source:C.EN.DASHBOARDS}}):i.push({pathname:`/organizations/${t.slug}/dashboards/new/widget/${e}/edit/`,query:{...s.query,source:C.EN.DASHBOARDS}})})),(0,s.Z)(this,"handleLayoutChange",((e,t)=>{const{isMobile:i}=this.state,{dashboard:s,onUpdate:a}=this.props,o=e=>{let{i:t}=e;return t!==j},r={[X]:t.desktop.filter(o),[H]:t.mobile.filter(o)};let d=(0,L.Sp)(r.desktop);const l=s.widgets.map((e=>{const t=(0,L.Yb)(e);let s=r.desktop.find((e=>{let{i}=e;return i===t}));if(!s){const a=(0,L.I_)(e.displayType),o={w:L.c6,h:a,minH:a,i:t},[n,l]=(0,L.Hh)(d,a);if(d=l,s={...o,...n},i){const e=r.mobile.filter((e=>{let{i}=e;return i!==t}));e.push({...o,...J}),r.mobile=e}}return{...e,layout:(0,L.hq)(s)}}));this.setState({layouts:r}),a(l),window.clearTimeout(this.forceCheckTimeout),this.forceCheckTimeout=window.setTimeout(n.be,400)})),(0,s.Z)(this,"handleBreakpointChange",(e=>{const{layouts:t}=this.state,{dashboard:{widgets:i}}=this.props;e!==H?this.setState({isMobile:!1}):this.setState({isMobile:!0,layouts:{...t,[H]:(0,L.VW)(t.desktop,i)}})})),(0,s.Z)(this,"renderDndDashboard",(()=>{const{isEditing:e,onUpdate:t,dashboard:i,organization:s,widgetLimitReached:a}=this.props;let{widgets:o}=i;o=o.filter((e=>{let{widgetType:t}=e;return t!==C.l9.RELEASE||s.features.includes("dashboards-releases")}));const r=this.getWidgetIds();return(0,_.tZ)(d.LB,{collisionDetection:d.pE,onDragEnd:e=>{let{over:i,active:s}=e;const a=s.id,n=r.indexOf.bind(r),d=a?n(a):-1;if(i&&i.id!==j){const e=n(i.id);d!==e&&t((0,l.Rp)(o,d,e))}},children:(0,_.tZ)(se,{children:(0,_.BX)(l.Fo,{items:r,strategy:l.U2,children:[o.map(((e,t)=>this.renderWidget(e,t))),e&&!a&&(0,_.tZ)(S,{onAddWidget:this.handleStartAdd})]})})})}));const{dashboard:t,organization:i}=e,a=i.features.includes("dashboard-grid-layout"),o=(0,L.RI)(t.widgets);this.state={isMobile:!1,layouts:{[X]:a?o:[],[H]:a?(0,L.VW)(o,t.widgets):[]},windowWidth:window.innerWidth}}static getDerivedStateFromProps(e,t){if(e.organization.features.includes("dashboard-grid-layout")){if(t.isMobile)return null;const i=(0,L.RI)(e.dashboard.widgets);if(!m()(i.map(L.hq),t.layouts.desktop.map(L.hq)))return{...t,layouts:{[X]:i,[H]:(0,L.VW)(i,e.dashboard.widgets)}}}return null}componentDidMount(){const{organization:e,newWidget:t}=this.props;e.features.includes("dashboard-grid-layout")&&window.addEventListener("resize",this.debouncedHandleResize),this.fetchTags(),t&&this.addNewWidget(),this.fetchMemberList()}componentDidUpdate(e){const{selection:t,newWidget:i}=this.props;i&&i!==e.newWidget&&this.addNewWidget(),m()(e.selection.projects,t.projects)||this.fetchMemberList()}componentWillUnmount(){this.props.organization.features.includes("dashboard-grid-layout")&&window.removeEventListener("resize",this.debouncedHandleResize),window.clearTimeout(this.forceCheckTimeout)}fetchMemberList(){var e;const{api:t,selection:i}=this.props;(0,y.MA)(t,this.props.organization.slug,null===(e=i.projects)||void 0===e?void 0:e.map((e=>String(e))))}async addNewWidget(){const{api:e,organization:t,newWidget:i,handleAddCustomWidget:s,onSetNewWidget:a}=this.props;if(i)try{await(0,b.QL)(e,t.slug,i),s(i),null==a||a()}catch(e){(0,w.Iw)(e)}}fetchTags(){const{api:e,organization:t,selection:i}=this.props;(0,x.QK)(e,t.slug,i)}getWidgetIds(){return[...this.props.dashboard.widgets.map(((e,t)=>(0,L.$n)(e,t))),j]}renderWidget(e,t){var i;const{isMobile:s,windowWidth:a}=this.state,{isEditing:o,organization:r,widgetLimitReached:n,isPreview:d,dashboard:l,location:u}=this.props,c={widget:e,isEditing:o,widgetLimitReached:n,onDelete:this.handleDeleteWidget(e),onEdit:this.handleEditWidget(t),onDuplicate:this.handleDuplicateWidget(e,t),isPreview:d,dashboardFilters:null!==(i=(0,N.lM)(u))&&void 0!==i?i:l.filters};if(r.features.includes("dashboard-grid-layout")){const i=(0,L.Yb)(e),o=i;return(0,_.tZ)("div",{"data-grid":e.layout,children:(0,_.tZ)(O,{...c,dragId:o,isMobile:s,windowWidth:a,index:String(t)})},i)}const p=(0,L.$n)(e,t),h=p;return(0,U.az)(O,{...c,key:p,dragId:h,index:String(t)})}get addWidgetLayout(){const{isMobile:e,layouts:t}=this.state;let i=J;if(!e){const e=(0,L.Sp)(t.desktop),[s]=(0,L.Hh)(e,1);i=s}return{...i,w:L.c6,h:1,isResizable:!1}}renderGridDashboard(){const{layouts:e,isMobile:t}=this.state,{isEditing:i,dashboard:s,organization:a,widgetLimitReached:o}=this.props;let{widgets:r}=s;r=r.filter((e=>{let{widgetType:t}=e;return t!==C.l9.RELEASE||a.features.includes("dashboards-releases")}));const n=(0,L.Sp)(e.desktop),d=(0,L._F)(r,n),l=!t&&i;return(0,_.BX)(oe,{breakpoints:Q,cols:ee,rowHeight:120,margin:G,draggableHandle:`.${F}`,draggableCancel:".widget-resize",layouts:e,onLayoutChange:this.handleLayoutChange,onBreakpointChange:this.handleBreakpointChange,isDraggable:l,isResizable:l,resizeHandle:(0,_.tZ)(re,{"aria-label":(0,Z.t)("Resize Widget"),"data-test-id":"custom-resize-handle",className:"widget-resize",size:"xs",borderless:!0,icon:(0,_.tZ)(v.Iq,{size:"xs"})}),useCSSTransforms:!1,isBounded:!0,children:[d.map(((e,t)=>this.renderWidget(e,t))),i&&!o&&(0,_.tZ)(ae,{"data-grid":this.addWidgetLayout,children:(0,_.tZ)(S,{onAddWidget:this.handleStartAdd})},j)]})}render(){const{organization:e}=this.props;return e.features.includes("dashboard-grid-layout")?this.renderGridDashboard():this.renderDndDashboard()}}te.displayName="Dashboard";const ie=(0,k.Z)((0,W.Z)(te)),se=(0,a.Z)("div",{target:"e1wa3gzn3"})("display:grid;grid-template-columns:repeat(2, minmax(0, 1fr));grid-auto-flow:row dense;gap:",(0,z.Z)(2),";@media (min-width: ",(e=>e.theme.breakpoints.medium),"){grid-template-columns:repeat(4, minmax(0, 1fr));}@media (min-width: ",(e=>e.theme.breakpoints.xlarge),"){grid-template-columns:repeat(6, minmax(0, 1fr));}@media (min-width: ",(e=>e.theme.breakpoints.xxlarge),"){grid-template-columns:repeat(8, minmax(0, 1fr));}"),ae=(0,a.Z)("div",{target:"e1wa3gzn2"})("z-index:5;background-color:",(e=>e.theme.background),";"),oe=(0,a.Z)((0,r.WidthProvider)(r.Responsive),{target:"e1wa3gzn1"})("margin:-",(0,z.Z)(2),";.react-grid-item.react-grid-placeholder{background:",(e=>e.theme.purple200),";border-radius:",(e=>e.theme.borderRadius),";}"),re=(0,a.Z)(f.ZP,{target:"e1wa3gzn0"})("position:absolute;z-index:2;bottom:",(0,z.Z)(.5),";right:",(0,z.Z)(.5),";color:",(e=>e.theme.subText),";cursor:nwse-resize;.react-resizable-hide &{display:none;}")},"./app/views/dashboardsV2/layoutUtils.tsx":(e,t,i)=>{i.d(t,{$n:()=>b,Bb:()=>E,Hh:()=>k,I_:()=>Z,RI:()=>f,Sp:()=>D,TE:()=>y,VW:()=>x,W8:()=>C,WJ:()=>z,Yb:()=>w,_F:()=>W,c6:()=>g,hq:()=>v}),i("../node_modules/core-js/modules/web.dom-collections.iterator.js"),i("../node_modules/core-js/modules/es.array.includes.js");var s=i("../node_modules/react-grid-layout/build/utils.js"),a=i("../node_modules/lodash/pickBy.js"),o=i.n(a),r=i("../node_modules/lodash/sortBy.js"),n=i.n(r),d=i("../node_modules/lodash/zip.js"),l=i.n(d),u=i("./app/utils.tsx"),c=i("./app/utils/guid.tsx"),p=i("./app/views/dashboardsV2/dashboard.tsx"),h=i("./app/views/dashboardsV2/types.tsx");const g=2,m=["x","y","w","h","minW","maxW","minH","maxH"];function b(e,t){return e.id?`${e.id}-index-${t}`:`index-${t}`}function w(e){var t;return`grid-item-${null!==(t=e.id)&&void 0!==t?t:e.tempId}`}function y(e){var t;return(null!==(t=e.id)&&void 0!==t?t:e.tempId)?e:{...e,tempId:(0,c.E)()}}function x(e,t){if(0===e.length)return[];const i=l()(e,t);return n()(i,["0.y","0.x"]).map(((e,t)=>{let[i,s]=e;return{...i,x:0,y:2*t,w:2,h:s.displayType===h.FO.BIG_NUMBER?1:2}}))}function f(e){return e.filter((e=>(0,u.ri)(e.layout))).map((e=>{let{layout:t,...i}=e;return{...t,i:w(i)}}))}function v(e){return o()(e,((e,t)=>(0,u.ri)(e)&&m.includes(t)))}function Z(e){return e===h.FO.BIG_NUMBER?1:2}function z(){return Array(p.ey).fill(0)}function D(e){const t=z();return e.forEach((e=>{let{x:i,w:s,y:a,h:o}=e;for(let e=i;e<i+s;e++)t[e]=Math.max(a+o,t[e])})),t}function k(e,t){const i=[...e],s=Math.max(...i);for(let e=0;e<=s;e++)for(let s=0;s<=i.length-g;s++){if(i[s]>e)continue;const a=s+g;if(i.slice(s,a).every((t=>t<=e))){for(let a=s;a<s+g;a++)i[a]=e+t;return[{x:s,y:e},[...i]]}}for(let e=0;e<g;e++)i[e]=s;return[{x:0,y:s},[...i]]}function W(e,t){let i=[...t];return e.map((e=>{if((0,u.ri)(e.layout))return e;const t=Z(e.displayType),[s,a]=k(i,t);return i=a,{...e,layout:{...s,h:t,minH:t,w:g}}}))}function C(e){var t;const{displayType:i,layout:s}=e,a={...e};if(!(0,u.ri)(s))return a;const o=Z(i),r={...s,h:Math.max(null!==(t=null==s?void 0:s.h)&&void 0!==t?t:o,o),minH:o};return{...a,layout:r}}function E(e){const t=(0,s.compact)(f(e),"vertical",p.ey);return e.map((e=>{const i=t.find((t=>{let{i}=t;return i===w(e)}));return i?{...e,layout:i}:e}))}},"./app/views/dashboardsV2/widgetCard/index.tsx":(e,t,i)=>{i.d(t,{_:()=>G,Z:()=>H});var s=i("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=(i("../node_modules/core-js/modules/web.dom-collections.iterator.js"),i("../node_modules/core-js/modules/es.array.includes.js"),i("../node_modules/react/index.js")),r=i("../node_modules/react-lazyload/lib/index.js"),n=i("../node_modules/react-router/es/index.js"),d=i("./app/components/alert.tsx"),l=i("./app/components/button.tsx"),u=i("./app/components/charts/styles.tsx"),c=i("./app/components/errorBoundary.tsx"),p=i("./app/components/featureBadge.tsx"),h=i("./app/components/links/externalLink.tsx"),g=i("./app/components/panels/index.tsx"),m=i("./app/components/placeholder.tsx"),b=i("./app/components/searchSyntax/parser.tsx"),w=i("./app/components/tooltip.tsx"),y=i("./app/icons/index.tsx"),x=i("./app/locale.tsx"),f=i("./app/styles/space.tsx"),v=i("./app/utils/discover/fields.tsx"),Z=i("./app/utils/withApi.tsx"),z=i("./app/utils/withOrganization.tsx"),D=i("./app/utils/withPageFilters.tsx"),k=i("./app/views/dashboardsV2/dashboard.tsx"),W=i("./app/views/dashboardsV2/types.tsx"),C=i("./app/views/dashboardsV2/widgetBuilder/utils.tsx"),E=i("./app/views/dashboardsV2/widgetCard/dashboardsMEPContext.tsx"),T=i("./app/views/dashboardsV2/widgetCard/widgetCardChartContainer.tsx"),_=i("./app/actionCreators/modal.tsx"),j=i("./app/components/acl/feature.tsx"),I=i("./app/components/confirm.tsx"),R=i("./app/components/dropdownMenuControl.tsx"),S=i("./app/components/modals/widgetViewerModal/utils.tsx"),M=i("./app/components/tag.tsx"),P=i("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),L=i("./app/views/dashboardsV2/utils.tsx"),B=i("./app/views/dashboardsV2/widgetViewer/widgetViewerContext.tsx"),A=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function q(e){let{organization:t,selection:i,widget:s,widgetLimitReached:a,onDelete:o,onDuplicate:r,onEdit:n,showContextMenu:d,isPreview:l,showWidgetViewerButton:u,router:c,location:p,index:h,seriesData:g,tableData:m,pageLinks:b,totalIssuesCount:w,seriesResultsType:f}=e;const{isMetricsData:v}=(0,E.XA)();if(!d)return null;const Z=[],z=[],D=e=>{(0,S.X)(p.pathname)||c.push({pathname:`${p.pathname}${p.pathname.endsWith("/")?"":"/"}widget/${e}/`,query:p.query})};if(l)return(0,A.tZ)(B.M.Consumer,{children:e=>{let{setData:i}=e;return(0,A.BX)(O,{children:[(0,A.tZ)(j.Z,{organization:t,features:["dashboards-mep"],children:!1===v&&(0,A.tZ)(U,{tooltipText:(0,x.t)("This widget is only applicable to indexed events."),children:(0,x.t)("Indexed")})}),(0,A.tZ)($,{items:[{key:"preview",label:(0,x.t)("This is a preview only. To edit, you must add this dashboard.")}],triggerProps:{"aria-label":(0,x.t)("Widget actions"),size:"xs",borderless:!0,showChevron:!1,icon:(0,A.tZ)(y.YR,{direction:"down",size:"sm"})},placement:"bottom right",disabledKeys:[...z,"preview"]}),u&&(0,A.tZ)(N,{"aria-label":(0,x.t)("Open Widget Viewer"),priority:"link",size:"zero",icon:(0,A.tZ)(y.qp,{size:"xs"}),onClick:()=>{(g||m)&&i({seriesData:g,tableData:m,pageLinks:b,totalIssuesCount:w,seriesResultsType:f}),D(h)}})]})}});if(t.features.includes("discover-basic")&&s.widgetType===W.l9.DISCOVER&&s.queries.length){const e=(0,L.z1)(s,i,t,0,v);Z.push({key:"open-in-discover",label:(0,x.t)("Open in Discover"),to:1===s.queries.length?e:void 0,onAction:()=>{1!==s.queries.length?((0,P.Z)("dashboards_views.query_selector.opened",{organization:t,widget_type:s.displayType}),(0,_.openDashboardWidgetQuerySelectorModal)({organization:t,widget:s,isMetricsData:v})):(0,P.Z)("dashboards_views.open_in_discover.opened",{organization:t,widget_type:s.displayType})}})}if(s.widgetType===W.l9.ISSUE){const e=(0,L.hS)(s,i,t);Z.push({key:"open-in-issues",label:(0,x.t)("Open in Issues"),to:e})}return t.features.includes("dashboards-edit")&&(Z.push({key:"duplicate-widget",label:(0,x.t)("Duplicate Widget"),onAction:()=>null==r?void 0:r()}),a&&z.push("duplicate-widget"),Z.push({key:"edit-widget",label:(0,x.t)("Edit Widget"),onAction:()=>null==n?void 0:n()}),Z.push({key:"delete-widget",label:(0,x.t)("Delete Widget"),priority:"danger",onAction:()=>{(0,I._)({message:(0,x.t)("Are you sure you want to delete this widget?"),priority:"danger",onConfirm:()=>null==o?void 0:o()})}})),Z.length?(0,A.tZ)(B.M.Consumer,{children:e=>{let{setData:i}=e;return(0,A.BX)(O,{children:[(0,A.tZ)(j.Z,{organization:t,features:["dashboards-mep"],children:!1===v&&(0,A.tZ)(U,{tooltipText:(0,x.t)("This widget is only applicable to indexed events."),children:(0,x.t)("Indexed")})}),(0,A.tZ)($,{items:Z,triggerProps:{"aria-label":(0,x.t)("Widget actions"),size:"xs",borderless:!0,showChevron:!1,icon:(0,A.tZ)(y.YR,{direction:"down",size:"sm"})},placement:"bottom right",disabledKeys:[...z]}),u&&(0,A.tZ)(N,{"aria-label":(0,x.t)("Open Widget Viewer"),priority:"link",size:"zero",icon:(0,A.tZ)(y.qp,{size:"xs"}),onClick:()=>{var e;i({seriesData:g,tableData:m,pageLinks:b,totalIssuesCount:w,seriesResultsType:f}),D(null!==(e=s.id)&&void 0!==e?e:h)}})]})}}):null}q.displayName="WidgetCardContextMenu";const V=q,O=(0,a.Z)("div",{target:"e1yltioa3"})("display:flex;align-items:center;height:",(0,f.Z)(3),";margin-left:",(0,f.Z)(1),";"),$=(0,a.Z)(R.Z,{target:"e1yltioa2"})({name:"gbbqag",styles:"&>button{z-index:auto;}"}),N=(0,a.Z)(l.ZP,{target:"e1yltioa1"})("padding:",(0,f.Z)(.75)," ",(0,f.Z)(1),";color:",(e=>e.theme.textColor),";&:hover{color:",(e=>e.theme.textColor),";background:",(e=>e.theme.surface400),";border-color:transparent;}"),U=(0,a.Z)(M.Z,{target:"e1yltioa0"})("margin-right:",(0,f.Z)(.5),";"),F=["error.handled","error.unhandled","error.mechanism","error.type","error.value"];class X extends o.Component{constructor(){super(...arguments),(0,s.Z)(this,"state",{}),(0,s.Z)(this,"setData",(e=>{let{tableResults:t,timeseriesResults:i,totalIssuesCount:s,pageLinks:a,timeseriesResultsTypes:o}=e;this.setState({seriesData:i,tableData:t,totalIssuesCount:s,pageLinks:a,seriesResultsType:o})}))}renderToolbar(){const{onEdit:e,onDelete:t,onDuplicate:i,draggableProps:s,hideToolbar:a,isEditing:o,isMobile:r}=this.props;return o?(0,A.tZ)(J,{children:(0,A.BX)(K,{style:{visibility:a?"hidden":"visible"},children:[!r&&(0,A.tZ)(Q,{size:"xs","aria-label":(0,x.t)("Drag Widget"),icon:(0,A.tZ)(y.LS,{}),borderless:!0,className:k.re,...null==s?void 0:s.listeners,...null==s?void 0:s.attributes}),(0,A.tZ)(l.ZP,{"data-test-id":"widget-edit","aria-label":(0,x.t)("Edit Widget"),size:"xs",borderless:!0,onClick:e,icon:(0,A.tZ)(y.yl,{})}),(0,A.tZ)(l.ZP,{"aria-label":(0,x.t)("Duplicate Widget"),size:"xs",borderless:!0,onClick:i,icon:(0,A.tZ)(y.vU,{})}),(0,A.tZ)(l.ZP,{"data-test-id":"widget-delete","aria-label":(0,x.t)("Delete Widget"),borderless:!0,size:"xs",onClick:t,icon:(0,A.tZ)(y.Fz,{})})]})}):null}renderContextMenu(){const{widget:e,selection:t,organization:i,showContextMenu:s,isPreview:a,widgetLimitReached:o,onEdit:r,onDuplicate:n,onDelete:d,isEditing:l,showWidgetViewerButton:u,router:c,location:p,index:h}=this.props,{seriesData:g,tableData:m,pageLinks:b,totalIssuesCount:w,seriesResultsType:y}=this.state;return l?null:(0,A.tZ)(V,{organization:i,widget:e,selection:t,showContextMenu:s,isPreview:a,widgetLimitReached:o,onDuplicate:n,onEdit:r,onDelete:d,showWidgetViewerButton:u,router:c,location:p,index:h,seriesData:g,seriesResultsType:y,tableData:m,pageLinks:b,totalIssuesCount:w})}render(){const{api:e,organization:t,selection:i,widget:s,isMobile:a,renderErrorMessage:n,tableItemLimit:d,windowWidth:l,noLazyLoad:u,showStoredAlert:g,noDashboardsMEPProvider:m,dashboardFilters:y}=this.props;if(s.displayType===W.FO.TOP_N){const e=s.queries.map((e=>({...e,aggregates:e.aggregates.length?[e.aggregates[e.aggregates.length-1]]:[]})));s.queries=e,s.limit=C._k}const f=s.queries.some((e=>{let{columns:t,aggregates:i,conditions:s}=e;return F.some((e=>{var a;return t.includes(e)||i.some((t=>{var i;return null===(i=(0,v.dL)(t))||void 0===i?void 0:i.arguments.includes(e)}))||(null===(a=(0,b.UG)(s))||void 0===a?void 0:a.some((t=>{var i;return(null===(i=t.key)||void 0===i?void 0:i.value)===e})))}))}));return(0,A.tZ)(c.Z,{customComponent:(0,A.tZ)(Y,{children:(0,x.t)("Error loading widget data")}),children:(Z=(0,A.BX)(o.Fragment,{children:[(0,A.BX)(G,{isDragging:!1,children:[(0,A.BX)(te,{children:[(0,A.tZ)(w.Z,{title:s.title,containerDisplayMode:"grid",showOnlyOnOverflow:!0,children:(0,A.tZ)(ee,{children:s.title})}),this.renderContextMenu()]}),u?(0,A.tZ)(T.Z,{api:e,organization:t,selection:i,widget:s,isMobile:a,renderErrorMessage:n,tableItemLimit:d,windowWidth:l,onDataFetched:this.setData,dashboardFilters:y}):(0,A.tZ)(r.ZP,{once:!0,resize:!0,height:200,children:(0,A.tZ)(T.Z,{api:e,organization:t,selection:i,widget:s,isMobile:a,renderErrorMessage:n,tableItemLimit:d,windowWidth:l,onDataFetched:this.setData,dashboardFilters:y})}),this.renderToolbar()]}),(t.features.includes("dashboards-mep")||t.features.includes("mep-rollout-flag"))&&(0,A.tZ)(E.k,{children:e=>{let{isMetricsData:t}=e;return g&&!1===t&&s.widgetType===W.l9.DISCOVER&&!f?(0,A.BX)(ie,{showIcon:!0,children:[(0,x._N)("Your selection is only applicable to [indexedData: indexed event data]. We've automatically adjusted your results.",{indexedData:(0,A.tZ)(h.Z,{href:"https://docs.sentry.io/product/dashboards/widget-builder/#errors--transactions"})}),(0,A.tZ)(p.Z,{type:"beta"})]}):null}})]}),m?Z:(0,A.tZ)(E.KC,{children:Z}))});var Z}}X.displayName="WidgetCard";const H=(0,Z.Z)((0,z.Z)((0,D.Z)((0,n.withRouter)(X)))),Y=(0,a.Z)(m.Z,{target:"e1fl0u6g7"})("display:flex;align-items:center;justify-content:center;background-color:",(e=>e.theme.alert.error.backgroundLight),";border:1px solid ",(e=>e.theme.alert.error.border),";color:",(e=>e.theme.alert.error.textLight),";border-radius:",(e=>e.theme.borderRadius),";margin-bottom:",(0,f.Z)(2),";"),G=(0,a.Z)(g.s_,{shouldForwardProp:e=>"isDragging"!==e,target:"e1fl0u6g6"})("margin:0;visibility:",(e=>e.isDragging?"hidden":"visible"),";height:100%;min-height:96px;display:flex;flex-direction:column;"),J=(0,a.Z)("div",{target:"e1fl0u6g5"})("position:absolute;top:0;left:0;z-index:2;width:100%;height:100%;display:flex;justify-content:flex-end;align-items:flex-start;background-color:",(e=>e.theme.overlayBackgroundAlpha),";border-radius:",(e=>e.theme.borderRadius),";"),K=(0,a.Z)("div",{target:"e1fl0u6g4"})("display:flex;margin:",(0,f.Z)(1),";touch-action:none;"),Q=(0,a.Z)(l.ZP,{target:"e1fl0u6g3"})({name:"1fgcczm",styles:"cursor:grab"}),ee=(0,a.Z)(u.Gh,{target:"e1fl0u6g2"})((e=>e.theme.overflowEllipsis),";font-weight:normal;"),te=(0,a.Z)("div",{target:"e1fl0u6g1"})("padding:",(0,f.Z)(2)," ",(0,f.Z)(1)," 0 ",(0,f.Z)(3),";min-height:36px;width:100%;display:flex;align-items:center;justify-content:space-between;"),ie=(0,a.Z)(d.Z,{target:"e1fl0u6g0"})("margin-top:",(0,f.Z)(1),";margin-bottom:0;")},"./app/views/dashboardsV2/widgetViewer/widgetViewerContext.tsx":(e,t,i)=>{i.d(t,{M:()=>s});const s=(0,i("../node_modules/react/index.js").createContext)({setData:()=>{}})}}]);
//# sourceMappingURL=../sourcemaps/app_views_dashboardsV2_dashboard_tsx.f2423f36ef1a1cf07c1791c5302db76a.js.map