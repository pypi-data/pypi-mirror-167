"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_projectInstall_issueAlertOptions_tsx"],{"./app/views/alerts/rules/metric/presets.tsx":(e,t,n)=>{n.d(t,{g:()=>d});var s=n("./app/icons/index.tsx"),r=n("./app/locale.tsx"),a=n("./app/utils/guid.tsx"),i=n("./app/views/alerts/rules/metric/types.tsx");async function o(e,t,n){const s=(await e.requestPromise(`/organizations/${t}/events/`,{method:"GET",data:{statsPeriod:"7d",project:n,field:["count()","transaction"],sort:"-count",referrer:"alert.presets.highest-volume",query:"event.type:transaction",per_page:1}})).data[0];return s?[s.transaction,s["count()"]]:null}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return{label:i.F4.CRITICAL,alertThreshold:t,actions:e.teams.slice(0,4).map((e=>({type:i.Us.EMAIL,targetType:i.Lm.TEAM,targetIdentifier:e.id,unsavedDateCreated:(new Date).toISOString(),inputChannelId:null,options:null,unsavedId:(0,a.E)()})))}}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return{label:i.F4.WARNING,alertThreshold:e,actions:[]}}const d=[{id:"p95-highest-volume",title:(0,r.t)("Slow transactions"),description:"Get notified when important transactions are slower on average",Icon:s.TX,alertType:"trans_duration",makeUnqueriedContext:(e,t)=>({name:(0,r.t)("p95 Alert for %s",[e.slug]),aggregate:"p95(transaction.duration)",dataset:i.qz.TRANSACTIONS,eventTypes:[i.GM.TRANSACTION],timeWindow:60,comparisonDelta:1440,comparisonType:i.t6.CHANGE,thresholdType:i.lT.ABOVE,triggers:[l(e),c()]}),async makeContext(e,t,n){var s;const r=null===(s=await o(e,n.slug,t.id))||void 0===s?void 0:s[0];return{...this.makeUnqueriedContext(t,n),query:"transaction:"+r}}},{id:"throughput-highest-volume",title:(0,r.t)("Throttled throughput"),description:"Send an alert when transaction throughput drops significantly",Icon:s.TX,alertType:"throughput",makeUnqueriedContext:(e,t)=>({name:(0,r.t)("Throughput Alert for %s",[e.slug]),aggregate:"count()",dataset:i.qz.TRANSACTIONS,eventTypes:[i.GM.TRANSACTION],timeWindow:30,comparisonDelta:10080,comparisonType:i.t6.CHANGE,thresholdType:i.lT.BELOW,triggers:[l(e,500),c(300)]}),async makeContext(e,t,n){var s;const r=null===(s=await o(e,n.slug,t.id))||void 0===s?void 0:s[0];return{...this.makeUnqueriedContext(t,n),query:"transaction:"+r}}},{id:"apdex-highest-volume",title:(0,r.t)("Apdex Score"),description:"Learn when the ratio of satisfactory, tolerable, and frustrated requests drop",Icon:s.TX,alertType:"apdex",makeUnqueriedContext:(e,t)=>({name:(0,r.t)("Apdex regression for %s",[e.slug]),aggregate:"apdex(300)",dataset:i.qz.TRANSACTIONS,eventTypes:[i.GM.TRANSACTION],timeWindow:30,comparisonDelta:10080,comparisonType:i.t6.CHANGE,thresholdType:i.lT.BELOW,triggers:[l(e),c()]}),async makeContext(e,t,n){var s;const r=null===(s=await o(e,n.slug,t.id))||void 0===s?void 0:s[0];return{...this.makeUnqueriedContext(t,n),query:"transaction:"+r}}}]},"./app/views/alerts/rules/metric/types.tsx":(e,t,n)=>{n.d(t,{F4:()=>a,GM:()=>l,LO:()=>E,Lm:()=>m,Tb:()=>p,Us:()=>h,XH:()=>u,Yh:()=>c,hd:()=>S,lK:()=>d,lT:()=>r,qz:()=>o,t6:()=>i});var s=n("./app/locale.tsx");let r,a,i,o,l,c,d,u,p,h;!function(e){e[e.ABOVE=0]="ABOVE",e[e.BELOW=1]="BELOW"}(r||(r={})),function(e){e.CRITICAL="critical",e.WARNING="warning",e.RESOLVE="resolve"}(a||(a={})),function(e){e.COUNT="count",e.CHANGE="change",e.PERCENT="percent"}(i||(i={})),function(e){e.ERRORS="events",e.TRANSACTIONS="transactions",e.GENERIC_METRICS="generic_metrics",e.SESSIONS="sessions",e.METRICS="metrics"}(o||(o={})),function(e){e.DEFAULT="default",e.ERROR="error",e.TRANSACTION="transaction",e.USER="user",e.SESSION="session"}(l||(l={})),function(e){e.ERROR_DEFAULT="error_default",e.DEFAULT="default",e.ERROR="error",e.TRANSACTION="transaction"}(c||(c={})),function(e){e.CRASH_FREE_SESSIONS="percentage(sessions_crashed, sessions) AS _crash_rate_alert_aggregate",e.CRASH_FREE_USERS="percentage(users_crashed, users) AS _crash_rate_alert_aggregate"}(d||(d={})),function(e){e.SIX_HOURS="6h",e.ONE_DAY="1d",e.THREE_DAYS="3d",e.SEVEN_DAYS="10000m",e.FOURTEEN_DAYS="14d",e.THIRTY_DAYS="30d"}(u||(u={})),function(e){e[e.ONE_MINUTE=1]="ONE_MINUTE",e[e.FIVE_MINUTES=5]="FIVE_MINUTES",e[e.TEN_MINUTES=10]="TEN_MINUTES",e[e.FIFTEEN_MINUTES=15]="FIFTEEN_MINUTES",e[e.THIRTY_MINUTES=30]="THIRTY_MINUTES",e[e.ONE_HOUR=60]="ONE_HOUR",e[e.TWO_HOURS=120]="TWO_HOURS",e[e.FOUR_HOURS=240]="FOUR_HOURS",e[e.ONE_DAY=1440]="ONE_DAY"}(p||(p={})),function(e){e.EMAIL="email",e.SLACK="slack",e.PAGERDUTY="pagerduty",e.MSTEAMS="msteams",e.SENTRY_APP="sentry_app"}(h||(h={}));const E={[h.EMAIL]:(0,s.t)("Emaiâ€‹l"),[h.SLACK]:(0,s.t)("Slack"),[h.PAGERDUTY]:(0,s.t)("Pagerduty"),[h.MSTEAMS]:(0,s.t)("MS Teams"),[h.SENTRY_APP]:(0,s.t)("Notification")};let m;!function(e){e.SPECIFIC="specific",e.USER="user",e.TEAM="team",e.SENTRY_APP="sentry_app"}(m||(m={}));const S={[m.USER]:(0,s.t)("Member"),[m.TEAM]:(0,s.t)("Team")}},"./app/views/projectInstall/issueAlertOptions.tsx":(e,t,n)=>{n.d(t,{r:()=>O,Z:()=>b});var s=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=(n("../node_modules/core-js/modules/es.error.cause.js"),n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/es.array.includes.js"),n("../node_modules/react/index.js")),a=n("../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),i=n("../node_modules/@sentry/hub/esm/exports.js"),o=n("../node_modules/lodash/isEqual.js"),l=n.n(o),c=n("./app/components/asyncComponent.tsx"),d=n("./app/components/forms/controls/radioGroup.tsx"),u=n("./app/styles/space.tsx"),p=n("./app/components/checkboxFancy/checkboxFancy.tsx"),h=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function E(e){return(0,h.tZ)("div",{className:e.className,children:e.choices.map((t=>(0,h.BX)(m,{children:[(0,h.tZ)(p.Z,{size:e.size,isDisabled:t.disabled,isChecked:t.checked,isIndeterminate:t.intermediate,onClick:()=>{var n;null===(n=e.onClick)||void 0===n||n.call(e,t.value)}}),(0,h.tZ)(S,{children:t.title})]},t.value.toString())))})}E.displayName="MultipleCheckboxField";const m=(0,s.Z)("div",{target:"eoudbc51"})("margin-bottom:",(0,u.Z)(2),";display:flex;flex-direction:row;align-items:center;"),S=(0,s.Z)("span",{target:"eoudbc50"})("margin-left:",(0,u.Z)(1),";");var g,T,v=n("./app/components/forms/selectControl.tsx"),A=n("./app/components/input.tsx"),R=n("./app/components/pageHeading.tsx"),_=n("./app/locale.tsx"),f=n("./app/utils/withOrganization.tsx"),C=n("./app/views/alerts/rules/metric/presets.tsx");!function(e){e[e.ERRORS=0]="ERRORS",e[e.USERS=1]="USERS"}(g||(g={})),function(e){e[e.ALERT_ON_EVERY_ISSUE=0]="ALERT_ON_EVERY_ISSUE",e[e.CUSTOMIZED_ALERTS=1]="CUSTOMIZED_ALERTS",e[e.CREATE_ALERT_LATER=2]="CREATE_ALERT_LATER"}(T||(T={}));const I="sentry.rules.conditions.event_frequency.EventUniqueUserFrequencyCondition",y="sentry.rules.conditions.event_frequency.EventFrequencyCondition",O="sentry.rules.conditions.event_frequency.EventFrequencyPercentCondition",N={[g.ERRORS]:y,[g.USERS]:I};function U(e,t,n){let s;switch(t){case g.ERRORS:s=y;break;case g.USERS:s=I;break;default:throw new RangeError("Supplied metric value is not handled")}return{interval:e,id:s,value:n}}class x extends c.Z{getDefaultState(){return{...super.getDefaultState(),conditions:[],intervalChoices:[],alertSetting:T.CREATE_ALERT_LATER.toString(),metric:g.ERRORS,interval:"",threshold:"",metricAlertPresets:new Set}}getAvailableMetricOptions(){return[{value:g.ERRORS,label:(0,_.t)("occurrences of")},{value:g.USERS,label:(0,_.t)("users affected by")}].filter((e=>{var t,n;let{value:s}=e;return null===(t=this.state.conditions)||void 0===t||null===(n=t.some)||void 0===n?void 0:n.call(t,(e=>(null==e?void 0:e.id)===N[s]))}))}getIssueAlertsChoices(e){const t=[[T.CREATE_ALERT_LATER.toString(),(0,_.t)("I'll create my own alerts later")],[T.ALERT_ON_EVERY_ISSUE.toString(),(0,_.t)("Alert me on every new issue")]];var n;return e&&t.push([T.CUSTOMIZED_ALERTS.toString(),(0,h.BX)(L,{onClick:e=>{e.preventDefault();const t=T.CUSTOMIZED_ALERTS.toString();this.setStateAndUpdateParents({alertSetting:t})},children:[(0,_.t)("When there are more than"),(0,h.tZ)(M,{type:"number",min:"0",name:"",placeholder:"10",value:this.state.threshold,onChange:e=>this.setStateAndUpdateParents({threshold:e.target.value}),"data-test-id":"range-input"}),(0,h.tZ)(q,{value:this.state.metric,options:this.getAvailableMetricOptions(),onChange:e=>this.setStateAndUpdateParents({metric:e.value})}),(0,_.t)("a unique error in"),(0,h.tZ)(q,{value:this.state.interval,options:null===(n=this.state.intervalChoices)||void 0===n?void 0:n.map((e=>{let[t,n]=e;return{value:t,label:n}})),onChange:e=>this.setStateAndUpdateParents({interval:e.value})})]},T.CUSTOMIZED_ALERTS)]),t.map((e=>{let[t,n]=e;return[t,(0,h.tZ)(D,{children:n},t)]}))}getUpdatedData(){let e,t;switch(parseInt(this.state.alertSetting,10)){case T.ALERT_ON_EVERY_ISSUE:e=!0,t=!1;break;case T.CREATE_ALERT_LATER:e=!1,t=!1;break;case T.CUSTOMIZED_ALERTS:e=!1,t=!0;break;default:throw new RangeError("Supplied alert creation action is not handled")}return{defaultRules:e,shouldCreateCustomRule:t,name:"Send a notification for new issues",conditions:this.state.interval.length>0&&this.state.threshold.length>0?[U(this.state.interval,this.state.metric,this.state.threshold)]:void 0,actions:[{id:"sentry.rules.actions.notify_event.NotifyEventAction"}],actionMatch:"all",frequency:5,metricAlertPresets:Array.from(this.state.metricAlertPresets)}}setStateAndUpdateParents(e){this.setState(e,(()=>{this.props.onChange(this.getUpdatedData())}))}getEndpoints(){return[["conditions",`/projects/${this.props.organization.slug}/rule-conditions/`]]}onLoadAllEndpointsSuccess(){var e,t;const n=null===(e=this.state.conditions)||void 0===e||null===(t=e.filter)||void 0===t?void 0:t.call(e,(e=>Object.values(N).includes(null==e?void 0:e.id)));if(!n||0===n.length)return void this.setStateAndUpdateParents({conditions:void 0});const{intervalChoices:s,interval:r}=function(e){var t;const n=e.map((e=>{var t,n;return null===(t=e.formFields)||void 0===t||null===(n=t.interval)||void 0===n?void 0:n.choices})).reduce(((e,t)=>e&&t&&l()(e,t)?e:null));return{intervalChoices:n,interval:null==n||null===(t=n[0])||void 0===t?void 0:t[0]}}(n);if(!s||!r)return i.$e((e=>{e.setExtra("props",this.props),e.setExtra("state",this.state),i.Tb(new Error("Interval choices or sent from API endpoint is inconsistent or empty"))})),void this.setStateAndUpdateParents({conditions:void 0});this.setStateAndUpdateParents({conditions:n,intervalChoices:s,interval:r})}renderBody(){var e;const t=this.getIssueAlertsChoices((null===(e=this.state.conditions)||void 0===e?void 0:e.length)>0),n=!!this.props.organization.experiments.MetricAlertOnProjectCreationExperiment;return(0,h.BX)(r.Fragment,{children:[(0,h.tZ)(k,{withMargins:!0,children:(0,_.t)("Set your default alert settings")}),(0,h.BX)(Z,{children:[n&&(0,h.tZ)(F,{children:(0,_.t)("Issue Alerts")}),(0,h.tZ)(P,{choices:t,label:(0,_.t)("Options for creating an alert"),onChange:e=>this.setStateAndUpdateParents({alertSetting:e}),value:this.state.alertSetting}),n&&(0,h.BX)(r.Fragment,{children:[(0,h.tZ)(F,{children:(0,_.t)("Performance Alerts")}),(0,h.tZ)(E,{size:"24px",choices:C.g.map((e=>({title:e.description,value:e.id,checked:this.state.metricAlertPresets.has(e.id)}))),css:w,onClick:e=>{const t=new Set(this.state.metricAlertPresets);t.has(e)?t.delete(e):t.add(e),this.setStateAndUpdateParents({metricAlertPresets:t})}})]})]})]})}}const b=(0,f.Z)(x),w=(0,a.iv)("margin-top:",(0,u.Z)(1),";",""),Z=(0,s.Z)("div",{target:"e12p23qf7"})("padding-top:",(0,u.Z)(2),";padding-bottom:",(0,u.Z)(4),";"),L=(0,s.Z)("div",{target:"e12p23qf6"})("display:grid;grid-template-columns:repeat(5, max-content);gap:",(0,u.Z)(1),";align-items:center;"),M=(0,s.Z)(A.Z,{target:"e12p23qf5"})({name:"m0jwvv",styles:"width:80px"}),q=(0,s.Z)(v.Z,{target:"e12p23qf4"})({name:"efbx4f",styles:"width:160px"}),P=(0,s.Z)(d.Z,{target:"e12p23qf3"})("margin-bottom:",(0,u.Z)(2),";"),k=(0,s.Z)(R.Z,{target:"e12p23qf2"})("margin-top:65px;margin-bottom:0;padding-bottom:",(0,u.Z)(3),";border-bottom:1px solid rgba(0, 0, 0, 0.1);"),D=(0,s.Z)("div",{target:"e12p23qf1"})({name:"p9mutn",styles:"min-height:35px;display:flex;flex-direction:column;justify-content:center"}),F=(0,s.Z)("b",{target:"e12p23qf0"})({name:"4zleql",styles:"display:block"})}}]);
//# sourceMappingURL=../sourcemaps/app_views_projectInstall_issueAlertOptions_tsx.3d049501eef288e82641cef4db52ab24.js.map