"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_utils_performance_urls_ts"],{"./app/components/events/interfaces/spans/utils.tsx":(t,e,s)=>{s.d(e,{BU:()=>z,IG:()=>b,Io:()=>H,PA:()=>R,PC:()=>$,PQ:()=>B,Rr:()=>x,TC:()=>M,Zv:()=>K,ct:()=>Q,h_:()=>Z,hw:()=>A,is:()=>Y,k9:()=>k,kP:()=>V,ll:()=>F,n0:()=>D,o0:()=>U,on:()=>X,rF:()=>O,ro:()=>j,sT:()=>q,vu:()=>N,yk:()=>P,yn:()=>C});var n=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/core-js/modules/es.array.includes.js"),s("../node_modules/react-router/es/index.js")),i=s("../node_modules/lodash/isNumber.js"),r=s.n(i),p=s("../node_modules/lodash/isString.js"),o=s.n(p),m=s("../node_modules/lodash/maxBy.js"),u=s.n(m),d=s("../node_modules/lodash/set.js"),c=s.n(d),l=s("../node_modules/moment/moment.js"),h=s.n(l),S=s("./app/components/performance/waterfall/treeConnector.tsx"),T=s("./app/types/event.tsx"),f=s("./app/types/utils.tsx"),v=s("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),_=s("./app/utils/fields/index.ts"),w=s("./app/utils/performance/vitals/constants.tsx"),I=s("./app/utils/performanceForSentry.tsx"),E=s("./app/components/events/interfaces/spans/constants.tsx");const V=t=>{const e=(0,I.Zz)();if(!e||0===t)return;const s=[10,100,200,300,400,500,600,700,800,900,1001].find((e=>t<=e))||-1;e.setTag("ui.spanCount",t),e.setTag("ui.spanCount.grouped",`<=${s}`)},g=t=>{const{startTimestamp:e,endTimestamp:s}=t;return e>s?{startTimestamp:s,endTimestamp:e}:t};let y;!function(t){t[t.Stable=0]="Stable",t[t.Reversed=1]="Reversed",t[t.Equal=2]="Equal"}(y||(y={}));const b=t=>{const{viewStart:e,viewEnd:s}=t,{startTimestamp:n,endTimestamp:a}=g({startTimestamp:t.traceStartTimestamp,endTimestamp:t.traceEndTimestamp}),i=a-n,r=n+e*i,p=a-(1-s)*i-r;return t=>{if(i<=0)return{type:"TRACE_TIMESTAMPS_EQUAL",isSpanVisibleInView:!0};if(p<=0)return{type:"INVALID_VIEW_WINDOW",isSpanVisibleInView:!0};const{startTimestamp:e,endTimestamp:s}=g(t),n=(t=>{const e=t.startTimestamp,s=t.endTimestamp;return e<s?y.Stable:e===s?y.Equal:y.Reversed})(t),a=(e-r)/p,o=(s-r)/p,m=o>0&&a<1;switch(n){case y.Equal:return{type:"TIMESTAMPS_EQUAL",start:a,width:1,isSpanVisibleInView:o>=0&&a<=1};case y.Reversed:return{type:"TIMESTAMPS_REVERSED",start:a,end:o,isSpanVisibleInView:m};case y.Stable:return{type:"TIMESTAMPS_STABLE",start:a,end:o,isSpanVisibleInView:m};default:return n}}};function D(t){return{trace_id:t.traceID,span_id:t.rootSpanID,parent_span_id:t.parentSpanID,start_timestamp:t.traceStartTimestamp,timestamp:t.traceEndTimestamp,op:t.op,description:t.description,data:{},status:t.rootSpanStatus,hash:t.hash,exclusive_time:t.exclusiveTime}}function M(t){return{start:h().unix(t.start).subtract(12,"hours").utc().format("YYYY-MM-DDTHH:mm:ss.SSS"),end:h().unix(t.end).add(12,"hours").utc().format("YYYY-MM-DDTHH:mm:ss.SSS")}}function A(t){return"type"in t&&"gap"===t.type}function j(t){if("type"in t){if("orphan"===t.type)return!0;if("gap"===t.type)return t.isOrphan}return!1}function x(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return A(t)?e:t.span_id}function P(t){if(!A(t))return t.op}function R(t){var e;return null==t||null===(e=t.contexts)||void 0===e?void 0:e.trace}function k(t){var e;const s=t.entries.find((t=>t.type===T.UZ.SPANS)),n=null!==(e=null==s?void 0:s.data)&&void 0!==e?e:[],a=R(t),i=a&&a.trace_id||"",p=a&&a.span_id||"",m=a&&a.op||"transaction",u=a&&a.description,d=a&&a.parent_span_id,l=a&&a.status,h=a&&a.hash,S=a&&a.exclusive_time;if(!s||n.length<=0)return{op:m,childSpans:{},traceStartTimestamp:t.startTimestamp,traceEndTimestamp:t.endTimestamp,traceID:i,rootSpanID:p,rootSpanStatus:l,parentSpanID:d,spans:[],description:u,hash:h,exclusiveTime:S};const v=new Set(n.map((t=>t.span_id)));v.add(p);const _={op:m,childSpans:{},traceStartTimestamp:t.startTimestamp,traceEndTimestamp:t.endTimestamp,traceID:i,rootSpanID:p,rootSpanStatus:l,parentSpanID:d,spans:n,description:u,hash:h,exclusiveTime:S},w=n.reduce(((t,e)=>{var s;let n=e;const a=function(t){return A(t)?"gap-span":t.parent_span_id}(n),i=a&&v.has(a);var m;m=a,o()(m)&&m.length>0&&i||(n.parent_span_id=p,n={type:"orphan",...n}),(0,f.hu)(n.parent_span_id);const u=null!==(s=t.childSpans[n.parent_span_id])&&void 0!==s?s:[];u.push(n),c()(t.childSpans,n.parent_span_id,u),(!t.traceStartTimestamp||n.start_timestamp<t.traceStartTimestamp)&&(t.traceStartTimestamp=n.start_timestamp);const d=r()(n.timestamp);return t.traceEndTimestamp?d&&n.timestamp>t.traceEndTimestamp?(t.traceEndTimestamp=n.timestamp,t):(n.start_timestamp>t.traceEndTimestamp&&(t.traceEndTimestamp=n.start_timestamp),t):d?(t.traceEndTimestamp=n.timestamp,t):(t.traceEndTimestamp=n.start_timestamp,t)}),_);return Object.values(w.childSpans).forEach((t=>{t.sort(L)})),w}function L(t,e){return j(t)&&!j(e)?1:!j(t)&&j(e)||t.start_timestamp<e.start_timestamp?-1:t.start_timestamp===e.start_timestamp?0:1}function C(t){return"number"!=typeof t&&"orphan"===(null==t?void 0:t.type)}function Z(t){return C(t)?t.depth:t}function $(t){var e;const s=null===(e=t.sdk)||void 0===e?void 0:e.name;return!!s&&["sentry.javascript.browser","sentry.javascript.react","sentry.javascript.gatsby","sentry.javascript.ember","sentry.javascript.vue","sentry.javascript.angular","sentry.javascript.nextjs","sentry.javascript.electron","sentry.javascript.remix","sentry.javascript.svelte"].includes(s.toLowerCase())}const U=["mark","paint"];function W(t){const e=Object.keys(t);return Object.values(w.r9).filter((t=>e.includes(t.slug))).some((e=>{const{value:s}=t[e.slug];return"number"==typeof s&&"number"==typeof e.poorThreshold&&s>=e.poorThreshold}))}function Y(t,e){if(!t.measurements||!t.startTimestamp)return new Map;const{startTimestamp:s}=t,n=new Set([_.Zl.FCP,_.Zl.FP,_.Zl.FID,_.Zl.LCP,_.Zl.TTFB]),a=Object.keys(t.measurements).filter((t=>n.has(`measurements.${t}`))).map((e=>{const n=t.measurements[e];return{name:e,timestamp:s+n.value/1e3,value:n?n.value:void 0}})),i=new Map;return a.forEach((t=>{const s=t.name,n=t.value,a=e({startTimestamp:t.timestamp,endTimestamp:t.timestamp});if("TIMESTAMPS_EQUAL"!==a.type)return;const r=Math.round(100*a.start);for(const[e]of i)if(Math.abs(e-r)<=E.tJ){const a=i.get(e),{poorThreshold:r}=w.r9[`measurements.${s}`];return a.marks={...a.marks,[s]:{value:n,timestamp:t.timestamp,failedThreshold:!!n&&n>=r}},a.failedThreshold||(a.failedThreshold=W(a.marks)),void i.set(e,a)}const{poorThreshold:p}=w.r9[`measurements.${s}`],o={[s]:{value:n,timestamp:t.timestamp,failedThreshold:!!n&&n>=p}};i.set(r,{marks:o,failedThreshold:W(o)})})),i}function N(t,e){const s=e({startTimestamp:t,endTimestamp:t});switch(s.type){case"TRACE_TIMESTAMPS_EQUAL":case"INVALID_VIEW_WINDOW":return{warning:void 0,left:void 0,width:void 0,isSpanVisibleInView:s.isSpanVisibleInView};case"TIMESTAMPS_EQUAL":return{warning:void 0,left:s.start,width:1e-5,isSpanVisibleInView:s.isSpanVisibleInView};case"TIMESTAMPS_REVERSED":case"TIMESTAMPS_STABLE":return{warning:void 0,left:s.start,width:s.end-s.start,isSpanVisibleInView:s.isSpanVisibleInView};default:return s}}function O(t,e,s,n){return i=>{i.preventDefault();const r=Q(t);e(r),a.browserHistory.push({...s,hash:r}),(0,v.Z)("performance_views.event_details.anchor_span",{organization:n,span_id:t})}}function Q(t){return`#span-${t}`}function B(t,e){return void 0!==e?`${t.op}.${t.description}.${e}`:`${t.op}.${t.description}`}function F(t){return t.reduce(((t,e)=>{const{start_timestamp:s,timestamp:n}=e.span;let a=t.startTimestamp,i=t.endTimestamp;return s<a&&(a=s),i<n&&(i=n),{startTimestamp:a,endTimestamp:i}}),{startTimestamp:t[0].span.start_timestamp,endTimestamp:t[0].span.timestamp})}function q(t,e){const{startTimestamp:s,endTimestamp:n}=F(t),a=e({startTimestamp:s,endTimestamp:n});switch(a.type){case"TRACE_TIMESTAMPS_EQUAL":case"INVALID_VIEW_WINDOW":return{warning:void 0,left:void 0,width:void 0,isSpanVisibleInView:a.isSpanVisibleInView};case"TIMESTAMPS_EQUAL":return{warning:void 0,left:a.start,width:1e-5,isSpanVisibleInView:a.isSpanVisibleInView};case"TIMESTAMPS_REVERSED":case"TIMESTAMPS_STABLE":return{warning:void 0,left:a.start,width:a.end-a.start,isSpanVisibleInView:a.isSpanVisibleInView};default:return a}}class H{constructor(t){(0,n.Z)(this,"spanDepthsInView",void 0),(0,n.Z)(this,"treeDepthSum",void 0),(0,n.Z)(this,"length",void 0),(0,n.Z)(this,"isRootSpanInView",void 0),this.spanDepthsInView=new Map,this.treeDepthSum=0,this.length=0,this.isRootSpanInView=t}addSpan(t,e){return!this.spanDepthsInView.has(t)&&(this.spanDepthsInView.set(t,e),this.length+=1,this.treeDepthSum+=e,0===e&&(this.isRootSpanInView=!0),!0)}removeSpan(t){if(!this.spanDepthsInView.has(t))return!1;const e=this.spanDepthsInView.get(t);return this.spanDepthsInView.delete(t),this.length-=1,this.treeDepthSum-=e,0===e&&(this.isRootSpanInView=!1),!0}has(t){return this.spanDepthsInView.has(t)}getScrollVal(){return this.isRootSpanInView?0:Math.round(this.treeDepthSum/this.length)*(S.Ll/2)-S.Y9/2}}function z(t){var e;const s=null===(e=u()(t||[],(t=>J[t.level])))||void 0===e?void 0:e.level;if(s)return G[s]}const G={fatal:"error",error:"error",default:"error",warning:"warning",sample:"info",info:"info",unknown:"muted"},J={fatal:5,error:4,default:4,warning:3,sample:2,info:1,unknown:0};function K(t,e){const s=String(t).split("."),n=String(e).split(".");if(2!==s.length||2!==n.length)return{start:String(t),end:String(e)};const a=s.reduce(((t,e,s)=>e.length>n[s].length?(t.start.push(e),t.end.push(0===s?n[s].padStart(e.length,"0"):n[s].padEnd(e.length,"0")),t):(t.start.push(0===s?e.padStart(n[s].length,"0"):e.padEnd(n[s].length,"0")),t.end.push(n[s]),t)),{start:[],end:[]});return{start:a.start.join("."),end:a.end.join(".")}}function X(t,e){return!!e&&!t.some((t=>e.has(t.span.span_id)))}},"./app/utils/performance/urls.ts":(t,e,s)=>{s.d(e,{D:()=>i});var n=s("./app/components/events/interfaces/spans/utils.tsx"),a=s("./app/utils.tsx");function i(t,e,s,i,r){const p={...i||{},transaction:s};(0,a.ri)(p.transaction)||delete p.transaction;const o={pathname:`/organizations/${t}/performance/${e}/`,query:p,hash:(0,a.ri)(r)?(0,n.ct)(r):void 0};return(0,a.ri)(o.hash)||delete o.hash,o}}}]);
//# sourceMappingURL=../sourcemaps/app_utils_performance_urls_ts.1d412f1acbf21484698b5f6ced7857a5.js.map