"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_organizationStats_teamInsights_issues_tsx"],{"./app/views/organizationStats/teamInsights/issues.tsx":(e,t,n)=>{n.r(t),n.d(t,{default:()=>ve});var s=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=n("../node_modules/react/index.js"),o=n("./app/components/layouts/thirds.tsx"),i=n("./app/components/loadingIndicator.tsx"),a=n("./app/components/noProjectMessage.tsx"),d=n("./app/components/sentryDocumentTitle.tsx"),l=n("./app/locale.tsx"),u=n("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),p=n("./app/utils/localStorage.tsx"),c=n("./app/utils/useOrganization.tsx"),g=n("./app/utils/useTeams.tsx"),m=n("./app/views/organizationStats/header.tsx"),h=n("./app/views/organizationStats/teamInsights/controls.tsx"),v=n("./app/views/organizationStats/teamInsights/descriptionCard.tsx"),Z=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),x=(n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/@emotion/react/dist/emotion-react.browser.esm.js")),f=n("../node_modules/moment/moment.js"),y=n.n(f),b=n("./app/components/asyncComponent.tsx"),w=n("./app/components/charts/barChart.tsx"),S=n("./app/components/count.tsx"),j=n("./app/components/idBadge/projectBadge.tsx"),z=n("./app/components/links/link.tsx"),B=n("./app/components/panels/panelTable.tsx"),I=n("./app/components/placeholder.tsx"),k=n("./app/components/timeSince.tsx"),T=n("./app/icons/index.tsx"),C=n("./app/styles/space.tsx"),D=n("./app/utils/events.tsx"),q=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function A(e){if("> 1 year"===e)return y()().subtract(1,"y").subtract(1,"d").valueOf();const[t,n,s]=e.split(" ");return y()().subtract(n,s).valueOf()}const E={"< 1 hour":(0,l.t)("1 hour"),"< 4 hour":(0,l.t)("4 hours"),"< 12 hour":(0,l.t)("12 hours"),"< 1 day":(0,l.t)("1 day"),"< 1 week":(0,l.t)("1 week"),"< 4 week":(0,l.t)("1 month"),"< 24 week":(0,l.t)("6 months"),"< 1 year":(0,l.t)("1 year"),"> 1 year":(0,l.t)("> 1 year")};class N extends b.Z{constructor(){super(...arguments),(0,Z.Z)(this,"shouldRenderBadRequests",!0)}getDefaultState(){return{...super.getDefaultState(),oldestIssues:null,unresolvedIssueAge:null}}getEndpoints(){const{organization:e,teamSlug:t}=this.props;return[["oldestIssues",`/teams/${e.slug}/${t}/issues/old/`,{query:{limit:7}}],["unresolvedIssueAge",`/teams/${e.slug}/${t}/unresolved-issue-age/`]]}componentDidUpdate(e){const{teamSlug:t}=this.props;e.teamSlug!==t&&this.remountComponent()}renderLoading(){return this.renderBody()}renderBody(){const{organization:e}=this.props,{unresolvedIssueAge:t,oldestIssues:n,loading:s}=this.state,o=Object.entries(null!=t?t:{}).map((e=>{let[t,n]=e;return{name:t,value:n}})).sort(((e,t)=>A(t.name)-A(e.name)));return(0,q.BX)("div",{children:[(0,q.BX)(M,{children:[s&&(0,q.tZ)(I.Z,{height:"200px"}),!s&&(0,q.tZ)(w.v,{style:{height:190},legend:{right:3,top:0},yAxis:{minInterval:1},xAxis:{splitNumber:o.length,type:"category",min:0,axisLabel:{showMaxLabel:!0,showMinLabel:!0,formatter:e=>{var t;return null!==(t=E[e])&&void 0!==t?t:e}}},series:[{seriesName:(0,l.t)("Unresolved Issues"),silent:!0,data:o,barCategoryGap:"5%"}]})]}),(0,q.tZ)(O,{isEmpty:!n||0===n.length,emptyMessage:(0,l.t)("No unresolved issues for this teamâ€™s projects"),headers:[(0,l.t)("Oldest Issues"),(0,q.tZ)(R,{children:(0,l.t)("Events")},"events"),(0,q.tZ)(R,{children:(0,l.t)("Users")},"users"),(0,q.BX)(R,{children:[(0,l.t)("Age")," ",(0,q.tZ)(T.CC,{direction:"down",size:"12px",color:"gray300"})]},"age")],isLoading:s,children:null==n?void 0:n.map((t=>{const{title:n}=(0,D.YQ)(t,null==e?void 0:e.features,!1);return(0,q.BX)(r.Fragment,{children:[(0,q.BX)($,{children:[(0,q.tZ)(L,{disableLink:!0,hideName:!0,avatarSize:18,project:t.project}),(0,q.tZ)(_,{children:(0,q.tZ)(z.Z,{to:{pathname:`/organizations/${e.slug}/issues/${t.id}/`},children:n})})]}),(0,q.tZ)(R,{children:(0,q.tZ)(S.Z,{value:t.count})}),(0,q.tZ)(R,{children:(0,q.tZ)(S.Z,{value:t.userCount})}),(0,q.tZ)(R,{children:(0,q.tZ)(k.Z,{date:t.firstSeen})})]},t.id)}))})]})}}const X=N,M=(0,s.Z)("div",{target:"e131frq15"})("padding:",(0,C.Z)(2)," ",(0,C.Z)(2)," 0 ",(0,C.Z)(2),";border-bottom:1px solid ",(e=>e.theme.border),";"),O=(0,s.Z)(B.Z,{target:"e131frq14"})("grid-template-columns:1fr 0.15fr 0.15fr 0.25fr;white-space:nowrap;margin-bottom:0;border:0;font-size:",(e=>e.theme.fontSizeMedium),";box-shadow:unset;>*{padding:",(0,C.Z)(1)," ",(0,C.Z)(2),";}",(e=>e.isEmpty&&(0,x.iv)("&>div:last-child{padding:48px ",(0,C.Z)(2),";}","")),";"),R=(0,s.Z)("span",{target:"e131frq13"})({name:"19mh0x6",styles:"display:flex;align-items:center;justify-content:flex-end"}),$=(0,s.Z)("div",{target:"e131frq12"})((e=>e.theme.overflowEllipsis),";display:flex;align-items:center;"),_=(0,s.Z)("div",{target:"e131frq11"})((e=>e.theme.overflowEllipsis),";"),L=(0,s.Z)(j.Z,{target:"e131frq10"})("display:inline-flex;align-items:center;margin-right:",(0,C.Z)(1),";*>img{box-shadow:none;}");var U=n("../node_modules/lodash/isEqual.js"),G=n.n(U),F=n("./app/components/collapsePanel.tsx"),P=n("./app/components/organizations/pageFilters/parse.tsx"),W=n("./app/stores/projectsStore.tsx"),K=n("./app/views/organizationStats/teamInsights/styles.tsx"),H=n("./app/views/organizationStats/teamInsights/utils.tsx");const Q=["deleted","ignored","resolved","unignored","regressed","new","total"];class Y extends b.Z{constructor(){super(...arguments),(0,Z.Z)(this,"shouldRenderBadRequests",!0)}getDefaultState(){return{...super.getDefaultState(),issuesBreakdown:null}}getEndpoints(){const{organization:e,start:t,end:n,period:s,utc:r,teamSlug:o,statuses:i,environment:a}=this.props,d={start:t,end:n,period:s,utc:r};return[["issuesBreakdown",`/teams/${e.slug}/${o}/issue-breakdown/`,{query:{...(0,P.fK)(d),statuses:i,environment:a}}]]}componentDidUpdate(e){const{start:t,end:n,period:s,utc:r,teamSlug:o,projects:i,environment:a}=this.props;e.start===t&&e.end===n&&e.period===s&&e.utc===r&&e.teamSlug===o&&e.environment===a&&G()(e.projects,i)||this.remountComponent()}renderLoading(){return this.renderBody()}renderBody(){var e,t,n;const{loading:s}=this.state,o=null!==(e=this.state.issuesBreakdown)&&void 0!==e?e:{},{projects:i,statuses:a}=this.props,d={},u={};for(const[e,t]of Object.entries(o))for(const[n,s]of Object.entries(t)){u[e]||(u[e]={deleted:0,ignored:0,resolved:0,unignored:0,regressed:0,new:0,total:0});for(const t of Q)u[e][t]+=s[t];d[e]||(d[e]={}),void 0===d[e][n]?d[e][n]=s.total:d[e][n]+=s.total}const p=Object.entries(u).map((e=>{let[t,{total:n}]=e;return{projectId:t,total:n}})).sort(((e,t)=>t.total-e.total)),c=Object.keys(d).map(((e,t)=>{var n,s;return{seriesName:null!==(n=null===(s=W.Z.getById(e))||void 0===s?void 0:s.slug)&&void 0!==n?n:e,data:(0,H.Gs)((0,H.E7)(d[e])),animationDuration:500,animationDelay:500*t,silent:!0,barCategoryGap:"5%"}}));return(0,q.BX)(r.Fragment,{children:[(0,q.BX)(ee,{children:[s&&(0,q.tZ)(I.Z,{height:"200px"}),!s&&(0,q.tZ)(w.v,{style:{height:200},stacked:!0,isGroupedByDate:!0,useShortDate:!0,legend:{right:0,top:0},xAxis:(0,H.tP)(null!==(t=null===(n=c[0])||void 0===n?void 0:n.data.length)&&void 0!==t?t:0),yAxis:{minInterval:1},series:c})]}),(0,q.tZ)(F.Z,{items:p.length,children:e=>{let{isExpanded:t,showMoreButton:n}=e;return(0,q.BX)(r.Fragment,{children:[(0,q.tZ)(te,{numActions:a.length,headers:[(0,l.t)("Project"),...a.map((e=>(0,q.tZ)(ne,{children:(0,l.t)(e)},e))),(0,q.BX)(ne,{children:[(0,l.t)("total")," ",(0,q.tZ)(T.CC,{direction:"down",size:"12px",color:"gray300"})]},"total")],isLoading:s,children:p.map(((e,n)=>{let{projectId:s}=e;const o=i.find((e=>e.id===s));return n>=F.$&&!t?null:(0,q.BX)(r.Fragment,{children:[(0,q.tZ)(K.R,{children:o&&(0,q.tZ)(K.W,{avatarSize:18,project:o})}),a.map((e=>(0,q.tZ)(ne,{children:u[s][e]},e))),(0,q.tZ)(ne,{children:u[s].total})]},s)}))}),!s&&n]})}})]})}}const J=Y,V=(0,s.Z)("div",{target:"e1kdpoq3"})("padding:",(0,C.Z)(2)," ",(0,C.Z)(2)," 0 ",(0,C.Z)(2),";"),ee=(0,s.Z)(V,{target:"e1kdpoq2"})("border-bottom:1px solid ",(e=>e.theme.border),";"),te=(0,s.Z)(B.Z,{target:"e1kdpoq1"})("grid-template-columns:1fr ",(e=>" 0.2fr".repeat(e.numActions))," 0.2fr;font-size:",(e=>e.theme.fontSizeMedium),";white-space:nowrap;margin-bottom:0;border:0;box-shadow:unset;&>div{padding:",(0,C.Z)(1)," ",(0,C.Z)(2),";}"),ne=(0,s.Z)("div",{target:"e1kdpoq0"})({name:"mnwtso",styles:"text-align:right;font-variant-numeric:tabular-nums"});var se=n("./app/utils/formatters.tsx");class re extends b.Z{constructor(){super(...arguments),(0,Z.Z)(this,"shouldRenderBadRequests",!0)}getDefaultState(){return{...super.getDefaultState(),resolutionTime:null}}getEndpoints(){const{organization:e,start:t,end:n,period:s,utc:r,teamSlug:o,environment:i}=this.props,a={start:t,end:n,period:s,utc:r};return[["resolutionTime",`/teams/${e.slug}/${o}/time-to-resolution/`,{query:{...(0,P.fK)(a),environment:i}}]]}componentDidUpdate(e){const{start:t,end:n,period:s,utc:r,teamSlug:o,environment:i}=this.props;e.start===t&&e.end===n&&e.period===s&&e.utc===r&&e.teamSlug===o&&e.environment===i||this.remountComponent()}renderLoading(){return(0,q.tZ)(ie,{children:(0,q.tZ)(i.Z,{})})}renderBody(){const{resolutionTime:e}=this.state,t=Object.entries(null!=e?e:{}).map((e=>{let[t,{avg:n}]=e;return{value:n,name:new Date(t).getTime()}})),n=(0,H.Gs)(t);return(0,q.tZ)(ie,{children:(0,q.tZ)(w.v,{style:{height:190},isGroupedByDate:!0,useShortDate:!0,period:"7d",tooltip:{valueFormatter:e=>(0,se.g9)(e,1)},yAxis:{minInterval:86400,axisLabel:{formatter:e=>0===e?"":(0,se.g9)(e,0,!0,!0)}},legend:{right:0,top:0},xAxis:(0,H.tP)(n.length),series:[{seriesName:(0,l.t)("Time to Resolution"),data:n,silent:!0,barCategoryGap:"5%"}]})})}}const oe=re,ie=(0,s.Z)("div",{target:"e1s8s0fe0"})("padding:",(0,C.Z)(2)," ",(0,C.Z)(2)," 0 ",(0,C.Z)(2),";");class ae extends b.Z{constructor(){super(...arguments),(0,Z.Z)(this,"shouldRenderBadRequests",!0),(0,Z.Z)(this,"handleExpandTable",(()=>{this.setState({expandTable:!0})}))}getDefaultState(){return{...super.getDefaultState(),periodIssues:null,expandTable:!1}}getEndpoints(){const{organization:e,start:t,end:n,period:s,utc:r,teamSlug:o,environment:i}=this.props,a={start:t,end:n,period:s,utc:r};return[["periodIssues",`/teams/${e.slug}/${o}/all-unresolved-issues/`,{query:{...(0,P.fK)(a),environment:i}}]]}componentDidUpdate(e){const{teamSlug:t,start:n,end:s,period:r,utc:o,environment:i}=this.props;e.start===n&&e.end===s&&e.period===r&&e.utc===o&&e.environment===i&&e.teamSlug===t||this.remountComponent()}getTotalUnresolved(e){var t;const{periodIssues:n}=this.state,s=Object.values(null!==(t=null==n?void 0:n[e])&&void 0!==t?t:{}),r=s.reduce(((e,t)=>e+t.unresolved),0);return Math.round(r/s.length)}renderLoading(){return this.renderBody()}renderBody(){var e;const{projects:t,period:n}=this.props,{loading:s}=this.state,o=null!==(e=this.state.periodIssues)&&void 0!==e?e:{},i={};for(const e of Object.keys(o)){var a,d,u;const t=this.getTotalUnresolved(Number(e)),n=Object.values(null!==(a=null==o?void 0:o[e])&&void 0!==a?a:{}),s=null!==(d=null===(u=n[n.length-1])||void 0===u?void 0:u.unresolved)&&void 0!==d?d:0,r=Math.abs((s-t)/t);i[e]={projectId:e,periodAvg:t,today:s,percentChange:Number.isNaN(r)?0:r}}const p=t.map((e=>{var t,n;return{project:e,trend:null!==(t=null===(n=i[e.id])||void 0===n?void 0:n.percentChange)&&void 0!==t?t:0}})).sort(((e,t)=>Math.abs(t.trend)-Math.abs(e.trend))),c=(0,H.NW)(p),g=Object.values(o).flatMap((e=>Object.entries(e).map((e=>{let[t,{unresolved:n}]=e;return[t,n]})))).reduce(((e,t)=>{let[n,s]=t;return void 0===e[n]&&(e[n]=0),e[n]+=s,e}),{}),m=(0,H.Gs)((0,H.E7)(g));return(0,q.BX)("div",{children:[(0,q.BX)(le,{children:[s&&(0,q.tZ)(I.Z,{height:"200px"}),!s&&(0,q.tZ)(w.v,{style:{height:190},isGroupedByDate:!0,useShortDate:!0,legend:{right:3,top:0},yAxis:{minInterval:1},xAxis:(0,H.tP)(m.length),series:[{seriesName:(0,l.t)("Unresolved Issues"),silent:!0,data:m,barCategoryGap:"6%"}]})]}),(0,q.tZ)(F.Z,{items:c.length,children:e=>{let{isExpanded:o,showMoreButton:a}=e;return(0,q.BX)(r.Fragment,{children:[(0,q.tZ)(ue,{isEmpty:0===t.length,isLoading:s,headers:[(0,l.t)("Project"),(0,q.tZ)(pe,{children:(0,l._N)("Last [period] Average",{period:n})},"last"),(0,q.tZ)(pe,{children:(0,l.t)("Today")},"curr"),(0,q.tZ)(pe,{children:(0,l.t)("Change")},"diff")],children:c.map(((e,t)=>{var n;let{project:s}=e;const a=null!==(n=i[s.id])&&void 0!==n?n:{};return t>=F.$&&!o?null:(0,q.BX)(r.Fragment,{children:[(0,q.tZ)(K.R,{children:(0,q.tZ)(K.W,{avatarSize:18,project:s})}),(0,q.tZ)(ce,{children:a.periodAvg}),(0,q.tZ)(ce,{children:a.today}),(0,q.tZ)(ce,{children:(0,q.BX)(me,{color:0===a.percentChange?"gray300":a.percentChange>0?"red300":"green300",children:[(0,se.rl)(Number.isNaN(a.percentChange)?0:a.percentChange,0),(0,q.tZ)(ge,{direction:a.percentChange>0?"up":"down",size:"xs"})]})})]},s.id)}))}),!s&&a]})}})]})}}const de=ae,le=(0,s.Z)("div",{target:"eahkfcz5"})("padding:",(0,C.Z)(2)," ",(0,C.Z)(2)," 0 ",(0,C.Z)(2),";border-bottom:1px solid ",(e=>e.theme.border),";"),ue=(0,s.Z)(B.Z,{target:"eahkfcz4"})("grid-template-columns:1fr 0.2fr 0.2fr 0.2fr;white-space:nowrap;margin-bottom:0;border:0;font-size:",(e=>e.theme.fontSizeMedium),";box-shadow:unset;&>div{padding:",(0,C.Z)(1)," ",(0,C.Z)(2),";}"),pe=(0,s.Z)("span",{target:"eahkfcz3"})({name:"2qga7i",styles:"text-align:right"}),ce=(0,s.Z)("div",{target:"eahkfcz2"})({name:"4os8x4",styles:"display:flex;align-items:center;justify-content:flex-end;text-align:right"}),ge=(0,s.Z)(T.CC,{target:"eahkfcz1"})("margin:0 ",(0,C.Z)(.5),";"),me=(0,s.Z)("div",{target:"eahkfcz0"})("color:",(e=>e.theme[e.color]),";");function he(e){var t,n,s,Z,x;let{location:f,router:y}=e;const b=(0,c.Z)(),{teams:w,initiallyLoaded:S}=(0,g.Z)({provideUserTeams:!0}),j=null!==(t=null==f?void 0:f.query)&&void 0!==t?t:{},z=`teamInsightsSelectedTeamId:${b.slug}`;let B=null!==(n=j.team)&&void 0!==n?n:p.Z.getItem(z);B&&!w.find((e=>e.id===B))&&(B=null);const I=null!==(s=B)&&void 0!==s?s:null===(Z=w[0])||void 0===Z?void 0:Z.id,k=w.find((e=>e.id===I)),T=null!==(x=null==k?void 0:k.projects)&&void 0!==x?x:[],C=j.environment;(0,r.useEffect)((()=>{(0,u.Z)("team_insights.viewed",{organization:b})}),[b]);const{period:D,start:A,end:E,utc:N}=(0,H.lI)(j);return 0===w.length?(0,q.tZ)(a.Z,{organization:b,superuserNeedsToBeProjectMember:!0}):(0,q.BX)(r.Fragment,{children:[(0,q.tZ)(d.Z,{title:(0,l.t)("Team Issues"),orgSlug:b.slug}),(0,q.tZ)(m.Z,{organization:b,activeTab:"issues"}),(0,q.BX)(Ze,{children:[(0,q.tZ)(h.Z,{showEnvironment:!0,location:f,router:y,currentTeam:k,currentEnvironment:C}),!S&&(0,q.tZ)(i.Z,{}),S&&(0,q.BX)(o.or,{fullWidth:!0,children:[(0,q.tZ)(v.Z,{title:(0,l.t)("All Unresolved Issues"),description:(0,l.t)("This includes New and Returning issues in the last 7 days as well as those that havenâ€™t been resolved or ignored in the past."),children:(0,q.tZ)(de,{projects:T,organization:b,teamSlug:k.slug,environment:C,period:D,start:A,end:E,utc:N})}),(0,q.tZ)(v.Z,{title:(0,l.t)("New and Returning Issues"),description:(0,l.t)("The new, regressed, and unignored issues that were assigned to your team."),children:(0,q.tZ)(J,{organization:b,projects:T,teamSlug:k.slug,environment:C,period:D,start:null==A?void 0:A.toString(),end:null==E?void 0:E.toString(),location:f,statuses:["new","regressed","unignored"]})}),(0,q.tZ)(v.Z,{title:(0,l.t)("Issues Triaged"),description:(0,l.t)("How many new and returning issues were reviewed by your team each week. Reviewing an issue includes marking as reviewed, resolving, assigning to another team, or deleting."),children:(0,q.tZ)(J,{organization:b,projects:T,teamSlug:k.slug,environment:C,period:D,start:null==A?void 0:A.toString(),end:null==E?void 0:E.toString(),location:f,statuses:["resolved","ignored","deleted"]})}),(0,q.tZ)(v.Z,{title:(0,l.t)("Age of Unresolved Issues"),description:(0,l.t)("How long ago since unresolved issues were first created."),children:(0,q.tZ)(X,{organization:b,teamSlug:k.slug})}),(0,q.tZ)(v.Z,{title:(0,l.t)("Time to Resolution"),description:(0,l.t)("The mean time it took for issues to be resolved by your team."),children:(0,q.tZ)(oe,{organization:b,environment:C,teamSlug:k.slug,period:D,start:null==A?void 0:A.toString(),end:null==E?void 0:E.toString(),location:f})})]})]})]})}he.displayName="TeamStatsIssues";const ve=he,Ze=(0,s.Z)(o.uT,{target:"e16zrx8x0"})("@media (min-width: ",(e=>e.theme.breakpoints.medium),"){display:block;}")}}]);
//# sourceMappingURL=../sourcemaps/app_views_organizationStats_teamInsights_issues_tsx.feea50f3e1626c0d88da105b9ab58a30.js.map