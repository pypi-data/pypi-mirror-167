{"version":3,"file":"lib_index_js.956df5f7f862621b568d.js","mappings":";;;;;;;;;;;;;;;;;AAA+C;AACS;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACO,kDAAkD;AACzD;AACA,qBAAqB,+EAA6B;AAClD,uBAAuB,8DAAW;AAClC;AACA;AACA;AACA,yBAAyB,8EAA4B;AACrD;AACA;AACA,kBAAkB,+EAA6B;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,gFAA8B;AAChD;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;AClCwD;AACoE;AACI;AACzF;AAC2E;AAClH;AACO;AACP,kBAAkB,4CAA4C;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C;AAC1C;AACA;AACA,iCAAiC,oDAAU,SAAS,4CAA4C;AAChG;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ,kEAAgB;AACxB,QAAQ,0IAAmC;AAC3C,QAAQ,sIAAqC;AAC7C,QAAQ,4HAAoC;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC,oDAAU;AAC/C,+BAA+B,UAAU,IAAI,eAAe;AAC5D;AACA,0EAA0E,SAAI;AAC9E;AACA;AACA;AACA;AACA;AACA,sEAAsE,SAAI;AAC1E;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA,gEAAgE,4CAA4C;AAC5G;AACA,sEAAsE,eAAe;AACrF,kGAAkG,eAAe;AACjH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wGAAwG,eAAe;AACvH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2DAA2D,SAAI;AAC/D;AACA;AACA,iEAAe,MAAM,EAAC","sources":["webpack://@educational-technology-collective/etc_jupyterlab_telemetry_coursera/./lib/handler.js","webpack://@educational-technology-collective/etc_jupyterlab_telemetry_coursera/./lib/index.js"],"sourcesContent":["import { URLExt } from '@jupyterlab/coreutils';\nimport { ServerConnection } from '@jupyterlab/services';\n/**\n * Call the API extension\n *\n * @param endPoint API REST end point for the extension\n * @param init Initial values for the request\n * @returns The response body interpreted as JSON\n */\nexport async function requestAPI(endPoint = '', init = {}) {\n    // Make request to Jupyter API\n    const settings = ServerConnection.makeSettings();\n    const requestUrl = URLExt.join(settings.baseUrl, 'etc-jupyterlab-telemetry-coursera', // API Namespace\n    endPoint);\n    let response;\n    try {\n        response = await ServerConnection.makeRequest(requestUrl, init, settings);\n    }\n    catch (error) {\n        throw new ServerConnection.NetworkError(error);\n    }\n    let data = await response.text();\n    if (data.length > 0) {\n        try {\n            data = JSON.parse(data);\n        }\n        catch (error) {\n            console.log('Not a JSON response body.', response);\n        }\n    }\n    if (!response.ok) {\n        throw new ServerConnection.ResponseError(response, data.message || data);\n    }\n    return data;\n}\n","import { INotebookTracker } from '@jupyterlab/notebook';\nimport { IETCJupyterLabTelemetryLibraryFactory } from '@educational-technology-collective/etc_jupyterlab_telemetry_library';\nimport { IETCJupyterLabNotebookStateProvider } from '@educational-technology-collective/etc_jupyterlab_notebook_state_provider';\nimport { requestAPI } from './handler';\nimport { IETCJupyterLabFeedbackServiceFactory } from '@educational-technology-collective/etc_jupyterlab_feedback';\nconst PLUGIN_ID = '@educational-technology-collective/etc_jupyterlab_telemetry_coursera:plugin';\nexport class AWSAPIGatewayAdapter {\n    constructor({ etcJupyterLabNotebookStateProvider, config }) {\n        this._etcJupyterLabNotebookStateProvider = etcJupyterLabNotebookStateProvider;\n        this._config = config;\n    }\n    async adaptMessage(sender, data) {\n        var _a, _b, _c, _d;\n        try {\n            let notebookState = this._etcJupyterLabNotebookStateProvider.getNotebookState({\n                notebookPanel: data.notebookPanel\n            });\n            var body = {\n                'event_name': data.eventName,\n                'cells': data.cells,\n                'notebook': notebookState === null || notebookState === void 0 ? void 0 : notebookState.notebook,\n                'seq': notebookState === null || notebookState === void 0 ? void 0 : notebookState.seq,\n                'session_id': notebookState === null || notebookState === void 0 ? void 0 : notebookState.session_id,\n                'user_id': ((_a = this._config) === null || _a === void 0 ? void 0 : _a.workspace_id) ? (_b = this._config) === null || _b === void 0 ? void 0 : _b.workspace_id : \"UNDEFINED\",\n                'notebook_path': data.notebookPanel.context.path,\n                'kernel_error': data.kernelError,\n                'selection': data.selection,\n                'environ': data.environ,\n                'message': data.message //  The message from the feedback extension.\n            };\n            if ((_c = this._config['capture_notebook_events']) === null || _c === void 0 ? void 0 : _c.includes(data.eventName)) {\n                body['meta'] = (_d = data.notebookPanel.content.model) === null || _d === void 0 ? void 0 : _d.toJSON();\n            }\n            let request = Object.assign({}, body);\n            delete request['meta'];\n            console.log('Request', request);\n            let response = await requestAPI('s3', { method: 'POST', body: JSON.stringify(body) });\n            console.log('Response', {\n                'response': response,\n                'requestBody': request\n            });\n        }\n        catch (e) {\n            console.error(e);\n        }\n    }\n}\n/**\n * Initialization data for the @educational-technology-collective/etc_jupyterlab_telemetry_coursera extension.\n */\nconst plugin = {\n    id: PLUGIN_ID,\n    autoStart: true,\n    requires: [\n        INotebookTracker,\n        IETCJupyterLabNotebookStateProvider,\n        IETCJupyterLabTelemetryLibraryFactory,\n        IETCJupyterLabFeedbackServiceFactory\n    ],\n    activate: (app, notebookTracker, etcJupyterLabNotebookStateProvider, etcJupyterLabTelemetryLibraryFactory, etcJupyterLabFeedbackServiceFactory) => {\n        let messageAdapter;\n        let appConfig = (async () => {\n            try {\n                await app.started;\n                const config = await requestAPI('config');\n                console.log(`${PLUGIN_ID}, ${config.version}`);\n                if (!config.telemetry) {\n                    notebookTracker.widgetAdded.disconnect(onWidgetAdded, this);\n                }\n                return config;\n            }\n            catch (e) {\n                console.error(e);\n                notebookTracker.widgetAdded.disconnect(onWidgetAdded, this);\n                return false;\n            }\n        })();\n        async function onWidgetAdded(sender, notebookPanel) {\n            //  Handlers must be attached immediately in order to detect early events, hence we do not want to await the appearance of the Notebook.\n            let config = await appConfig;\n            if (config.telemetry) {\n                setInterval(() => {\n                    var _a;\n                    if ((_a = notebookPanel.content.model) === null || _a === void 0 ? void 0 : _a.dirty) {\n                        notebookPanel.context.save();\n                    }\n                }, config.save_interval * 1000);\n                if (!messageAdapter) {\n                    messageAdapter = new AWSAPIGatewayAdapter({ etcJupyterLabNotebookStateProvider, config });\n                }\n                etcJupyterLabNotebookStateProvider.addNotebookPanel({ notebookPanel });\n                let etcJupyterLabTelemetryLibrary = etcJupyterLabTelemetryLibraryFactory.create({ notebookPanel });\n                etcJupyterLabTelemetryLibrary.notebookClipboardEvent.notebookClipboardCopied.connect(messageAdapter.adaptMessage, messageAdapter);\n                etcJupyterLabTelemetryLibrary.notebookClipboardEvent.notebookClipboardCut.connect(messageAdapter.adaptMessage, messageAdapter);\n                etcJupyterLabTelemetryLibrary.notebookClipboardEvent.notebookClipboardPasted.connect(messageAdapter.adaptMessage, messageAdapter);\n                etcJupyterLabTelemetryLibrary.notebookVisibilityEvent.notebookVisible.connect(messageAdapter.adaptMessage, messageAdapter);\n                etcJupyterLabTelemetryLibrary.notebookVisibilityEvent.notebookHidden.connect(messageAdapter.adaptMessage, messageAdapter);\n                etcJupyterLabTelemetryLibrary.notebookOpenEvent.notebookOpened.connect(messageAdapter.adaptMessage, messageAdapter);\n                etcJupyterLabTelemetryLibrary.notebookCloseEvent.notebookClosed.connect(messageAdapter.adaptMessage, messageAdapter);\n                etcJupyterLabTelemetryLibrary.notebookSaveEvent.notebookSaved.connect(messageAdapter.adaptMessage, messageAdapter);\n                etcJupyterLabTelemetryLibrary.notebookScrollEvent.notebookScrolled.connect(messageAdapter.adaptMessage, messageAdapter);\n                etcJupyterLabTelemetryLibrary.activeCellChangeEvent.activeCellChanged.connect(messageAdapter.adaptMessage, messageAdapter);\n                etcJupyterLabTelemetryLibrary.cellAddEvent.cellAdded.connect(messageAdapter.adaptMessage, messageAdapter);\n                etcJupyterLabTelemetryLibrary.cellRemoveEvent.cellRemoved.connect(messageAdapter.adaptMessage, messageAdapter);\n                etcJupyterLabTelemetryLibrary.cellExecutionEvent.cellExecuted.connect(messageAdapter.adaptMessage, messageAdapter);\n                etcJupyterLabTelemetryLibrary.cellErrorEvent.cellErrored.connect(messageAdapter.adaptMessage, messageAdapter);\n                await notebookPanel.revealed;\n                for (let cell of notebookPanel.content.widgets) {\n                    if (cell.model.metadata.has('nbgrader')) {\n                        let etcJupyterLabFeedbackService = etcJupyterLabFeedbackServiceFactory.create({ notebookPanel });\n                        etcJupyterLabFeedbackService.buttonClicked.connect(messageAdapter.adaptMessage, messageAdapter);\n                        etcJupyterLabFeedbackService.resultsDisplayed.connect(messageAdapter.adaptMessage, messageAdapter);\n                        etcJupyterLabFeedbackService.resultsDismissed.connect(messageAdapter.adaptMessage, messageAdapter);\n                        break;\n                    }\n                }\n            }\n        }\n        notebookTracker.widgetAdded.connect(onWidgetAdded, this);\n    }\n};\nexport default plugin;\n"],"names":[],"sourceRoot":""}